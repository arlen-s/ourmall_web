(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["storeSettingProductCategory"],{"0612":function(t,e,s){},"308b":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"setting-page"},[e("el-scrollbar",{staticClass:"left"},[e("div",{staticClass:"content"},[e("h1",{on:{click:t.goBack}},[e("el-link",{attrs:{icon:"el-icon-arrow-left",underline:!1}},[t._v(t._s(t.$t("storeSetting.商品类目")))])],1),e("div",{staticClass:"change-content"},[e("div",[t._v(t._s(t.$t("storeSetting.商品类目"))+" "+t._s(t.setting.categorys.length)+"/"+t._s(t.setting.cntPerRows*this.setting.rows))]),e("div",{staticClass:"category-p"},[t._v(t._s(t.$t("storeSetting.如需更换分类封面图可前往商品分类管理进行配置"))+" "),e("router-link",{attrs:{to:"/category-mgr"}},[t._v(t._s(t.$t("storeSetting.立即前往")))])],1),e("draggable",{attrs:{handle:".draggable-i"},model:{value:t.setting.categorys,callback:function(e){t.$set(t.setting,"categorys",e)},expression:"setting.categorys"}},t._l(t.setting.categorys,(function(s,i){return e("div",{key:i,staticClass:"category-select draggable-i"},[e("i",{staticClass:"iconfont icon-draggable"}),e("el-image",{staticClass:"mg-l-5 img",attrs:{src:s.themeUrl,fit:"contain"}}),e("div",{staticClass:"mg-l-5 name"},[t._v(t._s(s.name))]),e("i",{staticClass:"delete el-icon-delete",on:{click:function(e){return t.deleteCategory(i)}}})],1)})),0),t.selectedIds.length<t.setting.rows*t.setting.cntPerRows?e("div",{staticClass:"add-category",on:{click:t.addCategory}},[e("i",{staticClass:"el-icon-circle-plus"}),e("div",{staticClass:"mg-l-5"},[t._v(t._s(t.$t("storeSetting.添加商品分类")))])]):e("div",{staticClass:"notice"},[t._v(" "+t._s(t.$t("storeSetting.类目已经达到上限请先删除再添加"))+" ")])],1),e("div",{staticClass:"change-content mt-20"},[e("el-form",{ref:"category-form",attrs:{size:"mini"}},[e("el-form-item",{attrs:{label:t.$t("storeSetting.标题")}},[e("el-input",{staticStyle:{width:"210px"},model:{value:t.setting.title,callback:function(e){t.$set(t.setting,"title",e)},expression:"setting.title"}})],1),e("el-form-item",{attrs:{label:t.$t("storeSetting.展示排数(最多可展示4排)")}},[e("el-input-number",{staticStyle:{width:"210px"},attrs:{"controls-position":"right",min:1,max:4},on:{change:t.rowsChange},model:{value:t.setting.rows,callback:function(e){t.$set(t.setting,"rows",e)},expression:"setting.rows"}})],1),e("el-form-item",{attrs:{label:t.$t("storeSetting.每排展示个数(每排最多可展示4排)")}},[e("el-input-number",{staticStyle:{width:"210px"},attrs:{"controls-position":"right",min:1,max:6},on:{change:t.perChange},model:{value:t.setting.cntPerRows,callback:function(e){t.$set(t.setting,"cntPerRows",e)},expression:"setting.cntPerRows"}})],1),e("el-form-item",{attrs:{label:t.$t("storeSetting.更多按钮文案")}},[e("el-input",{staticStyle:{width:"210px"},model:{value:t.setting.moreText,callback:function(e){t.$set(t.setting,"moreText",e)},expression:"setting.moreText"}})],1),e("el-form-item",{attrs:{label:t.$t("storeSetting.图片比例")}},[e("el-select",{staticStyle:{width:"210px"},model:{value:t.setting.proportion,callback:function(e){t.$set(t.setting,"proportion",e)},expression:"setting.proportion"}},[e("el-option",{attrs:{value:"1",label:"1:1"}}),e("el-option",{attrs:{value:"1.5",label:"2:3"}}),e("el-option",{attrs:{value:"0.666",label:"3:2"}}),e("el-option",{attrs:{value:"1.333",label:"3:4"}}),e("el-option",{attrs:{value:"0.75",label:"4:3"}})],1)],1),e("el-form-item",{attrs:{label:t.$t("storeSetting.图片填充方式")}},[e("el-select",{staticStyle:{width:"210px"},model:{value:t.setting.fillWay,callback:function(e){t.$set(t.setting,"fillWay",e)},expression:"setting.fillWay"}},[e("el-option",{attrs:{value:"fill",label:"$t('storeSetting.填充')"}}),e("el-option",{attrs:{value:"contain",label:"$t('storeSetting.适应')"}})],1)],1),e("el-form-item",{attrs:{label:t.$t("storeSetting.链接打开方式")}},[e("el-radio-group",{model:{value:t.setting.target,callback:function(e){t.$set(t.setting,"target",e)},expression:"setting.target"}},[e("el-radio",{attrs:{label:"_self"}},[t._v(t._s(t.$t("storeSetting.当前页面打开链接")))]),e("el-radio",{attrs:{label:"_blank"}},[t._v(t._s(t.$t("storeSetting.新开窗口打开链接")))])],1)],1)],1)],1)])]),e("div",{staticClass:"action"},[e("el-button",{attrs:{type:"danger",size:"medium"},on:{click:t.del}},[t._v(t._s(t.$t("storeSetting.删除该组件")))]),e("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.saveData}},[t._v(t._s(t.$t("storeSetting.完成")))])],1),e("el-scrollbar",{ref:"rightBox",staticClass:"right"},[e("div",{staticClass:"content"},[e("demoHeader",{attrs:{data:t.$store.state.configJson.header,headerMenu:t.headerMenu}}),e("demoBody",{attrs:{data:t.setting,header:t.$store.state.configJson.header}}),e("demoFooter",{attrs:{setting:t.$store.state.configJson.footer}})],1)]),e("el-dialog",{attrs:{title:t.$t("storeSetting.商品分类"),width:"300px",visible:t.addCategoryVisible},on:{"update:visible":function(e){t.addCategoryVisible=e}}},[e("div",{staticClass:"dialog-area"},[e("div",{staticClass:"search"},[e("el-input",{attrs:{size:"mini","suffix-icon":"el-icon-search"},on:{input:t.searchCategory},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}})],1),e("el-scrollbar",[t.displayItems.length>0?e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.cLoading,expression:"cLoading"}],staticClass:"item-area"},[t._l(t.displayItems,(function(s,i){return[-1==t.selectedIds.indexOf(s.id)?e("div",{key:i},[e("div",{staticClass:"item-list"},[e("div",{staticClass:"left"},[e("el-image",{staticClass:"image",attrs:{fit:"contain",src:s.themeUrl}}),e("div",{staticClass:"name"},[t._v(t._s(s.name))])],1),e("div",[e("el-checkbox",{attrs:{label:s},model:{value:t.selectedItems,callback:function(e){t.selectedItems=e},expression:"selectedItems"}},[e("div",{staticStyle:{display:"none"}},[t._v("1")])])],1)]),e("el-divider")],1):t._e()]})),t.selectedIds.length==t.displayItems.length?e("div",{staticClass:"no-category"},[t._v(" "+t._s(t.$t("storeSetting.暂无更多类目"))+" ")]):t._e(),e("div",{staticStyle:{height:"20px"}})],2):t._e()]),0==t.displayItems.length?e("div",{staticClass:"no-category"},[t._v(" "+t._s(t.$t("storeSetting.暂无类目"))+" "),e("router-link",{attrs:{to:"/category-mgr"}},[t._v(t._s(t.$t("storeSetting.前去添加")))])],1):t._e(),e("div",{staticClass:"control"},[e("router-link",{staticClass:"mg-r-20",attrs:{to:"/category-mgr"}},[t._v(t._s(t.$t("storeSetting.管理商品类目")))]),e("i",{staticClass:"refresh mg-r-20 el-icon-refresh",on:{click:t.getCategory}}),e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.addCategoryHandle}},[t._v(t._s(t.$t("storeSetting.添加"))+" ")])],1)],1)])],1)},a=[],o=(s("14d9"),s("4f85")),r=s("826e"),l=s("db46"),n=s("8c3c"),c=s("b76a"),g=s.n(c),d={data(){return{keyword:"",selectedIds:[],cLoading:!1,selectedItems:[],headerMenu:[],addCategoryVisible:!1,editorOption:{modules:{syntax:{highlight:t=>hljs.highlightAuto(t).value},toolbar:{container:[["bold","italic","underline","strike"]]}},placeholder:this.$t("goodsEdit.编辑商品描述")},isSave:!1,setting:{cid:this.$route.query.cid,type:"productCategory",title:"",rows:2,cntPerRows:3,moreText:"",proportion:"1",fillWay:"cover",target:"_blank",categorys:[]},items:[],exist:!1,displayItems:[]}},components:{Category:o["a"],demoHeader:r["a"],draggable:g.a,demoBody:n["a"],demoFooter:l["a"]},beforeRouteLeave(t,e,s){if(this.isSave)s();else{let t=confirm(this.$t("logistics.当前页面还未保存，确定要离开吗?"));t?s():s(!1)}},created(){this.getCategory()},methods:{rowsChange(t,e){t*this.setting.cntPerRows<this.setting.categorys.length&&(this.setting.categorys.splice(t*this.setting.cntPerRows-1,this.setting.categorys.length-t*this.setting.cntPerRows),this.selectedIds.splice(t*this.setting.cntPerRows-1,this.selectedIds.length-t*this.setting.cntPerRows))},perChange(t,e){t*this.setting.rows<this.setting.categorys.length&&(this.setting.categorys.splice(t*this.setting.rows-1,this.setting.categorys.length-t*this.setting.rows),this.selectedIds.splice(t*this.setting.rows-1,this.selectedIds.length-t*this.setting.rows))},del(){this.isSave=!0,this.$store.commit("delComponent",this.setting.cid),this.setting=JSON.parse(JSON.stringify(this.$store.state.configJson)),this.$apiCall("api.VendorShop.setShopConfig",{configJson:JSON.stringify(this.$store.state.configJson)},t=>{9999==t.ErrorCode?(this.$elementMessage("删除成功","success"),this.$router.replace({name:"storeSettingMain"})):this.$message({message:t.Message,type:"error"})})},deleteCategory(t){this.selectedIds.splice(t,1),this.setting.categorys.splice(t,1)},searchCategory(t){let e=[];this.items.forEach(s=>{s.name.indexOf(t)>-1&&e.push(s)}),this.displayItems=e,console.log(this.displayItems)},addCategoryHandle(){let t=this.setting.rows*this.setting.cntPerRows;this.selectedIds.length+this.selectedItems.length>t?this.$elementMessage(this.$t("storeSetting.超出限制数量"),"error"):(this.selectedItems.forEach(t=>{this.selectedIds.push(t.id)}),this.setting.categorys.push(...this.selectedItems),this.selectedItems=[],this.addCategoryVisible=!1)},getCategory(){this.cLoading=!0,this.$apiCall("api.ProductCategory.findByUser",{level:1},t=>{setTimeout(()=>{this.cLoading=!1},500),9999==t.ErrorCode&&(this.items=t.Data.Results,this.displayItems=t.Data.Results,this.$apiCall("api.VendorShop.getShopConfig",{},t=>{9999==t.ErrorCode&&0!==t.Data.Results.length&&(t.Data.Results.sort.forEach(t=>{if(t.cid==this.$route.query.cid){let e=[];t.categorys.forEach(t=>{this.items.forEach(s=>{t.id==s.id&&(e.push(s),this.selectedIds.push(s.id))})}),t.categorys=e,this.setting=JSON.parse(JSON.stringify(t)),this.exist=!0,this.$nextTick(()=>{this.$refs.rightBox.wrap.scrollTop=document.getElementById("row"+t.cid).offsetTop})}}),this.$store.commit("getShopConfig",t.Data.Results),this.exist||(this.setting={cid:this.$route.query.cid,type:"productCategory",title:"",rows:2,cntPerRows:3,moreText:"",proportion:"1",fillWay:"cover",target:"_blank",categorys:[]},this.exist=!0,this.$store.commit("addStoreComponent",this.setting)))}))})},addCategory(){this.addCategoryVisible=!0},goBack(){this.$router.push({name:"storeSettingMain"})},saveData(){this.isSave=!0,this.exist&&(this.$store.commit("setStoreComponent",this.setting),this.$elementMessage("保存成功","success")),this.$apiCall("api.VendorShop.setShopConfig",{configJson:JSON.stringify(this.$store.state.configJson)},t=>{9999==t.ErrorCode?this.$elementMessage("保存成功","success"):this.$message({message:t.Message,type:"error"})})}}},h=d,m=(s("9524"),s("e3d9"),s("2877")),p=Object(m["a"])(h,i,a,!1,null,"1c2433f1",null);e["default"]=p.exports},"79f9":function(t,e,s){},9524:function(t,e,s){"use strict";s("79f9")},e3d9:function(t,e,s){"use strict";s("0612")}}]);