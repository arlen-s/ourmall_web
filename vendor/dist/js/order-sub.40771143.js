(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["order-sub"],{"4c3f":function(t,e,i){"use strict";i("5d63")},"4ec4":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen",value:t.loading,expression:"loading",modifiers:{fullscreen:!0}}],attrs:{"element-loading-background":"rgba(0, 0, 0, 0.3)"}},[e("div",{ref:"tablefilter"},[e("div",{staticClass:"d-flex",staticStyle:{"margin-bottom":"5px","justify-content":"space-between"}},[e("div",{staticClass:"left d-flex",staticStyle:{"flex-wrap":"wrap"}},[e("div",{ref:"pageFilter",staticClass:"page-filter",staticStyle:{"border-bottom":"none"}},[e("el-form",{attrs:{inline:!0,size:"mini"}},[e("el-form-item",{staticClass:"mg-r-5",staticStyle:{"margin-bottom":"0"}},[e("el-input",{staticStyle:{width:"160px"},attrs:{clearable:"",size:"mini",placeholder:t.$t("myinvoice.采购订单编号")},on:{clear:function(e){return t.clearFilter("code")}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.filterGetItem("code")}},model:{value:t.code,callback:function(e){t.code=e},expression:"code"}})],1),e("el-form-item",{staticClass:"mg-r-5",staticStyle:{"margin-bottom":"0"}},[e("el-select",{attrs:{filterable:"",remote:"","remote-method":t.remoteMethodCustom,loading:t.selectLoading,placeholder:t.$t("myinvoice.pleaseCusName"),clearable:""},on:{change:function(e){return t.filterGetItem("relationshipId")}},model:{value:t.filterParams.relationshipId,callback:function(e){t.$set(t.filterParams,"relationshipId",e)},expression:"filterParams.relationshipId"}},t._l(t.selectArr,(function(t){return e("el-option",{key:t.id,attrs:{label:t.customerName,value:t.id}})})),1)],1),e("el-form-item",{staticClass:"mg-r-5",staticStyle:{"margin-bottom":"0"}},[e("el-select",{attrs:{filterable:"",remote:"","remote-method":t.getShopName,loading:t.getShopNameInput.loading,placeholder:t.$t("myinvoice.请输入查询店铺名"),clearable:""},on:{change:function(e){return t.filterGetItem("accountId")}},model:{value:t.filterParams.accountId,callback:function(e){t.$set(t.filterParams,"accountId",e)},expression:"filterParams.accountId"}},t._l(t.getShopNameInput.shopList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.shopName,value:t.id}})})),1)],1),e("el-form-item",{staticClass:"mg-r-5",staticStyle:{"margin-bottom":"0"}},[e("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:t.$t("myinvoice.losNum"),clearable:""},on:{clear:function(e){return t.clearFilter("trackNumber")}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.filterGetItem("trackNumber")}},model:{value:t.filterParams.trackNumberIpt,callback:function(e){t.$set(t.filterParams,"trackNumberIpt",e)},expression:"filterParams.trackNumberIpt"}})],1),e("el-form-item",{staticClass:"mg-r-5",staticStyle:{"margin-bottom":"0"}},[e("el-input",{staticStyle:{width:"140px"},attrs:{placeholder:t.$t("myinvoice.客户订单编号"),clearable:""},on:{clear:function(e){return t.clearFilter("codeName")}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.filterGetItem("codeName")}},model:{value:t.filterParams.codeNameIpt,callback:function(e){t.$set(t.filterParams,"codeNameIpt",e)},expression:"filterParams.codeNameIpt"}},[e("template",{slot:"prepend"},[t._v("#")])],2)],1),e("el-form-item",{staticClass:"mg-r-20",staticStyle:{"margin-bottom":"0"}},[e("el-select",{staticClass:"mg-r-5",staticStyle:{width:"170px"},attrs:{placeholder:t.$t("myinvoice.filterTime")},model:{value:t.filterParams.timeFilter,callback:function(e){t.$set(t.filterParams,"timeFilter",e)},expression:"filterParams.timeFilter"}},t._l(t.filterParams.timeOption,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),t.filterParams.timeFilter?e("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange",align:"right","unlink-panels":"","range-separator":t.$t("myinvoice.to"),"start-placeholder":t.$t("myinvoice.startDate"),"end-placeholder":t.$t("myinvoice.endDate")},on:{change:t.dateChange},model:{value:t.filterParams.date,callback:function(e){t.$set(t.filterParams,"date",e)},expression:"filterParams.date"}}):t._e()],1),e("el-form-item",{staticStyle:{"margin-bottom":"0"}},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.filterGetItem()}}},[t._v(t._s(t.$t("myinvoice.filter")))]),e("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.clearFilter()}}},[t._v(t._s(t.$t("myinvoice.clear")))])],1)],1)],1)])]),e("div",{staticClass:"mg-b-10"},[t.filterParams.code?e("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(e){return t.clearFilter("code")}}},[t._v(t._s(t.filterParams.code))]):t._e(),t.filterParams.relationshipId?e("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(e){return t.clearFilter("relationshipId")}}},[t._v(t._s(t.filterParams.idName)+" ")]):t._e(),t.filterParams.accountId?e("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(e){return t.clearFilter("accountId")}}},[t._v(t._s(t.filterParams.aIdName)+" ")]):t._e(),t.filterParams.trackNumber?e("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(e){return t.clearFilter("trackNumber")}}},[t._v(t._s(t.$t("myinvoice.losNum"))+" "+t._s(t.filterParams.trackNumber)+" ")]):t._e(),t.filterParams.codeName?e("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(e){return t.clearFilter("codeName")}}},[t._v(t._s(t.$t("myinvoice.客户订单编号"))+"# "+t._s(t.filterParams.codeName)+" ")]):t._e(),t.filterParams.date.length?e("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(e){return t.clearFilter("date")}}},[t._v(t._s(t.showDateText(t.filterParams.timeFilter))+" "+t._s(t.filterParams.dateFrom)+" - "+t._s(t.filterParams.dateTo)+" ")]):t._e()],1)]),e("div",{staticClass:"table-wrap",staticStyle:{"border-top":"1px #ebeef5 solid"}},[e("el-checkbox-group",{model:{value:t.checkboxArr,callback:function(e){t.checkboxArr=e},expression:"checkboxArr"}},[e("el-table",{ref:"gridTable",attrs:{data:t.tableData,stripe:""}},["waitingForPayment"==t.activeName||"waitingForOffer"==t.activeName?e("el-table-column",{attrs:{width:"40"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-checkbox",{staticClass:"none-label",attrs:{label:i.row.id,disabled:t.checkDisabled(i.row)},on:{change:function(e){return t.checkItem(i.row)}}})]}}],null,!1,3269368157)}):t._e(),e("el-table-column",{attrs:{label:t.$t("myinvoice.invoiceNum"),prop:"code",width:"250"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[t._v(" "+t._s(i.row.code)+" "),1==i.row.importError&&4!=i.row.status&&5!=i.row.status&&6!=i.row.status?e("el-tooltip",{attrs:{placement:"top"}},[e("div",{attrs:{slot:"content"},slot:"content"},[i.row.extraJson&&i.row.extraJson.importErrorLog&&i.row.extraJson.importErrorLog.length?t._l(i.row.extraJson.importErrorLog,(function(i,s){return e("p",{key:s},[t._v(" "+t._s(i)+" ")])})):t._e()],2),e("i",{staticClass:"el-icon-warning tx-danger",staticStyle:{"font-size":"14px","margin-left":"5px"}})]):t._e()],1),e("p",{staticClass:"tx-gray-600",staticStyle:{"white-space":"nowrap"}},[e("span",{domProps:{innerHTML:t._s(t.$t("myinvoice.includeNum",{num:Number(i.row.orderCnt)}))}}),t._v(" / "),i.row.totalCnt?e("el-popover",{attrs:{trigger:"hover",placement:"right"}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:i.row.loadCnt,expression:"scope.row.loadCnt"}],staticStyle:{"min-height":"50px","font-size":"12px"},attrs:{slot:""},slot:"default"},[e("div",{staticStyle:{"margin-bottom":"5px"}},[t._v(" "+t._s(t.$t("myinvoice.totalOrders"))),e("b",[t._v(t._s(i.row.totalCnt))]),t._v(" "+t._s(t.$t("myinvoice.pros"))+" ")]),i.row.cnt?[e("div",{staticStyle:{"margin-bottom":"15px","padding-left":"10px"}},t._l(i.row.cnt,(function(i,s){return e("div",{key:s},[e("span",{staticStyle:{"white-space":"nowrap"}},[t._v(t._s(i.name)+" :")]),e("span",{staticStyle:{color:"#606266","white-space":"nowrap"}},[t._v(t._s(i.cnt))])])})),0),e("div",{staticStyle:{"text-align":"right"}},[e("a",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:i.row.cntText,expression:"scope.row.cntText",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:t.cntOnCopy,expression:"cntOnCopy",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:t.cntOnError,expression:"cntOnError",arg:"error"}],staticStyle:{color:"#5c6ac4"},attrs:{href:"javascript:;"}},[t._v(t._s(t.$t("myinvoice.copyData")))])])]:t._e()],2),e("a",{staticStyle:{color:"#5c6ac4"},attrs:{slot:"reference",href:"javascript:;"},on:{mouseenter:function(e){return t.getCntCountry(i.row)}},slot:"reference"},[t._v(t._s(i.row.totalCnt))])]):e("span",{staticStyle:{color:"#606266"}},[t._v("0")]),t._v(" "+t._s(t.$t("myinvoice.pros"))+" / "),i.row.shops.length?e("el-popover",{attrs:{trigger:"hover",placement:"right"}},[e("div",{staticStyle:{"min-height":"50px","font-size":"12px"}},[e("div",{staticStyle:{"margin-bottom":"5px"}},[t._v(" "+t._s(t.$t("myinvoice.总共店铺数："))),e("b",[t._v(t._s(i.row.shops.length))]),t._v(t._s(t.$t("myinvoice.店铺"))+" ")]),t._l(i.row.shops,(function(i){return e("div",{key:i.id},[t._v(" "+t._s(i.shopName)+" ")])}))],2),e("a",{staticStyle:{color:"#5c6ac4"},attrs:{slot:"reference",href:"javascript:;"},slot:"reference"},[t._v(t._s(i.row.shops.length))])]):e("span",{staticStyle:{color:"#606266"}},[t._v("0")]),t._v(t._s(t.$t("myinvoice.个店铺"))+" ")],1)]}}])}),e("el-table-column",{attrs:{label:t.$t("myinvoice.cus"),prop:"customerName"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[t._v(t._s(i.row.customerName))]),e("div",[t._v(t._s(i.row.customerRemark))])]}}])}),e("el-table-column",{attrs:{label:t.$t("myinvoice.采购单金额"),width:"230",align:"right"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",{staticStyle:{width:"100%","text-align":"right"}},[1==i.row.status?[i.row.orderStatusCnt&&Number(i.row.orderStatusCnt.notBindCnt)?e("div",{staticClass:"tx-danger"},[t._v(" "+t._s(t.$t("myinvoice.部分商品供货价未设置"))+" ")]):i.row.orderStatusCnt?[e("div",[e("span",{staticStyle:{"margin-right":"5px",color:"#909399"}},[t._v("US$")]),e("span",{staticStyle:{color:"#f56c6c"}},[t._v(t._s(i.row.realAmount))])]),i.row.paymentType?e("div",[e("span",{staticStyle:{"margin-right":"5px",color:"#909399"}},[t._v(t._s(t.$t("invoice.采购单付款方式"))+": ")]),e("span",[t._v(t._s(t.$t(t.$dict.paymentType[i.row.paymentType].text)))])]):t._e()]:t._e()]:[e("div",{staticClass:"d-flex",staticStyle:{"justify-content":"flex-end"}},[Number(i.row.totalAmount)?[e("span",{staticStyle:{"margin-right":"10px",color:"#909399"}},[t._v("US$")]),e("span",{staticStyle:{color:"#303133"}},[t._v(" "+t._s(i.row.totalAmount)+" ")])]:e("span",{staticStyle:{"text-align":"right"}},[t._v(t._s(t.$t("myinvoice.setUp")))])],2)]],2)]}}])}),e("el-table-column",{attrs:{label:t.$t("myinvoice.发货统计"),width:"280"},scopedSlots:t._u([{key:"default",fn:function(i){return[i.row.orderStatusCnt?[e("div",{staticStyle:{display:"flex"}},[e("div",{staticClass:"mg-r-10"},[/^(1|2|3|4|5)$/.test(i.row.status)?e("div",{staticClass:"total-num"},[e("span",{staticClass:"title mg-r-5"},[t._v(" "+t._s(1==i.row.status?t.$t("myinvoice.待报价："):t.$t("myinvoice.待发货："))+" ")]),1==i.row.status?e("span",{staticClass:"num mg-r-5",class:"tx-"+t.$dict.invoiceStatus[i.row.status].type},[t._v(t._s(i.row.orderStatusCnt.waitOfferCnt||"---"))]):e("span",{staticClass:"num mg-r-5",class:"tx-"+t.$dict.invoiceStatus[i.row.status].type},[t._v(t._s(i.row.orderStatusCnt.undeliveredCnt||"---"))]),Number(i.row.orderStatusCnt.refundOrderCnt)?e("div",{staticClass:"total-num"},[e("span",{staticClass:"msg"},[t._v("( "),e("span",{staticClass:"tx-danger"},[t._v(t._s(i.row.orderStatusCnt.refundOrderCnt))]),t._v(" "+t._s(t.$t("myinvoice.个订单采购数量异常"))+" )")])]):t._e()]):t._e(),/^(4|5|6)$/.test(i.row.status)?e("div",{staticClass:"total-num"},[e("span",{staticClass:"title mg-r-5"},[t._v(t._s(t.$t("myinvoice.已发货：")))]),e("span",{staticClass:"num mg-r-5 tx-success"},[t._v(t._s(i.row.orderStatusCnt.deliveredCnt||"---"))]),e("div",[Number(i.row.orderStatusCnt.refundOrderCnt)&&6==i.row.status?e("div",{staticClass:"total-num"},[e("span",{staticClass:"msg"},[t._v("( "),e("span",{staticClass:"tx-danger"},[t._v(t._s(i.row.orderStatusCnt.refundOrderCnt))]),t._v(" "+t._s(t.$t("myinvoice.个客户有退款"))+" )")])]):t._e(),Number(i.row.orderStatusCnt.notSyncCnt)?e("div",{staticClass:"total-num"},[e("el-popover",{attrs:{placement:"bottom",title:t.$t("myinvoice.Download"),width:"500",trigger:"hover"}},[e("div",{staticClass:"mg-t-15 mg-b-15",staticStyle:{"white-space":"nowrap"}},[e("span",{staticClass:"tx-gray-600"},[t._v(t._s(t.$t("myinvoice.shippedquantity"))+" ")]),e("a",{attrs:{href:"javascript:;"}},[t._v(t._s(i.row.orderStatusCnt.deliveredCnt))]),e("span",{staticClass:"mg-l-10"},[t._v(" ("),e("a",{attrs:{href:"javascript:;"}},[t._v(t._s(i.row.orderStatusCnt.notSyncOrderCnt))]),t._v(" "+t._s(t.$t("myinvoice.个订单同步异常"))+") ")])]),e("el-alert",{staticClass:"icon-color",attrs:{closable:!1,title:t.$t("myinvoice.Downloadtext"),type:"info","show-icon":""}}),e("div",{staticClass:"mg-t-15 d-flex justify-content-center"},[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.exportDeliver(i.row.id,1)}}},[t._v(t._s(t.$t("myinvoice.Downloadall")))]),e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.exportDeliver(i.row.id,2)}}},[t._v(t._s(t.$t("myinvoice.Downloadallunsync")))])],1),e("a",{staticClass:"msg",attrs:{slot:"reference",href:"javascript:;"},slot:"reference"},[t._v(" ( "),e("span",{staticClass:"tx-danger"},[t._v(t._s(i.row.orderStatusCnt.notSyncOrderCnt))]),t._v(" "+t._s(t.$t("myinvoice.个订单同步异常"))+" ) ")])],1)],1):t._e()])]):t._e()])])]:e("i",{staticClass:"el-icon-loading"})]}}])}),e("el-table-column",{attrs:{label:t.$t("myinvoice.status"),width:"180"},scopedSlots:t._u([{key:"default",fn:function(i){return[t.$dict.invoiceStatus[i.row.status]?["9"==i.row.status&&i.row.stopReason?e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:i.row.stopReason,placement:"top"}},[e("span",[t._v(t._s(t.$t(t.$dict.invoiceStatus[i.row.status].text)))])]):e("span",{class:"tx-"+t.$dict.invoiceStatus[i.row.status].type},[t._v(t._s(t.$t(t.$dict.invoiceStatus[i.row.status].text)))])]:t._e()]}}])}),e("el-table-column",{attrs:{label:t.$t("myinvoice.dateTime"),width:"250"},scopedSlots:t._u([{key:"default",fn:function(i){return[i.row.timeCreated?e("div",{staticStyle:{"white-space":"nowrap"}},[e("span",{staticClass:"tx-gray-600"},[t._v(t._s(t.$t("myinvoice.orderCreate")))]),e("span",[t._v(t._s(t.$moment.unix(i.row.timeCreated).format("YYYY-MM-DD HH:mm:ss")))])]):t._e(),i.row.timeRead?e("div",{staticStyle:{"white-space":"nowrap"}},[e("span",{staticClass:"tx-gray-600"},[t._v(t._s(t.$t("myinvoice.orderPaid")))]),e("span",[t._v(t._s(t.$moment.unix(i.row.timeRead).format("YYYY-MM-DD HH:mm:ss")))])]):t._e(),i.row.timePaid?e("div",{staticStyle:{"white-space":"nowrap"}},[e("span",{staticClass:"tx-gray-600"},[t._v(t._s(t.$t("myinvoice.orderConfirm")))]),e("span",[t._v(t._s(t.$moment.unix(i.row.timePaid).format("YYYY-MM-DD HH:mm:ss")))])]):t._e()]}}])}),e("el-table-column",{attrs:{fixed:"right",label:t.$t("myinvoice.action"),width:"150"},scopedSlots:t._u([{key:"default",fn:function(i){return[i.row.orderStatusCnt?["1"!=i.row.status||Number(i.row.orderStatusCnt.notBindCnt)?t._e():e("div",[e("el-link",{staticStyle:{"font-size":"12px"},attrs:{type:"success"},on:{click:function(e){return t.setPriceConfirm(i.row)}}},[t._v(" "+t._s(t.$t("invoice.确认完成报价"))+" ")])],1),e("div",[e("el-link",{staticStyle:{"font-size":"12px"},attrs:{type:"1"==i.row.status&&Number(i.row.orderStatusCnt.notBindCnt)?"success":"primary"},on:{click:function(e){return t.gotoInvoice(i.row)}}},[t._v(" "+t._s("1"==i.row.status&&Number(i.row.orderStatusCnt.notBindCnt)?t.$t("myinvoice.完善报价"):t.$t("myinvoice.viewDetail"))+" ")])],1)]:t._e(),2!=i.row.status&&3!=i.row.status&&4!=i.row.status&&5!=i.row.status&&6!=i.row.status&&9!=i.row.status?[e("el-link",{staticStyle:{"font-size":"12px"},attrs:{type:"primary"},on:{click:function(e){return t.handleCommand({row:i.row,command:"b"})}}},[t._v(t._s(t.$t("myinvoice.导出订单信息")))]),e("el-link",{staticStyle:{"font-size":"12px"},attrs:{type:"primary"},on:{click:function(e){return t.handleCommand({row:i.row,command:"a"})}}},[t._v(t._s(t.$t("myinvoice.importInfo")))])]:t._e(),2==i.row.status?e("div",[e("el-link",{staticStyle:{"font-size":"12px"},attrs:{disabled:i.row.submitLoading,type:"success"},on:{click:function(e){return t.sendInvoice(i.row)}}},[t._v(t._s(t.$t("myinvoice.sendCus")))])],1):t._e(),3==i.row.status?e("div",[e("el-link",{staticStyle:{"font-size":"12px"},attrs:{disabled:i.row.submitLoading,type:"success"},on:{click:function(e){return t.openConfirmSetPayed(i.row)}}},[t._v(t._s(t.$t("myinvoice.确认收到款项")))])],1):t._e(),4==i.row.status||5==i.row.status?e("div",[e("el-link",{staticStyle:{"font-size":"12px"},attrs:{type:"primary"},on:{click:function(e){return t.openDeliverImport(i.row)}}},[t._v(t._s(t.$t("myinvoice.手工导入发货信息")))])],1):t._e(),1!=i.row.status&&2!=i.row.status?e("div",[e("el-link",{staticStyle:{"font-size":"12px"},attrs:{type:"primary"},on:{click:function(e){return t.handleCommand({row:i.row,command:"c"})}}},[t._v(t._s(t.$t("myinvoice.exportt")))])],1):t._e(),2==i.row.status?e("div",[e("div",[e("el-dropdown",{attrs:{type:"primary"},on:{command:t.handleCommandStatus2}},[e("div",[e("el-link",{staticStyle:{"font-size":"12px"},attrs:{type:"primary"},on:{click:function(e){return t.handleCommand({row:i.row,command:"b"})}}},[t._v(t._s(t.$t("myinvoice.导出订单信息")))]),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})],1),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{disabled:""}},[e("b",{staticClass:"black"},[t._v(" "+t._s(t.$t("myinvoice.更多操作"))+" ")])]),e("el-dropdown-item",{attrs:{command:{type:"a",data:i.row}}},[t._v(t._s(t.$t("myinvoice.importInfo")))]),i.row.status<5?e("el-dropdown-item",{attrs:{command:{type:"c",data:i.row}}},[t._v(t._s(t.$t("myinvoice.cancelOrder")))]):t._e()],1)],1)],1)]):t._e(),4==i.row.paymentType&&1==i.row.payStatus||6==i.row.paymentType?t._e():[2!=i.row.status&&i.row.status<5?e("div",[e("el-link",{staticStyle:{"font-size":"12px"},attrs:{type:"danger"},on:{click:function(e){return t.cancelInvoice(i.row)}}},[t._v(t._s(t.$t("myinvoice.cancelOrder")))])],1):t._e()]]}}])})],1)],1)],1),e("div",{ref:"tableFooter"},[t.tableData.length?e("el-row",{attrs:{gutter:20}},[e("el-col",{staticClass:"d-flex justify-content-center",attrs:{span:24}},[e("div",{staticStyle:{position:"relative",top:"10px"}},[e("el-pagination",{attrs:{"current-page":t.page,background:!0,layout:"sizes, total, prev, pager, next, jumper","page-sizes":t.pageSize,"page-size":t.rowsPerPage,total:Number(t.totalCount)},on:{"current-change":t.toPage,"size-change":t.changePageSize}})],1)])],1):t._e()],1),e("el-dialog",{attrs:{width:"80%",title:"b"==t.exportInvoiceType?t.$t("myinvoice.exportShopify"):t.$t("myinvoice.exportOrder"),visible:t.innerVisible},on:{"update:visible":function(e){t.innerVisible=e}}},[e("div",{staticClass:"modal-export"},[e("el-divider"),e("div",{staticClass:"border-bottom-1 mg-b-15 pd-b-15"},[e("h6",{staticClass:"mg-b-15",staticStyle:{"border-left":"4px solid #3f4eae","padding-left":"10px"}},[t._v(" "+t._s(t.$t("myinvoice.exportFields"))),e("span",{staticClass:"mg-l-5"},[t._v(t._s(t.$t("myinvoice.dragging")))])]),e("div",{staticClass:"draggable-wrap"},[e("draggable",{attrs:{list:t.modalCustomExport.selectedTitles,draggable:".dargDiv",options:{animation:300},group:"tags"}},t._l(t.modalCustomExport.selectedTitles,(function(i,s){return e("el-tag",{key:i.name,staticClass:"dargDiv",attrs:{closable:"","disable-transitions":!1},on:{close:function(e){return t.removeTitle(s)}}},[t._v(" "+t._s(i.name)+" ")])})),1),t.modalCustomExport.selectedTitles.length?t._e():e("div",{staticClass:"w-100 justify-content-center"},[e("span",{staticStyle:{color:"#f56c6c"}},[t._v(t._s(t.$t("myinvoice.PleaseSelectBelow")))])])],1)]),e("el-divider"),e("div",{staticClass:"border-bottom-1 mg-b-15 pd-b-15"},[e("h6",{staticClass:"mg-b-15",staticStyle:{"border-left":"4px solid #3f4eae","padding-left":"10px"}},[t._v(" "+t._s(t.$t("myinvoice.optionalfields"))+" "),e("span",{staticClass:"tx-danger tx-12",staticStyle:{color:"#f56c6c"}},[t._v(t._s(t.$t("myinvoice.notExport")))])]),e("div",{staticClass:"tag-wrap"},[e("draggable",{attrs:{list:t.modalCustomExport.unselectedTitles,draggable:".uns-tag",options:{animation:300},group:"tags"}},t._l(t.modalCustomExport.unselectedTitles,(function(i,s){return e("el-tag",{key:i.orName,attrs:{effect:"dark"},on:{click:function(e){return t.selectTitle(s)}}},[t._v(" "+t._s(i.orName)+" ")])})),1)],1)]),e("el-divider"),e("div",{staticClass:"border-bottom-1 mg-b-15 pd-b-15"},[e("h6",{staticClass:"mg-b-15",staticStyle:{"border-left":"4px solid #3f4eae","padding-left":"10px"}},[t._v(" "+t._s(t.$t("myinvoice.customField"))+" "),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.$t("myinvoice.rename"),placement:"top"}},[e("i",{staticClass:"fa fa-question-circle-o",staticStyle:{color:"#5c6ac4","text-decoration":"none"}})]),e("a",{staticClass:"mg-l-20",staticStyle:{color:"#5c6ac4","text-decoration":"none"},attrs:{href:"javascript:;"},on:{click:function(e){t.showCustom=!t.showCustom}}},[t._v(t._s(t.showCustom?t.$t("myinvoice.hideFields"):t.$t("myinvoice.showFields")))])],1),e("div",{staticClass:"row custom-wrap",class:{hide:!t.showCustom}},[e("el-row",{staticStyle:{margin:"0"},attrs:{gutter:20}},t._l(t.modalCustomExport.selectedTitles,(function(i){return e("el-col",{key:i.orName,staticStyle:{"margin-top":"10px"},attrs:{span:12}},[e("div",{staticClass:"grid-content",staticStyle:{display:"flex","align-items":"center"}},[e("label",{staticStyle:{width:"200px","white-space":"nowrap","text-align":"right","margin-right":"10px",color:"#999"}},[t._v("["+t._s(i.orName)+"]"+t._s(t.$t("myinvoice.showAs"))+"：")]),e("div",{staticClass:"col-6"},[e("el-input",{attrs:{placeholder:i.orName,size:"small"},model:{value:i.name,callback:function(e){t.$set(i,"name",e)},expression:"title.name"}})],1)])])})),1)],1)]),e("el-divider")],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small"},on:{click:function(e){t.innerVisible=!1}}},[t._v(t._s(t.$t("myinvoice.discard")))]),e("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.saveCustomExportSettingOnly}},[t._v(t._s(t.$t("myinvoice.saveSetting")))]),1!=t.exportItem.payStatus&&"c"==t.exportInvoiceType?[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top"}},[e("div",{attrs:{slot:"content"},slot:"content"},[t._v(" "+t._s(t.$t("myinvoice.confirmReceipt"))+" ")]),e("el-button",{staticStyle:{"background-color":"#b3e19d","border-color":"#b3e19d",cursor:"not-allowed"},attrs:{type:"success",size:"small"}},[t._v(" "+t._s(t.$t("myinvoice.saveSettingExcel"))+" ")])],1),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top"}},[e("div",{attrs:{slot:"content"},slot:"content"},[t._v(" "+t._s(t.$t("myinvoice.confirmReceipt"))+" ")]),e("el-button",{staticStyle:{"background-color":"#b3e19d","border-color":"#b3e19d",cursor:"not-allowed"},attrs:{type:"success",size:"small"}},[t._v(" "+t._s(t.$t("myinvoice.saveSettingCsv"))+" ")])],1)]:[e("el-button",{attrs:{type:"success",size:"small"},on:{click:function(e){return t.saveCustomExport("1")}}},[t._v(t._s(t.$t("myinvoice.saveSettingExcel")))]),e("el-button",{attrs:{type:"success",size:"small"},on:{click:function(e){return t.saveCustomExport("2")}}},[t._v(t._s(t.$t("myinvoice.saveSettingCsv")))])]],2)]),e("el-dialog",{attrs:{"custom-class":"sendInvoice",title:t.$t("myinvoice.sendInvoice"),visible:t.sendInvoiceOpen,width:"50%"},on:{open:t.openSkype,"update:visible":function(e){t.sendInvoiceOpen=e}}},[[e("div",{staticStyle:{position:"relative","z-index":"1"}},[e("div",{staticStyle:{position:"absolute",right:"30px",top:"15px"}},[e("el-switch",{on:{change:t.changeShowItemPrice},model:{value:t.showItemPrice,callback:function(e){t.showItemPrice=e},expression:"showItemPrice"}}),t._v(" "+t._s(t.$t("myinvoice.showPrice"))+" ")],1)]),e("el-tabs",{staticStyle:{"margin-left":"20px","margin-top":"10px"},attrs:{type:"card"},model:{value:t.activeShareName,callback:function(e){t.activeShareName=e},expression:"activeShareName"}},[e("el-tab-pane",{attrs:{name:"shareLink"}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("i",{staticClass:"iconfont icon-link"}),t._v(" "+t._s(t.$t("myinvoice.shareLink")))]),e("div",{staticClass:"d-flex mg-y-20"},[e("div",{staticStyle:{color:"#999",width:"150px","text-align":"right","margin-right":"10px","white-space":"nowrap"}},[t._v(" "+t._s(t.$t("myinvoice.shareUrl"))+" ")]),e("div",[e("span",[t._v(t._s(t.invoiceInfo.url))])])]),e("div",{staticClass:"d-flex mg-y-20"},[e("div",{staticStyle:{color:"#999",width:"150px","text-align":"right","margin-right":"10px","white-space":"nowrap"}}),e("div",[e("div",[e("el-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.invoiceInfo.url,expression:"invoiceInfo.url",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:t.onCopy,expression:"onCopy",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:t.onError,expression:"onError",arg:"error"}],attrs:{size:"mini",type:"success"}},[t._v(t._s(t.$t("myinvoice.shareCopy")))])],1)])])]),e("el-tab-pane",{attrs:{name:"shareWeixin"}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("i",{staticClass:"iconfont icon-shejiao"}),t._v(" "+t._s(t.$t("myinvoice.showApp")))]),e("div",[e("div",{staticClass:"d-flex mg-y-20"},[e("div",{staticStyle:{color:"#999",width:"150px","text-align":"right","margin-right":"10px","white-space":"nowrap"}},[t._v(" "+t._s(t.$t("myinvoice.setTitle"))+" ")]),e("div",{staticStyle:{width:"70%"}},[e("el-input",{attrs:{type:"text",size:"small"},on:{change:function(e){return t.saveRemark("2")}},model:{value:t.shareTitle,callback:function(e){t.shareTitle=e},expression:"shareTitle"}})],1)]),e("div",{staticClass:"d-flex mg-y-20 align-items-center"},[e("div",{staticStyle:{color:"#999",width:"150px","text-align":"right","margin-right":"10px","white-space":"nowrap"}},[t._v(" "+t._s(t.$t("myinvoice.setContent"))+" ")]),e("div",{staticStyle:{width:"70%"}},[e("el-input",{attrs:{type:"textarea",resize:"none",autosize:{minRows:3,maxRows:6},size:"small"},on:{change:function(e){return t.saveRemark("2")}},model:{value:t.shareDesc,callback:function(e){t.shareDesc=e},expression:"shareDesc"}})],1)]),e("div",{staticClass:"d-flex mg-y-20"},[e("div",{staticStyle:{color:"#999",width:"150px","text-align":"right","margin-right":"10px","white-space":"nowrap"}},[t._v(" "+t._s(t.$t("myinvoice.setType"))+" ")]),e("div",{staticClass:"d-flex",staticStyle:{width:"70%"}},[e("div",{staticClass:"skype-share",staticStyle:{"margin-right":"30px"},attrs:{"data-href":t.shareTitle+t.shareDesc,"data-lang":"en-US","data-text":t.invoiceInfo.url,"data-style":"large"}}),e("div",[e("el-tooltip",{attrs:{placement:"bottom"}},[e("div",{attrs:{slot:"content"},slot:"content"},[e("p",{staticClass:"tx-center mg-b-10"},[t._v(" "+t._s(t.$t("myinvoice.scan"))+" ")]),e("img",{attrs:{src:t.invoiceInfo.qrcodeBase64,width:"130"}}),e("img",{staticStyle:{position:"absolute",left:"50%",top:"50%","margin-left":"-15px","margin-top":"-4px"},attrs:{src:"images/weixin.png",width:"30px"}})]),e("a",{staticClass:"share-weixin",attrs:{href:"javascript:;"}},[e("i",{staticClass:"fa fa-weixin"}),t._v(" "+t._s(t.$t("myinvoice.share"))+" ")])])],1)])])])])],1)],e("el-divider"),e("div",{staticClass:"dialog-footer d-flex justify-content-between",attrs:{slot:"footer"},slot:"footer"},[e("div",[e("el-button",{directives:[{name:"show",rawName:"v-show",value:"shareWeixin"==t.activeShareName,expression:"activeShareName == 'shareWeixin'"}],attrs:{size:"small",type:"primary",plain:""},on:{click:function(e){return t.saveRemark("1")}}},[t._v(t._s(t.$t("myinvoice.reset")))])],1),e("div",[e("el-button",{attrs:{size:"small"},on:{click:function(e){t.sendInvoiceOpen=!1}}},[t._v(t._s(t.$t("myinvoice.discard")))]),e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.invoicePreview(t.invoiceInfo.url)}}},[t._v(t._s(t.$t("myinvoice.previewInvocie")))])],1)])],2),e("el-dialog",{attrs:{title:t.$t("myinvoice.您当前采购订单中有 0 元供货价的商品"),visible:t.dialogZeroAlert.isShow,width:"600px"},on:{"update:visible":function(e){return t.$set(t.dialogZeroAlert,"isShow",e)}}},[e("div",{staticStyle:{padding:"0 20px"}},[e("div",{staticClass:"mg-b-10"},[t._v(" "+t._s(t.$t("myinvoice.您当前采购订单中有 0 元供货价的商品"))+"： ")]),t._l(t.dialogZeroAlert.items,(function(i){return e("div",{key:i.id,staticStyle:{"margin-bottom":"5px","padding-left":"15px",color:"#909399"}},[t._v(" "+t._s(i.codeName)+" - "+t._s(i.sku)+" × "+t._s(i.quantity)+" ")])})),e("div",{staticClass:"mg-t-30"},[e("el-alert",{attrs:{title:t.$t("myinvoice.确定要发送当前发票发送给客户吗"),type:"warning",closable:!1}})],1)],2),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small"},on:{click:function(e){t.dialogZeroAlert.isShow=!1}}},[t._v(" "+t._s(t.$t("myinvoice.我再看看"))+" ")]),e("el-button",{attrs:{size:"small",type:"primary",loading:t.dialogZeroAlert.loading},on:{click:function(e){return t.toSendInvoice(t.dialogZeroAlert.invoice,!0)}}},[t._v(" "+t._s(t.$t("myinvoice.确定"))+" ")])],1)]),e("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.dialogDeliverImport.loading,expression:"dialogDeliverImport.loading"}],attrs:{title:t.$t("invoice.shippinginformation"),visible:t.dialogDeliverImport.isShow,width:"600px"},on:{"update:visible":function(e){return t.$set(t.dialogDeliverImport,"isShow",e)}}},[e("div",{staticClass:"download-xsl"},[e("el-alert",{staticStyle:{width:"100%"},attrs:{type:"warning",closable:!1}},[e("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"space-between"}},[e("span",[t._v(t._s(t.$t("invoice.templateprovided")))]),e("el-button",{staticStyle:{padding:"0"},attrs:{type:"text"},on:{click:t.downloadFile}},[t._v(t._s(t.$t("invoice.template")))])],1)])],1),e("div",{staticStyle:{"margin-top":"40px",padding:"0 20px"}},[e("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel","auto-upload":!1,"file-list":t.dialogDeliverImport.uploadfileList,"on-change":t.handleUploadChange}},[e("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v(t._s(t.$t("invoice.fileSelect")))]),t.dialogDeliverImport.invoiceInfo&&1!=t.dialogDeliverImport.invoiceInfo.payStatus?[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top"}},[e("div",{attrs:{slot:"content"},slot:"content"},[t._v(" "+t._s(t.$t("invoice.proceeding"))+" ")]),e("el-button",{staticStyle:{"background-color":"#b3e19d","border-color":"#b3e19d",cursor:"not-allowed","margin-left":"10px"},attrs:{size:"small",type:"success"}},[t._v(t._s(t.$t("invoice.shippinginformation")))])],1)]:[e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:t.submitUpload}},[t._v(t._s(t.$t("invoice.shippinginformation")))])],e("div",{staticClass:"el-upload__tip mg-y-15",staticStyle:{"margin-top":"20px"},attrs:{slot:"tip"},slot:"tip"},[e("p",[t._v(t._s(t.$t("invoice.shippinginformation1")))]),e("p",[t._v(t._s(t.$t("invoice.shippinginformation2")))])])],2)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small"},on:{click:function(e){t.dialogDeliverImport.isShow=!1}}},[t._v(" "+t._s(t.$t("myinvoice.关闭"))+" ")])],1)]),e("DialogCancelInvoice",{attrs:{data:t.dialogCancelInvoice},on:{setCancel:t.setCancel}}),e("el-backtop",{staticClass:"goto-top",attrs:{target:".main-scroll  .el-scrollbar__wrap",right:20,bottom:20}})],1)},a=[],o=(i("14d9"),i("3c65"),i("b76a")),r=i.n(o),l=i("ccff"),n={props:["cancelStatus","activeName"],data(){return{loading:!1,selectLoading:!1,tableHeight:400,pageSize:[10,20,50,100],page:this.$route.query.page?Number(this.$route.query.page):1,rowsPerPage:localStorage.getItem(this.$route.name+"RowsPerPage")?Number(localStorage.getItem(this.$route.name+"RowsPerPage")):10,totalCount:0,totalPage:0,getShopNameInput:{loading:!1,shopList:[]},selectArr:[],status:"",code:"",filterParams:{aIdName:"",idName:"",relationshipId:"",code:"",accountId:"",trackNumberIpt:"",trackNumber:"",codeNameIpt:"",codeName:"",timeOption:[{label:this.$t("myinvoice.createdTime"),value:"timeCreated"},{label:this.$t("myinvoice.confirmedTime"),value:"timePaid"},{label:this.$t("myinvoice.downloadTime"),value:"timeApiGet"},{label:this.$t("myinvoice.paidTime"),value:"timeRead"}],timeFilter:"",date:[],dateFrom:"",dateTo:""},filterParamsDefault:"{}",tableData:[],exportItem:"",exportInvoiceType:"",sendInvoiceOpen:!1,activeShareName:"shareLink",shareTitle:"",shareDesc:"",dialogZeroAlert:{isShow:!1,loading:!1,items:[],invoice:null},dialogZeroAlertDefault:"{}",showItemPrice:!0,showCustom:!1,invoiceInfo:"",modalCustomExport:{tags:[],selectedTitles:[],unselectedTitles:[]},modalCustomExportDefault:"",innerVisible:!1,dialogDeliverImport:{isShow:!1,loading:!1,invoiceInfo:null,uploadfileList:[]},dialogDeliverImportDefault:"{}",dialogCancelInvoice:{loading:!1,isShow:!1,item:null,stopReason:""},dialogCancelInvoiceDefault:"{}",checkboxArr:[],cid:""}},components:{draggable:r.a,DialogCancelInvoice:l["a"]},created(){this.getStatus()},mounted(){this.checkboxArr=[],this.dialogCancelInvoiceDefault=JSON.stringify(this.dialogCancelInvoice),this.filterParamsDefault=JSON.stringify(this.filterParams),this.dialogZeroAlertDefault=JSON.stringify(this.dialogZeroAlert),this.modalCustomExportDefault=JSON.stringify(this.modalCustomExport),this.dialogDeliverImportDefault=JSON.stringify(this.dialogDeliverImport),this.$route.params.id?(this.filterParams.idName=this.$route.params.customerName?this.$route.params.customerName:"",this.filterParams.relationshipId=this.$route.params.id?this.$route.params.id:"",this.selectArr=[{id:this.$route.params.id,customerName:this.$route.params.customerName}],this.filterGetItem("relationshipId")):this.$nextTick(()=>{this.getItems()})},beforeDestroy(){},watch:{activeName(){this.checkboxArr=[]},$route:"gotoPage",cancelStatus:"gotoPage",checkboxArr:{handler(){this.$emit("checkedArr",this.checkboxArr)},deep:!0}},methods:{openConfirmSetPayed(t){this.$confirm(this.$t("myinvoice.是否要确认收到款项？"),"",{type:"warning",confirmButtonText:this.$t("myinvoice.确认"),cancelButtonText:this.$t("myinvoice.取消")}).then(()=>{this.confirmSetPayed(t)}).catch(()=>{})},checkItem(t){this.cid=t.relationshipId},checkDisabled(t){return!t.relationshipId||!!this.checkboxArr.length&&t.relationshipId!=this.cid},setPriceConfirm(t){this.$confirm(`\n        <p>${this.$t("invoice.是否要确认完成报价?")}</p>\n        <p>\n          <span style="margin-right: 5px; color: #909399;">${this.$t("myinvoice.采购订单编号")}: </span> ${t.code}\n        </p>\n        <p>\n          <span style="margin-right: 5px; color: #909399;">${this.$t("invoice.采购单金额")}: </span> US$ ${t.realAmount}\n        </p>\n        <p>\n          <span style="margin-right: 5px; color: #909399;">${this.$t("invoice.采购单付款方式")}: </span>\n          ${t.paymentType?this.$t(this.$dict.paymentType[t.paymentType].text):"---"}\n        </p>\n        `,"",{dangerouslyUseHTMLString:!0,confirmButtonText:this.$t("invoice.确定"),cancelButtonText:this.$t("invoice.取消"),type:"warning"}).then(()=>{this.loading=!0,this.$apiCall("api.Invoice.setPriceConfirm",{invoiceId:t.id},t=>{"9999"==t.ErrorCode?(this.$elementMessage(this.$t("invoice.确认完成报价成功"),"success"),this.getItems(!0)):this.$elementMessage(t.Message,"error")})})},handleCommandStatus2(t){"a"==t.type&&this.handleCommand({row:t.data,command:"a"}),"c"==t.type&&this.cancelInvoice(t.data)},submitUpload(){if(!this.dialogDeliverImport.uploadfileList.length)return void this.$elementMessage(this.$t("invoice.selectfile"),"error");this.dialogDeliverImport.loading=!0;let t=this.dialogDeliverImport.uploadfileList[0].raw;0==$("#ifilePro").length&&$("body").append('<iframe id="ifilePro" style="display:none"></iframe>');let e=t=>{document.getElementById("ifilePro").src=t},i="api.Invoice.deliverImport",s={invoiceId:this.dialogDeliverImport.invoiceInfo.id,"@file":t};this.$apiCall(i,s,t=>{this.dialogDeliverImport.loading=!1,"9999"==t.ErrorCode?(this.dialogDeliverImport.isShow=!1,this.$elementMessage(this.$t("invoice.successImport"),"success"),this.getItems(!0),e(t.Data.Results.file)):this.$elementMessage(t.Message,"error")})},handleUploadChange(t){this.dialogDeliverImport.uploadfileList=[],this.dialogDeliverImport.uploadfileList.push(t)},downloadFile(){let t="./file/orders_impor.xlsx";0==$("#downloadFile").length&&$("body").append('<iframe id="downloadFile" style="display:none"></iframe>');let e=t=>{document.getElementById("downloadFile").src=t};e(t)},openDeliverImport(t){this.dialogDeliverImport=JSON.parse(this.dialogDeliverImportDefault),this.dialogDeliverImport.isShow=!0,this.dialogDeliverImport.invoiceInfo=t},confirmSetPayed(t){t.submitLoading=!0,this.$apiCall("api.Invoice.setPayed",{invoiceId:t.id},t=>{"9999"==t.ErrorCode&&(this.$elementMessage(this.$t("invoice.successConfirm"),"success"),this.getItems(!0))})},clearFilter(t){switch(t){case"code":this.filterParams.code=this.code="";break;case"relationshipId":this.filterParams.relationshipId=this.filterParams.idName="";break;case"accountId":this.filterParams.accountId=this.filterParams.aIdName="";break;case"trackNumber":this.filterParams.trackNumber=this.filterParams.trackNumberIpt="";break;case"codeName":this.filterParams.codeName=this.filterParams.codeNameIpt="";break;case"date":this.filterParams.date=[],this.filterParams.dateFrom="",this.filterParams.dateTo="",this.filterParams.timeFilter="";break;default:this.code="",this.filterParams=JSON.parse(this.filterParamsDefault);break}"change"!=t&&this.gotoPage()},filterGetItem(t){switch(t){case"code":this.filterParams.code=this.code;break;case"relationshipId":this.selectArr.forEach(t=>{t.id==this.filterParams.relationshipId&&(this.filterParams.idName=t.customerName)});break;case"accountId":this.getShopNameInput.shopList.forEach(t=>{t.id==this.filterParams.accountId&&(this.filterParams.aIdName=t.shopName)});break;case"trackNumber":this.filterParams.trackNumber=this.filterParams.trackNumberIpt;break;case"codeName":this.filterParams.codeName=this.filterParams.codeNameIpt;break;default:this.filterParams.code=this.code,this.filterParams.trackNumber=this.filterParams.trackNumberIpt,this.filterParams.codeName=this.filterParams.codeNameIpt;break}this.filterParams.codeName&&(this.filterParams.codeName=this.filterParams.codeName.replace(/#/g,"")),this.gotoPage()},showDateText(t){let e="";return this.filterParams.timeOption.forEach(i=>{i.value==t&&(e=i.label)}),e},dateChange(){this.filterParams.date.length>1&&(this.filterParams.dateFrom=this.$moment(this.filterParams.date[0]).format("YYYY-MM-DD"),this.filterParams.dateTo=this.$moment(this.filterParams.date[1]).format("YYYY-MM-DD"),this.filterGetItem())},getShopName(t){this.getShopNameInput.shopList=[],t&&(this.getShopNameInput.loading=!0,this.$apiCall("api.Invoice.findStoreByVendor",{shopName:t},t=>{this.getShopNameInput.loading=!1,9999==t.ErrorCode?this.getShopNameInput.shopList=t.Data.Results:this.$message({message:t.Message,type:"error"})}))},remoteMethodCustom(t){this.selectArr=[],t&&(this.selectLoading=!0,this.$apiCall("api.Relationship.findByVendor",{name:t},t=>{this.selectLoading=!1,9999==t.ErrorCode?this.selectArr=t.Data.Results:this.$message({message:t.Message,type:"error"})}))},onCopy(t){this.$elementMessage(this.$t("successfullyToClipboard"),"success")},onError(t){this.$elementMessage(this.$t("failedToClipboard"),"error")},saveRemark(t){this.$showLoading(),this.$apiCall("api.Invoice.saveRemark",{uniCode:this.invoiceInfo.uniCode,title:1==t?"":this.shareTitle,desc:1==t?"":this.shareDesc},t=>{this.$hideLoading(),"9999"==t.ErrorCode?(this.shareTitle=t.Data.Results.title,this.shareDesc=t.Data.Results.desc):(this.$elementMessage(t.Message,"error"),"1002"!=t.ErrorCode&&"1003"!=t.ErrorCode||this.$userFailure(this))})},invoicePreview(t){let e=window.open("/blank.html","invoicePreview");e.location.href=t},openSkype(){let t=0,e=setInterval(()=>{(function(t,e,i){t.loadSkypeWebSdkAsync=t.loadSkypeWebSdkAsync||function(t){var s,a=e.getElementsByTagName(i)[0];e.getElementById(t.id)||(s=e.createElement(i),s.id=t.id,s.src=t.scriptToLoad,s.onload=t.callback,a.parentNode.insertBefore(s,a))};var s={scriptToLoad:"https://swx.cdn.skype.com/shared/v/latest/skypewebsdk.js",id:"skype_web_sdk"};t.loadSkypeWebSdkAsync(s)})(window,document,"script"),t++,t>10&&clearInterval(e)},300)},toSendInvoice(t,e){this.showItemPrice="1"==t.showItemPrice,this.sendInvoiceOpen=!0,this.activeShareName="shareLink",e&&(this.dialogZeroAlert.loading=!0),this.$apiCall("api.Invoice.getShareUrl",{invoiceId:t.id},t=>{this.$hideLoading(),"9999"==t.ErrorCode?(this.invoiceInfo=t.Data.Results,this.shareTitle=this.invoiceInfo.remark?this.invoiceInfo.remark.title:"",this.shareDesc=this.invoiceInfo.remark?this.invoiceInfo.remark.desc:"",this.sendInvoiceOpen=!0,this.activeShareName="shareLink",e&&(this.dialogZeroAlert.isShow=!1)):(this.$elementMessage(t.Message,"error"),"1002"!=t.ErrorCode&&"1003"!=t.ErrorCode||this.$userFailure())})},sendInvoice(t){t.submitLoading=!0,this.$apiCall("api.Invoice.checkItemPrice",{invoiceId:t.id},e=>{if(t.submitLoading=!1,"9999"==e.ErrorCode){let i=e.Data.Results;i.noSkuArr.length||i.nullPriceArr.length||i.zeroPriceArr.length?(this.dialogZeroAlert=JSON.parse(this.dialogZeroAlertDefault),this.dialogZeroAlert.items=i.noSkuArr.concat(i.noSkuArr,i.nullPriceArr,i.zeroPriceArr),this.dialogZeroAlert.isShow=!0,this.dialogZeroAlert.invoice=t):this.toSendInvoice(t)}else this.$elementMessage(e.Message,"error")})},changeShowItemPrice(){this.$apiCall("api.Invoice.setShowPrice",{uniCode:this.invoiceInfo.uniCode},t=>{"9999"==t.ErrorCode?this.getItems(!0):(this.showItemPrice=!this.showItemPrice,this.$elementMessage(t.Message,"error"))})},selectTitle(t){this.modalCustomExport.selectedTitles.push(this.modalCustomExport.unselectedTitles[t]),this.modalCustomExport.unselectedTitles.splice(t,1)},removeTitle(t){this.modalCustomExport.unselectedTitles.unshift(this.modalCustomExport.selectedTitles[t]),this.modalCustomExport.selectedTitles.splice(t,1)},getOrderCnt(t){!this.tableData.length||this.tableData.length<t+1||"undefined"==typeof this.tableData[t]||this.$apiCall("api.Invoice.getSummary",{invoiceId:this.tableData[t].id},e=>{"9999"==e.ErrorCode?"undefined"!=typeof this.tableData[t]&&this.$set(this.tableData[t],"orderStatusCnt",e.Data.Results):this.$elementMessage(e.Message,"error"),t++,this.getOrderCnt(t)})},getItems(t,e){this.loading=!0;let i={page:this.page,rowsPerPage:this.rowsPerPage,status:this.status,code:this.filterParams.code,relationshipId:this.filterParams.relationshipId,accountId:this.filterParams.accountId,trackNumber:this.filterParams.trackNumber,codeName:this.filterParams.codeName,timeFilter:this.filterParams.timeFilter,dateFrom:this.filterParams.dateFrom,dateTo:this.filterParams.dateTo};"abnormal"==this.status&&(i.status="",i.isAbnormal="1"),2==this.cancelStatus&&(i.status="9"),this.$apiCall("api.Invoice.findByVendor",i,t=>{if(9999==t.ErrorCode){this.loading=!1;let[i,s]=[t.Data.Results,t.Data.Pagination];this.tableData=i.map(t=>(t.loadCnt=!1,t.cnt=null,t.cntText="",t.submitLoading=!1,t.orderStatusCnt=null,t)),this.totalCount=Number(s.totalCount),this.totalPage=Number(s.totalPage),this.getOrderCnt(0),this.$emit("getNum"),"waitingForOffer"==this.$route.name&&this.$route.params.saveCode&&this.$route.params.code&&(this.$route.params.saveCode=!1,this.tableData.some(t=>{if(t.code==this.$route.params.code)return this.gotoInvoice(t),!0})),e||(this.$root.$children[0].$refs.mainScroll.wrap.scrollTop=0)}else this.$message({message:t.Message,type:"error"})})},getStatus(){switch(this.$route.name){case"waitingForOffer":this.status="1";break;case"waitingForPayment":this.status="2";break;case"waitingForConfirm":this.status="3";break;case"waitingForDelivery":this.status="45";break;case"fullDeliveryOrder":this.status="6";break;case"abnormal":this.status="abnormal";break;default:this.status="";break}},cntOnError(){this.$elementMessage(this.$t("myinvoice.copyFailed"),"error")},cntOnCopy(){this.$elementMessage(this.$t("myinvoice.copyItems"),"success")},getCntCountry(t){t.cnt||(t.loadCnt=!0),this.$apiCall("api.Invoice.getItemsCountry",{invoiceId:t.id},e=>{if(t.loadCnt=!1,"9999"==e.ErrorCode){t.cnt=e.Data.Results;let i=`${this.$t("myinvoice.总共采购商品数：")}${t.totalCnt},`;Object.keys(e.Data.Results).forEach(t=>{i+=`${e.Data.Results[t].name}: ${e.Data.Results[t].cnt},`}),t.cntText=i.slice(0,i.length-1)}})},handleCommand(t){this.exportItem=t.row,this.exportInvoiceType=t.command;let e=()=>{},i="";switch(t.command){case"a":this.$router.push({name:"importData",query:{rid:this.exportItem.relationshipId,id:this.exportItem.id}});break;case"b":this.$showLoading(),0==$("#ifilePro").length&&$("body").append('<iframe id="ifilePro" style="display:none"></iframe>'),e=t=>{document.getElementById("ifilePro").src=t},i="b"==this.exportInvoiceType?"api.Invoice.exportInvoice":"api.Invoice.exportOrder",this.$apiCall(i,{invoiceId:this.exportItem.id,type:"excel"},t=>{this.$hideLoading(),"9999"==t.ErrorCode?(this.$elementMessage(this.$t("myinvoice.exportSuccess"),"success"),e(t.Data.Results.file)):(this.$elementMessage(t.Message,"error"),"1002"!=t.ErrorCode&&"1003"!=t.ErrorCode||this.$userFailure(this))});break;case"c":this.setExportOnly("c");break}},saveCustomExport(t){this.saveCustomExportSettingOnly(t)},saveCustomExportSettingOnly(t){if(!this.modalCustomExport.selectedTitles.length)return this.$elementMessage(this.$t("myinvoice.leastOne"),"error"),!1;if(this.modalCustomExport.selectedTitles.some(t=>!t.name))return this.$elementMessage(this.$t("myinvoice.notEmpty"),"error"),!1;this.$showLoading();let e={};this.modalCustomExport.selectedTitles.forEach(t=>{e[t.key]=t.name});let i="b"==this.exportInvoiceType?"api.Invoice.saveInvoiceTitle":"api.Invoice.saveExportTitle";this.$apiCall(i,{titles:e},i=>{if("9999"==i.ErrorCode)if(t>0){0==$("#ifilePro").length&&$("body").append('<iframe id="ifilePro" style="display:none"></iframe>');let i=t=>{document.getElementById("ifilePro").src=t},s="b"==this.exportInvoiceType?"api.Invoice.exportInvoice":"api.Invoice.exportOrder";this.$apiCall(s,{titles:e,invoiceId:this.exportItem.id,type:1==t?"excel":"csv"},t=>{this.$hideLoading(),"9999"==t.ErrorCode?(this.innerVisible=!1,this.$elementMessage(this.$t("myinvoice.saveSettingAndExport"),"success"),i(t.Data.Results.file)):(this.$elementMessage(t.Message,"error"),"1002"!=t.ErrorCode&&"1003"!=t.ErrorCode||this.$userFailure(this))})}else this.$elementMessage(this.$t("myinvoice.saveSettingSuccess"),"success"),this.innerVisible=!1;else this.$hideLoading(),this.$elementMessage(i.Message,"error"),"1002"!=i.ErrorCode&&"1003"!=i.ErrorCode||this.$userFailure(this)})},setExportOnly(t){this.exportInvoiceType=t,this.loading=!0,this.showCustom=!1,this.modalCustomExport=JSON.parse(this.modalCustomExportDefault);let e="b"==this.exportInvoiceType?"api.Invoice.exportInvoiceTitle":"api.Invoice.exportTitle";this.$apiCall(e,{},t=>{if(this.loading=!1,"9999"==t.ErrorCode){for(var e in this.innerVisible=!0,t.Data.Results.default){let i={};i.key=e,i.orName=t.Data.Results.default[e],i.name=t.Data.Results.default[e],this.modalCustomExport.tags.push(i)}for(var e in t.Data.Results.titles){let i={};i.key=e,i.orName=t.Data.Results.titles[e],i.name=t.Data.Results.titles[e],this.modalCustomExport.selectedTitles.push(i)}this.modalCustomExport.tags.forEach(t=>{this.modalCustomExport.selectedTitles.some(e=>t.key==e.key)||this.modalCustomExport.unselectedTitles.unshift(t),this.modalCustomExport.selectedTitles.some(e=>{t.key==e.key&&this.$set(e,"orName",t.name)})})}else this.$elementMessage(t.Message,"error"),"1002"!=t.ErrorCode&&"1003"!=t.ErrorCode||this.$userFailure(this)})},gotoInvoice(t){let e=this.$router.resolve({name:"Invoice",query:{uniCode:t.uniCode,fromPage:1}});window.open(e.href,"_blank")},toPage(t){t!=this.$route.query.page&&this.$router.push({query:{page:t}})},changePageSize(t){this.rowsPerPage=t,localStorage.setItem(this.$route.name+"RowsPerPage",t),this.getItems()},gotoPage(){this.getStatus(),this.page=this.$route.query.page?Number(this.$route.query.page):1,this.getItems()},setCancel(){this.dialogCancelInvoice.stopReason?(this.dialogCancelInvoice.loading=!0,this.$apiCall("api.Invoice.cancel",{invoiceId:this.dialogCancelInvoice.item.id,stopReason:this.dialogCancelInvoice.stopReason},t=>{this.dialogCancelInvoice.loading=!1,9999==t.ErrorCode?(this.dialogCancelInvoice.isShow=!1,this.$message({message:this.$t("myinvoice.cancelSuccess"),type:"success"}),this.getItems(!0)):this.$message({message:t.Message,type:"error"})})):this.$message({message:"作废原因必须填写",type:"error"})},cancelInvoice(t){this.dialogCancelInvoice=JSON.parse(this.dialogCancelInvoiceDefault),this.dialogCancelInvoice.isShow=!0,this.dialogCancelInvoice.item=t},exportDeliver(t,e){this.$showLoading(),this.$apiCall("api.Invoice.exportDeliverTitle",{invoiceId:t},i=>{if("9999"==i.ErrorCode){let a=[];for(var s in i.Data.Results.titles){let t={};t.key=s,t.orName=i.Data.Results.titles[s],t.name=i.Data.Results.titles[s],a.push(t)}let o={};a.forEach(t=>{o[t.key]=t.name});let r={invoiceId:t,titles:o,onlyDelivered:!0};2==e&&(r.onlyNotSync=!0),0==$("#ifilePro").length&&$("body").append('<iframe id="ifilePro" style="display:none"></iframe>');let l=t=>{document.getElementById("ifilePro").src=t};this.$apiCall("api.Invoice.exportDeliver",r,t=>{this.$hideLoading(),"9999"==t.ErrorCode?(this.$elementMessage(this.$t("myinvoice.下载成功"),"success"),l(t.Data.Results.file)):(this.$elementMessage(t.Message,"error"),"1002"!=t.ErrorCode&&"1003"!=t.ErrorCode||this.$userFailure())})}else this.$elementMessage(i.Message,"error"),"1002"!=i.ErrorCode&&"1003"!=i.ErrorCode||this.$userFailure()})}}},c=n,d=(i("bc80"),i("4c3f"),i("2877")),m=Object(d["a"])(c,s,a,!1,null,"1d97ee5a",null);e["default"]=m.exports},"573e":function(t,e,i){},"5d63":function(t,e,i){},bc80:function(t,e,i){"use strict";i("573e")},ccff:function(t,e,i){"use strict";var s=function(){var t=this,e=t._self._c;return e("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.data.loading,expression:"data.loading"}],attrs:{title:t.$t("myinvoice.confirmToCancel"),visible:t.data.isShow,width:"500px"},on:{"update:visible":function(e){return t.$set(t.data,"isShow",e)}}},[e("el-divider"),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:24}},[e("el-form",{ref:"form",attrs:{"label-width":"80px"}},[t.data.item?e("el-form-item",{attrs:{label:"订单号"}},[e("span",{staticStyle:{color:"#909399"}},[t._v(t._s(t.data.item.code))])]):t._e(),e("el-form-item",{attrs:{label:"作废原因"}},[e("el-input",{attrs:{type:"textarea"},model:{value:t.data.stopReason,callback:function(e){t.$set(t.data,"stopReason",e)},expression:"data.stopReason"}})],1)],1)],1)],1),e("el-divider"),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small"},on:{click:function(e){t.data.isShow=!1}}},[t._v(" "+t._s(t.$t("myinvoice.discard"))+" ")]),e("el-button",{attrs:{size:"small",type:"danger"},on:{click:t.setCancel}},[t._v(" "+t._s(t.$t("myinvoice.cancel"))+" ")])],1)],1)},a=[],o={props:["data"],methods:{setCancel(){this.$emit("setCancel")}}},r=o,l=i("2877"),n=Object(l["a"])(r,s,a,!1,null,null,null);e["a"]=n.exports}}]);