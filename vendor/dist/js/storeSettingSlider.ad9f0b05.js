(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["storeSettingSlider"],{7973:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"setting-page"},[t("el-scrollbar",{staticClass:"left"},[t("div",{staticClass:"content"},[t("h1",[t("el-link",{attrs:{icon:"el-icon-arrow-left",underline:!1},on:{click:e.goBack}},[e._v(e._s(e.$t("storeSetting.轮播图")))])],1),t("div",{staticClass:"images-box"},[t("h2",[e._v(e._s(e.$t("storeSetting.轮播图片"))+" "+e._s(e.setting.images.length)+" / 6")]),t("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.uploadLoading,expression:"uploadLoading"}],staticClass:"slider-img-card",attrs:{shadow:"hover","body-style":{padding:"0"}}},[t("ul",{staticClass:"slider-img-list"},[t("draggable",{attrs:{handle:".icon-draggable"},model:{value:e.setting.images,callback:function(t){e.$set(e.setting,"images",t)},expression:"setting.images"}},e._l(e.setting.images,(function(s,i){return t("li",{key:s.id,staticClass:"slider-img-item"},[t("div",{staticClass:"left"},[t("i",{staticClass:"iconfont icon-draggable"}),t("div",{staticClass:"img-wrap",style:{backgroundImage:`url(${s.src})`}}),t("div",{staticClass:"index"},[e._v("("+e._s(i+1)+")")])]),t("el-link",{attrs:{icon:"el-icon-delete",underline:!1,type:"danger"},on:{click:function(t){return e.delSliderItem(i)}}})],1)})),0)],1),t("el-link",{staticClass:"add-img",attrs:{underline:!1,disabled:e.setting.images.length>5},on:{click:e.openUploadImg}},[t("i",{staticClass:"el-icon-circle-plus"}),e._v(" "+e._s(e.$t("storeSetting.添加图片"))+" ")]),t("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"uploadSliderImg",accept:"image/jpeg, image/png, image/gif, image/webp"},on:{change:function(t){return e.Base64(t)}}})],1),t("p",{staticStyle:{padding:"0 5px",color:"#909399","font-size":"12px"}},[e._v("建议尺寸 1920px * 720px")])],1),t("div",{staticClass:"setting-box"},[t("h2",[e._v(e._s(e.$t("storeSetting.设置")))]),t("el-card",{attrs:{shadow:"hover"}},[t("div",{staticClass:"mg-b-15"},[t("el-select",{attrs:{size:"small"},model:{value:e.setting.size,callback:function(t){e.$set(e.setting,"size",t)},expression:"setting.size"}},e._l(e.sizeArr,(function(s){return t("el-option",{key:s.value,attrs:{label:e.$t(s.label),value:s.value}})})),1)],1),t("el-row",[t("el-col",{attrs:{span:8}},[e._v(e._s(e.$t("storeSetting.自动轮播")))]),t("el-col",{staticClass:"tx-right",attrs:{span:16}},[t("el-switch",{model:{value:e.setting.auto,callback:function(t){e.$set(e.setting,"auto",t)},expression:"setting.auto"}})],1)],1)],1)],1)])]),t("el-scrollbar",{ref:"rightBox",staticClass:"right"},[t("div",{staticClass:"content"},[t("demoHeader",{attrs:{data:e.$store.state.configJson.header,headerMenu:e.headerMenu}}),t("demoBody",{attrs:{data:e.setting,header:e.$store.state.configJson.header}}),t("demoFooter",{attrs:{setting:e.$store.state.configJson.footer}})],1)]),t("div",{staticClass:"action"},[t("el-button",{attrs:{type:"danger",size:"medium"},on:{click:e.del}},[e._v(e._s(e.$t("storeSetting.删除该组件")))]),t("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.save}},[e._v(e._s(e.$t("storeSetting.完成")))])],1)],1)},a=[],o=(s("14d9"),s("b76a")),r=s.n(o),n=s("826e"),l=s("8c3c"),g=s("db46"),d=(s("586c"),{data(){return{isSave:!1,uploadLoading:!1,headerMenu:[],exist:!1,setting:{cid:"",type:"slider",images:[],size:"1",auto:!0},sizeArr:this.$dict.storeSliderSizeArr}},components:{draggable:r.a,demoHeader:n["a"],demoBody:l["a"],demoFooter:g["a"]},created(){this.$apiCall("api.VendorShop.getShopConfig",{},e=>{9999==e.ErrorCode&&0!==e.Data.Results.length&&(e.Data.Results.header.activeMenu&&e.Data.Results.menu.forEach(t=>{t.id==e.Data.Results.header.activeMenu&&(this.headerMenu=t)}),this.$store.commit("getShopConfig",e.Data.Results),this.$store.state.configJson.sort.forEach(e=>{e.cid==this.$route.query.cid&&(this.exist=!0,this.setting=JSON.parse(JSON.stringify(e))),this.$nextTick(()=>{this.$refs.rightBox.wrap.scrollTop=document.getElementById("row"+this.$route.query.cid).offsetTop})}),this.exist||(this.setting={cid:this.$route.query.cid,type:"slider",images:[],size:"1",auto:!0},this.exist=!0,this.$store.commit("addStoreComponent",this.setting)))})},beforeRouteLeave(e,t,s){if(this.isSave)s();else{let e=confirm(this.$t("logistics.当前页面还未保存，确定要离开吗?"));e?s():s(!1)}},methods:{goBack(){this.$router.push({name:"storeSettingMain"})},del(){this.isSave=!0,this.$store.commit("delComponent",this.setting.cid),this.setting=JSON.parse(JSON.stringify(this.$store.state.configJson)),this.$apiCall("api.VendorShop.setShopConfig",{configJson:JSON.stringify(this.$store.state.configJson)},e=>{9999==e.ErrorCode?(this.$elementMessage("删除成功","success"),this.$router.replace({name:"storeSettingMain"})):this.$message({message:e.Message,type:"error"})})},save(){this.isSave=!0,this.exist?this.$store.commit("setStoreComponent",this.setting):this.$store.commit("addStoreComponent",this.setting),this.$apiCall("api.VendorShop.setShopConfig",{configJson:JSON.stringify(this.$store.state.configJson)},e=>{9999==e.ErrorCode?this.$elementMessage(this.$t("storeSetting.保存成功"),"success"):this.$message({message:e.Message,type:"error"})})},delSliderItem(e){this.setting.images.splice(e,1)},uploadImgBase64(e,t){this.uploadLoading=!0,this.$apiCall("api.Comment.uploadImg",{imgUrlBase64:e,ext:t},e=>{if(document.getElementById("uploadSliderImg").value="",9999==e.ErrorCode){let t=new Image;t.src=e.Data.Results.imgUrl,t.onload=()=>{this.uploadLoading=!1,this.setting.images.push({id:(new Date).getTime(),src:e.Data.Results.imgUrl,width:t.width,height:t.height})}}else this.$message({message:e.Message,type:"error"})})},Base64(e){if(e.target.value){if(e.target.files[0].size/1024/1024>1)return this.$message({message:this.$t("category.上传文件不能大于1MB"),type:"error"}),void(e.target.value="");let t=new FileReader,s=new Image,i="";t.onload=e=>{s.src=e.target.result;let t=e.target.result.match(/data:image\/(.*);base64,.*/);i=t[1],this.uploadImgBase64(e.target.result.split(",").pop(),i)},t.readAsDataURL(e.target.files[0])}},openUploadImg(){document.getElementById("uploadSliderImg").click()}}}),c=d,h=(s("7ccd"),s("2877")),m=Object(h["a"])(c,i,a,!1,null,"46ab7145",null);t["default"]=m.exports},"7ccd":function(e,t,s){"use strict";s("93ec")},"93ec":function(e,t,s){}}]);