(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["products"],{"462c":function(t,e,s){},b917:function(t,e,s){"use strict";s("462c")},e6dc:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"contentpanel my-invoice-page"},[e("div",{ref:"pageHeader",staticClass:"pagetitle"},[e("div",{staticClass:"left d-flex align-items-center"},[e("div",{staticClass:"title",staticStyle:{"margin-right":"20px"}},[e("i",{staticClass:"el-icon-shopping-bag-1"}),e("h2",[t._v(t._s(t.$t("products.未合作商品报价")))])])]),e("div",{staticClass:"right"})]),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"pagebody"},[e("el-card",{staticClass:"mg-b-15"},[e("el-row",{staticClass:"mg-b-20",attrs:{gutter:15}},[e("el-col",{staticStyle:{position:"relative","z-index":"1"},attrs:{span:24}},[e("div",{ref:"pageFilter",staticClass:"page-filter"},[e("div",{staticClass:"d-flex"},[e("div",{staticClass:"d-flex mg-r-20"},[e("el-checkbox",{staticStyle:{"margin-bottom":"18px","margin-right":"10px"},attrs:{size:"mini"},on:{change:t.allChange},model:{value:t.allCheckedData,callback:function(e){t.allCheckedData=e},expression:"allCheckedData"}},[t._v(" "+t._s(t.$t("products.全选"))),t.isSelectItems?e("span",{staticStyle:{color:"#909399","font-size":"12px"}},[t._v("("+t._s(t.isSelectItems)+")")]):t._e()]),e("el-button",{staticStyle:{"margin-bottom":"18px"},attrs:{type:"primary",size:"mini",disabled:!t.isSelectItems},on:{click:function(e){return t.setOfferedBat()}}},[t._v(t._s(t.$t("products.批量报价")))]),e("el-button",{staticStyle:{"margin-bottom":"18px"},attrs:{type:"danger",size:"mini",disabled:!t.isSelectItems},on:{click:function(e){return t.deleteBat()}}},[t._v(t._s(t.$t("products.批量删除")))])],1),e("el-form",{attrs:{inline:!0,size:"mini"}},[e("el-form-item",{staticClass:"mg-r-5",attrs:{label:""}},[e("el-select",{attrs:{filterable:"",remote:"","remote-method":t.remoteMethodCustom,loading:t.selectLoading,placeholder:t.$t("products.请输入客户名")},on:{change:t.filterGetItem},model:{value:t.filterParams.relationshipId,callback:function(e){t.$set(t.filterParams,"relationshipId",e)},expression:"filterParams.relationshipId"}},t._l(t.selectArr,(function(t){return e("el-option",{key:t.id,attrs:{label:t.customerName,value:t.id}})})),1)],1),e("el-form-item",{staticClass:"mg-r-5",attrs:{label:""}},[e("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:t.$t("products.商品名称")},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.filterGetItem("name")}},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),e("el-form-item",{staticClass:"mg-r-5",attrs:{label:""}},[e("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:t.$t("products.我的SKU")},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.filterGetItem("sku")}},model:{value:t.sku,callback:function(e){t.sku=e},expression:"sku"}})],1),e("el-form-item",{staticClass:"mg-r-5",attrs:{label:""}},[e("el-select",{attrs:{placeholder:t.$t("products.选择状态")},on:{change:t.filterGetItem},model:{value:t.filterParams.status,callback:function(e){t.$set(t.filterParams,"status",e)},expression:"filterParams.status"}},[e("el-option",{attrs:{label:t.$t("products.全部状态"),value:""}}),t._l(t.statusArr,(function(t,s){return e("el-option",{key:s,attrs:{label:t.text,value:s}})}))],2)],1),e("el-form-item",[e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.filterGetItem("all")}}},[t._v(t._s(t.$t("products.筛选")))]),e("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.clearFilter()}}},[t._v(t._s(t.$t("products.清除")))])],1)],1)],1),e("el-row",{staticStyle:{"margin-top":"-5px","margin-bottom":"5px"}},[e("el-col",{attrs:{span:24}},[t.filterParams.relationshipId?e("el-tag",{staticClass:"mg-r-10",attrs:{size:"mini",closable:""},on:{close:function(e){return t.clearFilter("relationshipId")}}},[e("span",{staticStyle:{color:"#909399"}},[t._v(t._s(t.$t("products.客户名称"))+"：")]),t._v(" "+t._s(t.getRelationshipName(t.filterParams.relationshipId))+" ")]):t._e(),t.filterParams.name?e("el-tag",{staticClass:"mg-r-10",attrs:{size:"mini",closable:""},on:{close:function(e){return t.clearFilter("name")}}},[e("span",{staticStyle:{color:"#909399"}},[t._v(t._s(t.$t("products.商品名称"))+"：")]),t._v(" "+t._s(t.filterParams.name)+" ")]):t._e(),t.filterParams.sku?e("el-tag",{staticClass:"mg-r-10",attrs:{size:"mini",closable:""},on:{close:function(e){return t.clearFilter("sku")}}},[e("span",{staticStyle:{color:"#909399"}},[t._v(t._s(t.$t("products.我的SKU"))+"：")]),t._v(" "+t._s(t.filterParams.sku)+" ")]):t._e(),t.filterParams.status?e("el-tag",{staticClass:"mg-r-10",attrs:{size:"mini",closable:""},on:{close:function(e){return t.clearFilter("status")}}},[e("span",{staticStyle:{color:"#909399"}},[t._v(t._s(t.$t("products.状态"))+"：")]),e("span",{style:{color:t.statusArr[t.filterParams.status].color}},[t._v(t._s(t.statusArr[t.filterParams.status].text))])]):t._e()],1)],1)],1)]),e("el-row",{ref:"gridTable",staticStyle:{"padding-top":"15px",position:"relative","z-index":"0"},attrs:{gutter:10}},[t.items.length?t._e():e("el-col",{attrs:{span:24}},[e("p",{staticStyle:{"margin-top":"25px","font-size":"16px",color:"#909399","text-align":"center"}},[t._v(t._s(t.$t("products.没有商品")))])]),t._l(t.items,(function(s){return e("el-col",{key:s.id,staticClass:"mg-b-20",attrs:{sm:12,md:8,lg:6,xl:4}},[e("div",{staticClass:"product-box"},[e("div",{staticStyle:{position:"relative","padding-bottom":"100%","margin-bottom":"15px"}},[e("div",{staticClass:"check-bg"},[e("el-checkbox",{model:{value:s.checked,callback:function(e){t.$set(s,"checked",e)},expression:"item.checked"}})],1),e("el-image",{staticStyle:{position:"absolute",width:"100%",height:"100%",border:"1px #DCDFE6 solid"},attrs:{fit:"contain",src:s.imgUrl}},[e("div",{staticClass:"image-slot",staticStyle:{position:"relative"},attrs:{slot:"error"},slot:"error"},[e("i",{staticClass:"el-icon-picture-outline",staticStyle:{position:"absolute",top:"50%",left:"50%",color:"#909399",transform:"translate(-20%, -20%)","font-size":"36px"}})])])],1),e("div",{staticClass:"info"},[e("div",{staticClass:"name tx-ellipsis1",attrs:{title:s.name}},[t._v(t._s(s.name))]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"title"},[t._v(t._s(t.$t("products.客户名称"))+"：")]),e("span",[t._v(t._s(s.customerName))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"title"},[t._v(t._s(t.$t("products.近7/30天销量"))+"：")]),e("span",[t._v(t._s(s.saleCnt7)+" / "+t._s(s.saleCnt30))])]),s.editMode?e("div",{staticClass:"info-item",staticStyle:{"margin-bottom":"0"}},[e("el-input",{staticStyle:{"margin-right":"5px",width:"120px"},attrs:{placeholder:"SKU",size:"mini"},model:{value:s.editSku,callback:function(e){t.$set(s,"editSku",e)},expression:"item.editSku"}}),e("el-button-group",[e("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-check",loading:s.editLoading},on:{click:function(e){return t.saveEditSku(s)}}}),e("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-close"},on:{click:function(e){return t.canelEditSku(s)}}})],1)],1):e("div",{staticClass:"info-item",staticStyle:{"margin-bottom":"9px"}},[e("span",{staticClass:"title"},[t._v(t._s(t.$t("products.我的SKU编号"))+"：")]),e("span",{staticClass:"d-flex",staticStyle:{"padding-right":"5px"},attrs:{title:s.sku}},[e("span",{staticClass:"tx-ellipsis1 mg-r-5",staticStyle:{"max-width":"95px"}},[t._v(t._s(s.sku||"---"))]),e("div",{staticClass:"d-flex"},[e("a",{staticClass:"mg-r-5",attrs:{href:"javascript:;",title:t.$t("products.编辑")},on:{click:function(e){return t.editSku(s)}}},[e("i",{staticClass:"el-icon-edit"})]),s.sku?e("a",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:s.sku,expression:"item.sku",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:t.onCopy,expression:"onCopy",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:t.onError,expression:"onError",arg:"error"}],attrs:{href:"javascript:;",title:t.$t("products.复制")}},[e("i",{staticClass:"el-icon-document-copy"})]):t._e()])])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"title"},[t._v(t._s(t.$t("products.我的供货价"))+"：")]),e("span",[t._v(t._s(s.price?"$ "+s.price:"---"))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"title"},[t._v(t._s(t.$t("products.合作状态"))+"：")]),e("span",{style:{color:t.statusArr[s.status].color}},[t._v(t._s(t.statusArr[s.status].text))])])]),e("div",{staticClass:"action"},[e("el-button",{attrs:{disabled:"1"!=s.status,size:"mini",type:"primary"},on:{click:function(e){return t.setOfferedSingle(s)}}},[t._v(t._s(t.$t("products.我要报价")))]),e("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.deleteSingle(s)}}},[t._v(t._s(t.$t("products.删除")))])],1)])])}))],2)],1)],1),e("el-row",{ref:"pageFooter",attrs:{gutter:20}},[e("el-col",{staticClass:"d-flex justify-content-center",attrs:{span:24}},[e("div",[e("el-pagination",{attrs:{"current-page":t.page,background:!0,layout:"sizes, total, prev, pager, next, jumper","page-sizes":t.pageSizes,"page-size":t.rowsPerPage,total:Number(t.total)},on:{"current-change":t.toPage,"size-change":t.changePageSize}})],1)])],1)],1),e("el-dialog",{attrs:{width:"1000",title:1==t.dialogOffered.type?t.$t("products.批量报价"):t.$t("products.商品报价"),visible:t.dialogOffered.isShow},on:{"update:visible":function(e){return t.$set(t.dialogOffered,"isShow",e)}}},[e("div",{staticStyle:{padding:"0 20px"}},[e("el-table",{attrs:{data:t.dialogOffered.items,height:1==t.dialogOffered.type?460:"",stripe:""}},[e("el-table-column",{attrs:{label:t.$t("products.商品信息")},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",{staticClass:"table-pro"},[e("el-image",{staticStyle:{"margin-right":"15px","min-width":"80px",width:"80px",height:"80px",border:"1px #DCDFE6 solid"},attrs:{fit:"contain",src:s.row.imgUrl}},[e("div",{staticClass:"image-slot",staticStyle:{position:"relative"},attrs:{slot:"error"},slot:"error"},[e("i",{staticClass:"el-icon-picture-outline",staticStyle:{position:"absolute",top:"50%",left:"50%",color:"#909399",transform:"translate(-14%, -20%)","font-size":"32px"}})])]),e("div",{staticClass:"tx-ellipsis2",staticStyle:{"max-width":"250px"},attrs:{title:s.row.name}},[t._v(t._s(s.row.name))])],1)]}}])}),e("el-table-column",{attrs:{label:t.$t("products.近7/30天销量")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.saleCnt7)+" / "+t._s(e.row.saleCnt30)+" ")]}}])}),e("el-table-column",{attrs:{label:t.$t("products.我的SKU编号")},scopedSlots:t._u([{key:"default",fn:function(s){return["1"==s.row.status?e("el-input",{attrs:{placeholder:"SKU",size:"mini"},model:{value:s.row.sku,callback:function(e){t.$set(s.row,"sku",e)},expression:"scope.row.sku"}}):e("span",{staticClass:"text-th"},[t._v(t._s(s.row.sku))])]}}])}),e("el-table-column",{attrs:{label:t.$t("products.我的供货价(US $)")},scopedSlots:t._u([{key:"default",fn:function(s){return["1"==s.row.status?e("el-input-number",{attrs:{min:0,controls:!1,size:"mini"},model:{value:s.row.price,callback:function(e){t.$set(s.row,"price",e)},expression:"scope.row.price"}}):e("span",{staticClass:"text-th"},[t._v(t._s(s.row.price))])]}}])})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.saveOffered}},[t._v(t._s(t.$t("products.提交报价")))]),e("el-button",{attrs:{size:"small"},on:{click:function(e){t.dialogOffered.isShow=!1}}},[t._v(t._s(t.$t("products.关闭")))])],1)]),e("el-backtop",{staticClass:"goto-top",attrs:{target:".main-scroll  .el-scrollbar__wrap",right:20,bottom:20}})],1)},a=[],r=(s("14d9"),{data(){return{loading:!1,tableHeight:400,page:this.$route.query.page?Number(this.$route.query.page):1,pageSizes:[12,24,48,96],rowsPerPage:localStorage.getItem("productsRowsPerPage")?Number(localStorage.getItem("productsRowsPerPage")):12,items:[],total:0,totalPage:0,name:"",sku:"",filterParams:{relationshipId:"",name:"",status:"",sku:""},filterParamsDefault:"{}",selectArr:[],selectLoading:!1,statusArr:{1:{text:this.$t("products.尚未合作"),color:"#F56C6C"},2:{text:this.$t("products.我已报价"),color:"#E6A23C"},3:{text:this.$t("products.客户已确认"),color:"#67C23A"}},dialogOffered:{isShow:!1,loading:!1,items:[],type:1},dialogOfferedDefault:"{}",allCheckedData:!1}},computed:{allChecked(){let t=0;return this.items.forEach(e=>{e.checked&&t++}),!(!t||t!=this.items.length)},isSelectItems(){let t=0;return this.items.forEach(e=>{e.checked&&t++}),t}},watch:{allChecked(){this.allCheckedData=this.allChecked},$route:"gotoPage"},mounted(){this.$route.params.id?(this.filterParams.idName=this.$route.params.customerName?this.$route.params.customerName:"",this.filterParams.relationshipId=this.$route.params.id?this.$route.params.id:"",this.selectArr=[{id:this.$route.params.id,customerName:this.$route.params.customerName}],this.filterParams.status=1,this.getItem(),this.filterParams.status="",this.filterParams.idName="",this.filterParams.relationshipId=""):this.$nextTick(()=>{this.getItem()}),this.filterParamsDefault=JSON.stringify(this.filterParams),this.dialogOfferedDefault=JSON.stringify(this.dialogOffered),null!=this.$route.query.filterParams&&(this.filterParams.status=this.$route.query.filterParams.toString()),window.onresize=()=>{}},beforeDestroy(){window.onresize=()=>{}},methods:{onCopy(){this.$elementMessage(this.$t("successfullyToClipboard"),"success")},onError(){this.$elementMessage(this.$t("failedToClipboard"),"error")},allChange(){this.items.forEach(t=>{this.$set(t,"checked",this.allCheckedData)})},canelEditSku(t){this.$set(t,"editMode",!1)},saveEditSku(t){this.$set(t,"editLoading",!0),this.$apiCall("api.OfferItems.changeSku",{id:t.id,sku:t.editSku},e=>{this.$set(t,"editLoading",!1),this.$set(t,"editMode",!1),9999==e.ErrorCode?(this.$message({message:this.$t("products.SKU修改成功"),type:"success",offset:60}),this.getItem(!0)):this.$message({message:e.Message,type:"error",offset:60})})},editSku(t){this.$set(t,"editMode",!0),this.$set(t,"editSku",t.sku),this.$set(t,"editLoading",!1)},deleteItem(t){this.loading=!0,this.$apiCall("api.OfferItems.delete",{items:t},t=>{9999==t.ErrorCode?(this.$message({message:this.$t("products.商品删除成功"),type:"success",offset:60}),this.getItem(!0)):this.$message({message:t.Message,type:"error",offset:60})})},deleteSingle(t){this.$confirm(this.$t("products.是否要删除这个商品?"),this.$t("products.删除"),{confirmButtonText:this.$t("products.删除"),cancelButtonText:this.$t("products.取消"),type:"error"}).then(()=>{this.deleteItem([{id:t.id}])})},deleteBat(){if(!this.isSelectItems)return void this.$message({message:this.$t("products.请先选择商品"),type:"error",offset:60});let t=[];this.items.forEach(e=>{e.checked&&t.push({id:e.id})}),this.$confirm(this.$t("products.是否要删除选中的 {num} 个商品?",{num:t.length}),this.$t("products.删除"),{confirmButtonText:this.$t("products.删除"),cancelButtonText:this.$t("products.取消"),type:"error"}).then(()=>{this.deleteItem(t)})},saveOffered(){let t=0;if(this.dialogOffered.items.forEach(e=>{1==e.status&&t++}),!t)return void this.$message({message:this.$t("products.没有尚未报价的商品"),type:"error",offset:60});this.dialogOffered.loading=!0;let e=[],s=0;this.dialogOffered.items.forEach(t=>{"1"==t.status&&(e.push({id:t.id,sku:t.sku,price:t.price}),t.sku&&t.price||s++)}),s?this.$message({message:this.$t("products.SKU编号和供货价必须填写。供货价不能为零"),type:"error",offset:60}):this.$apiCall("api.OfferItems.setOffered",{items:e},t=>{this.dialogOffered.loading=!1,9999==t.ErrorCode?(this.getItem(!0),this.dialogOffered.isShow=!1,this.$message({message:this.$t("products.报价成功"),type:"success",offset:60})):this.$message({message:t.Message,type:"error",offset:60})})},setOfferedSingle(t){this.dialogOffered=JSON.parse(this.dialogOfferedDefault),this.dialogOffered.type=2,this.dialogOffered.isShow=!0,this.dialogOffered.items.push(JSON.parse(JSON.stringify(t)))},setOfferedBat(){this.isSelectItems?(this.dialogOffered=JSON.parse(this.dialogOfferedDefault),this.dialogOffered.isShow=!0,this.items.forEach(t=>{t.checked&&this.dialogOffered.items.push(JSON.parse(JSON.stringify(t)))})):this.$message({message:this.$t("products.请先选择商品"),type:"error",offset:60})},getRelationshipName(t){let e="";return this.selectArr.forEach(s=>{s.id==t&&(e=s.customerName)}),e},clearFilter(t){t||(this.selectArr=[],this.name="",this.sku="",this.filterParams=JSON.parse(this.filterParamsDefault)),"relationshipId"==t&&(this.selectArr=[],this.filterParams.relationshipId=""),"name"==t&&(this.name="",this.filterParams.name=""),"sku"==t&&(this.sku="",this.filterParams.sku=""),"status"==t&&(this.filterParams.status=""),1==this.$route.query.page?this.getItem():this.$router.push({query:{page:1}})},filterGetItem(t){"name"==t&&(this.filterParams.name=this.name),"sku"==t&&(this.filterParams.sku=this.sku),"all"==t&&(this.filterParams.name=this.name,this.filterParams.sku=this.sku),1==this.$route.query.page?this.getItem():this.$router.push({query:{page:1}})},getItem(t){this.loading=!0;let e={page:this.page,rowsPerPage:this.rowsPerPage,name:this.filterParams.name,relationshipId:this.filterParams.relationshipId,status:this.filterParams.status,sku:this.filterParams.sku};this.$apiCall("api.OfferItems.findByVendor",e,e=>{this.loading=!1,9999==e.ErrorCode?(this.items=[],e.Data.Results.forEach(t=>{t.checked=!1,t.editMode=!1,t.editLoading=!1,t.editSku="",this.items.push(t)}),this.total=Number(e.Data.Pagination.totalCount),this.totalPage=Number(e.Data.Pagination.totalPage),this.$nextTick(()=>{}),t||(this.$root.$children[0].$refs.mainScroll.wrap.scrollTop=0)):this.$message({message:e.Message,type:"error"})})},toPage(t){t!=this.$route.query.page&&this.$router.push({query:{page:t}})},changePageSize(t){this.rowsPerPage=t,localStorage.setItem("productsRowsPerPage",t),this.getItem()},gotoPage(){this.page=this.$route.query.page?this.$route.query.page:1,this.getItem()},remoteMethodCustom(t){this.selectArr=[],t&&(this.selectLoading=!0,this.$apiCall("api.Relationship.findByVendor",{name:t},t=>{this.selectLoading=!1,9999==t.ErrorCode?this.selectArr=t.Data.Results:this.$message({message:t.Message,type:"error"})}))}}}),l=r,o=(s("b917"),s("2877")),n=Object(o["a"])(l,i,a,!1,null,"fd85d944",null);e["default"]=n.exports}}]);