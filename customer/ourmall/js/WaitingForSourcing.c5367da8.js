(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["WaitingForSourcing"],{"0a95":function(e,t,i){var a=i("a25b"),s=i("c197"),r=i("349c"),l=i("1cc9"),o=TypeError,n=function(e){return function(t,i,n,c){a(i);var d=s(t),h=r(d),f=l(d),p=e?f-1:0,m=e?-1:1;if(n<2)while(1){if(p in h){c=h[p],p+=m;break}if(p+=m,e?p<0:f<=p)throw o("Reduce of empty array with no initial value")}for(;e?p>=0:f>p;p+=m)p in h&&(c=i(c,h[p],p,d));return c}};e.exports={left:n(!1),right:n(!0)}},1039:function(e,t,i){},3377:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen",value:e.loading,expression:"loading",modifiers:{fullscreen:!0}}],attrs:{"element-loading-background":"rgba(0, 0, 0, 0.3)"}},[t("div",{ref:"tablefilter"},[t("div",{staticClass:"d-flex",staticStyle:{"justify-content":"space-between","margin-bottom":"5px"}},[t("div",{staticClass:"left d-flex"},[t("div",{staticClass:"mg-r-10"},[t("el-checkbox",{attrs:{size:"small",disabled:e.tableData.some(e=>e.loading)},on:{change:e.changeAllChecked},model:{value:e.allChecked,callback:function(t){e.allChecked=t},expression:"allChecked"}},[t("span",{staticStyle:{"margin-right":"15px","font-size":"12px"}},[e._v("All ("+e._s(e.totalOrdersNum)+" / "+e._s(e.totalAllOrdersNum)+")")])]),t("el-select",{attrs:{filterable:"",size:"mini",placeholder:"My Vendor"},on:{change:function(t){return e.filterItems("vendor")}},model:{value:e.filterParams.vendorId,callback:function(t){e.$set(e.filterParams,"vendorId",t)},expression:"filterParams.vendorId"}},e._l(e.vendors,(function(e){return t("el-option",{key:e.id,attrs:{label:e.vendorName,value:e.id}})})),1)],1),t("div",{staticClass:"mg-r-10"},[t("el-cascader",{key:e.cascaderKey,attrs:{size:"mini",placeholder:"All my stores",options:e.options,props:{expandTrigger:"hover"}},on:{change:function(t){return e.filterItems("store")}},model:{value:e.filterParams.shopifyStore,callback:function(t){e.$set(e.filterParams,"shopifyStore",t)},expression:"filterParams.shopifyStore"}})],1),t("el-button-group",{staticClass:"mg-r-10",staticStyle:{"min-width":"420px"}},[t("el-popover",{attrs:{placement:"bottom",title:"",trigger:"click","popper-class":"d-block"},model:{value:e.popDateFilter,callback:function(t){e.popDateFilter=t},expression:"popDateFilter"}},[t("el-radio-group",{staticStyle:{"max-height":"200px"},on:{change:function(t){return e.filterItems("date")}},model:{value:e.filterParams.timeFilter,callback:function(t){e.$set(e.filterParams,"timeFilter",t)},expression:"filterParams.timeFilter"}},e._l(e.dateArr,(function(i,a){return t("el-radio",{key:a,attrs:{label:a}},[e._v(e._s(i))])})),1),6==e.filterParams.timeFilter?t("div",[t("el-date-picker",{attrs:{size:"mini","value-format":"yyyy-MM-dd",type:"daterange",align:"right","unlink-panels":"","range-separator":"-","start-placeholder":"Start","end-placeholder":"End"},on:{change:e.dateChange},model:{value:e.filterDate,callback:function(t){e.filterDate=t},expression:"filterDate"}})],1):e._e(),t("div",{staticClass:"d-flex justify-content-end"},[t("el-link",{attrs:{type:"danger",disabled:!e.filterParams.timeFilter},on:{click:function(t){return e.clearFilter("date")}}},[e._v("Clear")])],1),t("el-button",{attrs:{slot:"reference",size:"mini"},slot:"reference"},[e._v("Date Ranges"),t("i",{staticClass:"el-icon-caret-bottom el-icon--right"})])],1),t("el-popover",{attrs:{placement:"bottom",title:"",trigger:"click","popper-class":"d-block"},model:{value:e.popCodeFilter,callback:function(t){e.popCodeFilter=t},expression:"popCodeFilter"}},[t("div",{staticClass:"d-flex mg-b-10",staticStyle:{"justify-content":"space-between","font-size":"12px"}},[t("span",{staticClass:"mg-r-5"},[e._v("Order ID From: #")]),t("el-input-number",{staticStyle:{width:"100px"},attrs:{size:"mini",controls:!1,min:0,placeholder:"Number from"},model:{value:e.orderMin,callback:function(t){e.orderMin=t},expression:"orderMin"}})],1),t("div",{staticClass:"d-flex mg-b-10",staticStyle:{"justify-content":"space-between","font-size":"12px"}},[t("span",[e._v("Order ID To: #")]),t("el-input-number",{staticStyle:{width:"100px"},attrs:{size:"mini",controls:!1,min:0,placeholder:"Number to"},model:{value:e.orderMax,callback:function(t){e.orderMax=t},expression:"orderMax"}})],1),t("div",{staticClass:"d-flex justify-content-end"},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.tableSelect("range")}}},[e._v("Confirm")]),t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.tableSelect("remove")}}},[e._v("Reset")])],1),t("el-button",{attrs:{slot:"reference",size:"mini"},slot:"reference"},[e._v("Order ID Range"),t("i",{staticClass:"el-icon-caret-bottom el-icon--right"})])],1)],1),t("div",{staticStyle:{"min-width":"130px",height:"29px"}},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.filterItems()}}},[e._v("Filter")]),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.clearFilter()}}},[e._v("Clear")])],1)],1),t("div",{staticClass:"right"})]),t("div",{staticStyle:{"margin-bottom":"5px"}},[e.filterParams.vendorId?t("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(t){return e.clearFilter("vendor")}}},[e._v(e._s(e.filterParams.vendorName))]):e._e(),e.filterParams.shopifyStore.length?t("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(t){return e.clearFilter("store")}}},[e._v(e._s(e.shopifyStoreName))]):e._e(),e.filterParams.timeFilter?t("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(t){return e.clearFilter("date")}}},[e._v(" "+e._s(e.dateArr[e.filterParams.timeFilter])+" "),6==e.filterParams.timeFilter&&e.filterDate.length?t("span",[e._v(" "+e._s(e.filterDate[0])+"--"+e._s(e.filterDate[1])+" ")]):e._e()]):e._e(),e.filterParams.orderMin||e.filterParams.orderMax?t("el-tag",{attrs:{type:"info",size:"small",closable:""},on:{close:function(t){return e.tableSelect("remove")}}},[e._v(" ID Range: "),t("span",[e._v(e._s(e.filterParams.orderMin||"From"))]),e._v(" - "),t("span",[e._v(e._s(e.filterParams.orderMax||"To"))])]):e._e()],1)]),t("div",{staticClass:"table-wrap"},[e.tableData.length?t("vxe-list",{ref:"orderTree",staticClass:"my-tree",attrs:{height:e.tableHeight,data:e.tableData,"scroll-y":{gt:50}},scopedSlots:e._u([{key:"default",fn:function({items:i}){return e._l(i,(function(i){return t("div",{key:i._ID,staticClass:"sourcing-item"},[0===i._LEVEL?t("el-row",{class:[{l0:0===i._LEVEL},{vendor_close:!i._EXPAND}],staticStyle:{"box-sizing":"content-box",height:"32px"}},[t("el-col",{staticStyle:{height:"32px"},attrs:{span:24}},[t("div",{staticClass:"d-flex",staticStyle:{"padding-left":"15px",height:"32px","font-size":"15px"}},[t("a",{staticClass:"mg-r-10",attrs:{href:"javascript:;"},on:{click:function(t){return e.toggleTreeNode(i)}}},[t("i",{staticClass:"fa",class:i._EXPAND?"fa-minus-square":"fa-plus-square"})]),t("i",{staticClass:"mg-r-5 el-icon-user-solid"}),t("span",{staticClass:"mg-r-15"},[e._v(" "+e._s(i.vendorName)+" "),t("span",{staticStyle:{color:"#909399","font-size":"12px"}},[e._v(" "+e._s(i.vendorId?`${e.$root.$children[0].pName.a} ID: ${i.vendorId}`:"- Not joined")+" ")])]),e.selectedSkuNum(i)?t("span",{staticClass:"mg-r-15",staticStyle:{color:"#909399"}},[e._v("("+e._s(e.selectedSkuNum(i))+" orders selected)")]):e._e()])])],1):e._e(),1==i._LEVEL?t("el-row",{class:[{l1:1==i._LEVEL},{close_store:!i._EXPAND},{card_last:!i._EXPAND&&i.last}],staticStyle:{"box-sizing":"content-box",height:"32px","font-size":"13px"}},[t("el-col",{attrs:{span:1}},[t("div",{staticStyle:{height:"32px"}})]),t("el-col",{attrs:{span:23}},[t("div",{staticClass:"d-flex shop-wrap"},[i.children.length?t("a",{staticClass:"mg-r-10",attrs:{href:"javascript:;"},on:{click:function(t){return e.toggleTreeNode(i)}}},[t("i",{staticClass:"fa",class:i._EXPAND?"fa-minus-square":"fa-plus-square"})]):e._e(),t("el-checkbox",{staticStyle:{"margin-bottom":"0","margin-right":"10px"},on:{change:function(t){return e.storeAllChecked(i)}},model:{value:i.checked,callback:function(t){e.$set(i,"checked",t)},expression:"item.checked"}}),t("span",{staticClass:"mg-r-5"},[t("shopCate",{attrs:{items:i}}),e._v(" "+e._s(i.shopName)+" ")],1),e.selectedSkuNum(i)?t("span",{staticClass:"mg-r-15",staticStyle:{color:"#909399"}},[e._v("("+e._s(e.selectedSkuNum(i))+" orders selected)")]):t("span",{staticStyle:{color:"#909399"}},[e._v("(No order selected)")]),i.loading?t("i",{staticClass:"el-icon-loading"}):e._e()],1)])],1):e._e(),2==i._LEVEL?t("el-row",{class:[{l2:2==i._LEVEL},{card_last:i.storeLast&&i.last},{store_last:!i.storeLast&&i.last},{bg:!i.bg}],staticStyle:{"box-sizing":"content-box",height:"32px","font-size":"12px"}},[t("el-col",{attrs:{span:1}},[t("div",{staticStyle:{height:"28px"}})]),t("el-col",{staticClass:"",attrs:{span:23}},[t("div",{staticClass:"d-flex order-wrap"},[t("div",{staticStyle:{width:"150px"}},[t("el-checkbox",{staticStyle:{"margin-bottom":"0"},on:{change:function(t){return e.changeSkuChecked(i)}},model:{value:i.checked,callback:function(t){e.$set(i,"checked",t)},expression:"item.checked"}},[e._v(" "+e._s(i.codeName)+" "),i.note?t("span",{staticClass:"mg-l-5"},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:i.note,placement:"top"}},[t("i",{staticClass:"el-icon-info",staticStyle:{"font-size":"12px",width:"12px",color:"#5c6ac4"}})])],1):e._e()])],1),t("div",{staticStyle:{width:"230px"}},[t("span",[e._v(e._s(e.moment(i.timeCreated).format("ll [at] LTS")))])]),t("div",{staticClass:"tx-right",staticStyle:{width:"100px"}},[i.currency?t("span",[e._v(e._s(e.ce[i.currency]?e.ce[i.currency].symbol:i.currency)+" ")]):e._e(),e._v(" "+e._s(i.totalPrice)+" ")]),t("div",{staticStyle:{"padding-left":"15px",width:"250px"}},[t("fulfillMentStatusTag",{attrs:{fulfillmentStatus:i.fulfillmentStatus}})],1),t("div",{staticStyle:{width:"150px"}},[i.items?t("popItems",{attrs:{items:i.items,fulfillmentStatus:i.fulfillmentStatus}}):e._e()],1)])])],1):e._e()],1)}))}}],null,!1,1627922945)}):e._e(),e.tableData.length?e._e():t("div",{staticClass:"tx-center",staticStyle:{padding:"30px 0"},style:{height:e.tableHeight+"px"}},[t("span",{staticStyle:{color:"#909399","font-size":"12px"}},[e._v("No Data")])])],1),t("div",{ref:"tableFooter"},[e.tableData.length?t("div",{staticClass:"footer-wrap"},[t("div",{staticClass:"left"},[t("el-button",{attrs:{disabled:!e.purchaseNum,type:"danger",size:"mini"},on:{click:e.unAllocate}},[e._v(" Un-allocate selected products ")])],1),t("div",{staticClass:"right"},[t("div",{staticStyle:{"margin-right":"50px"}},[t("span",{staticStyle:{"margin-right":"5px",color:"#c0c4cc"}},[e._v("Total vendors:")]),e._v(" "+e._s(e.totalVendorsNum)+" ")]),t("div",{staticStyle:{"margin-right":"50px"}},[t("span",{staticStyle:{"margin-right":"5px",color:"#c0c4cc"}},[e._v("Total orders:")]),e._v(" "+e._s(e.totalOrdersNum)+" ")]),t("div",[t("el-button",{attrs:{disabled:!e.purchaseNum,type:"primary",size:"mini"},on:{click:e.openToGenInvoice}},[e._v(" Place "+e._s(e.purchaseNum)+" purchase orders ")])],1)])]):e._e()]),t("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogToGenInvoice.loading,expression:"dialogToGenInvoice.loading"}],attrs:{visible:e.dialogToGenInvoice.isShow,width:"500px"},on:{"update:visible":function(t){return e.$set(e.dialogToGenInvoice,"isShow",t)}}},[t("div",{staticClass:"dialog-to-invoice"},[t("div",{staticClass:"dialog-title"},[e._v(" You're going to place "),t("span",{staticClass:"tx-danger"},[e._v(e._s(e.purchaseNum))]),e._v(" orders to "+e._s(e.totalVendorsNum)+" vendors ")]),t("div",{staticClass:"dialog-text"},[e._v(" You can choose the payment method you can accept, we will submit your orders and options to your vendors ")]),t("div",{staticClass:"dialog-choose"},[t("el-checkbox-group",{model:{value:e.dialogToGenInvoice.paymentType,callback:function(t){e.$set(e.dialogToGenInvoice,"paymentType",t)},expression:"dialogToGenInvoice.paymentType"}},e._l(e.paymentArr,(function(i){return t("div",{key:i.val},[t("el-checkbox",{attrs:{label:i.val}},[e._v(e._s(i.text))])],1)})),0)],1),e.dialogToGenInvoice.onlyOne.length?t("el-divider"):e._e(),e.dialogToGenInvoice.onlyOne.length?t("div",{staticStyle:{"padding-top":"15px"}},[t("div",{staticStyle:{"margin-bottom":"10px","font-size":"12px"}},[t("span",{staticStyle:{"margin-right":"5px",color:"#909399"}},[e._v("Warm tips:")]),e._v(" You have set the following products to be allocated to the vendors only once. Therefore, the following items will need to be re-allocated after the orders are generated again. ")]),t("el-table",{staticClass:"only-one-table",staticStyle:{width:"100%"},attrs:{data:e.dialogToGenInvoice.onlyOne,height:"260",stripe:""}},[t("el-table-column",{attrs:{label:"Product"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("div",{staticClass:"product-info"},[t("div",{staticClass:"image-wrap"},[t("el-image",{staticStyle:{"min-width":"50px",width:"50px",height:"50px"},attrs:{src:i.row.imgUrl,fit:"contain"}},[t("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[t("i",{staticClass:"el-icon-picture-outline",staticStyle:{color:"#c0c4cc","font-size":"20px"}})])]),t("i",[e._v(e._s(i.row.quantity))])],1),t("div",{staticClass:"info"},[t("div",{staticClass:"mg-b-10 tx-ellipsis2"},[e._v(e._s(i.row.name))]),t("div",[e._v(e._s(i.row.propertyValue))])])])]}}],null,!1,1853821431)}),t("el-table-column",{attrs:{label:"Vendor",width:"160"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",{staticStyle:{"font-size":"12px"}},[e._v(e._s(i.row.vendorName))])]}}],null,!1,3360286070)})],1)],1):e._e()],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogToGenInvoice.isShow=!1}}},[e._v("Cancel")]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.toGenInvoice}},[e._v(" Place "+e._s(e.purchaseNum)+" orders NOW ")])],1)]),t("DialogNotice",{attrs:{data:e.dialogNoticeData}})],1)},s=[],r=(i("149f"),i("662d"),i("e98b")),l=i("6b2f"),o=i("f1c9"),n=i.n(o),c=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"Notice",visible:e.data.isShow,width:"600px"},on:{"update:visible":function(t){return e.$set(e.data,"isShow",t)}}},[t("el-divider"),t("div",{staticClass:"body-wrap"},[e._v(" Sorry, you can only process "),t("b",[e._v(e._s(e.$store.state.userInfo.orderNum))]),e._v(" orders. Click Continue to get more. ")]),t("el-divider"),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"small"},on:{click:function(t){e.data.isShow=!1}}},[e._v("Discard")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.gotoRecharge}},[e._v("Continue")])],1)],1)},d=[],h={props:["data"],methods:{gotoRecharge(){this.data.isShow=!1,this.$router.push({name:"Rechareg"})}}},f=h,p=(i("33b6"),i("e607")),m=Object(p["a"])(f,c,d,!1,null,"16791bee",null),u=m.exports,g=i("716a"),v={props:["fulfillArr","dateArr"],data(){return{options:[{id:1,label:"Shopify",children:[]},{id:2,label:"Woocommerce",children:[]},{id:3,label:"Lazada",children:[]},{id:4,label:"Shopee",children:[]}],cascaderKey:1,loading:!1,tableHeight:400,ce:this.$CE,vendors:[],filterParams:{vendorId:"",vendorName:"",shopifyStore:[],timeFilter:"",dateFrom:"",dateTo:"",sortBy:"",orderMin:0,orderMax:0},filterParamsDefault:"{}",orderMin:void 0,orderMax:void 0,storeList:[],shopifyStoreName:"",filterDate:[],popDateFilter:!1,popStoreFilter:!1,popCodeFilter:!1,allChecked:!0,tableData:[],AllTableData:[],submitI:0,dialogToGenInvoice:{isShow:!1,loading:!1,paymentType:[1,2,3],onlyOne:[]},dialogToGenInvoiceDefault:"{}",paymentArr:[{text:"By AliExpress VIP link",val:2},{text:"PayPal",val:1},{text:"Bank transfer",val:3}],lastId:"",dialogNoticeData:{isShow:!1}}},mounted(){this.filterParamsDefault=JSON.stringify(this.filterParams),this.$route.params.id&&(this.vendors.push({vendorName:this.$route.params.name,id:this.$route.params.id}),this.filterParams.vendorId=this.$route.params.id,this.filterParams.vendorName=this.$route.params.name),this.dialogToGenInvoiceDefault=JSON.stringify(this.dialogToGenInvoice),this.getVendors(),this.getStore(),this.$nextTick(()=>{this.getItems(),setTimeout(()=>{$(".my-tree > .vxe-list--virtual-wrapper").css({"min-height":$(window).height()-400+"px",height:$(window).height()-400+"px"})},1100),window.onresize=()=>{$(".my-tree > .vxe-list--virtual-wrapper").css({"min-height":$(window).height()-400+"px",height:$(window).height()-400+"px"})}})},destroyed(){window.onresize=()=>{}},components:{fulfillMentStatusTag:r["a"],popItems:l["a"],DialogNotice:u,shopCate:g["a"]},computed:{AllOrderChecked(){let[e,t]=[0,0];return this.tableData.forEach(i=>{0===i._LEVEL&&i.children.forEach(i=>{i.children.forEach(i=>{i._VISIBLE&&e++,i.checked&&t++})})}),e&&e===t},checkedVariableId(){let e=[];return this.tableData.forEach(t=>{0===t._LEVEL&&t.children.forEach(t=>{t.children.forEach(t=>{t.checked&&t.items.forEach(t=>{e.push(t.variableId)})})})}),Array.from(new Set(e))},totalVendorsNum(){let e=0;return this.tableData.forEach(t=>{if(0===t._LEVEL){let i=!1;t.children.forEach(e=>{e.children.some(e=>e.checked)&&(i=!0)}),i&&e++}}),e},totalOrdersNum(){let e=[];return this.tableData.forEach(t=>{0===t._LEVEL&&t.children.forEach(t=>{t.children.forEach(t=>{t.checked&&e.push(t.id)})})}),Array.from(new Set(e)).length},totalAllOrdersNum(){let e=[];return this.tableData.forEach(t=>{0===t._LEVEL&&t.children.forEach(t=>{t.children.forEach(t=>{t._VISIBLE&&e.push(t.id)})})}),Array.from(new Set(e)).length},purchaseNum(){let e=0;return this.tableData.forEach(t=>{0===t._LEVEL&&t.children.forEach(t=>{t.children.some(e=>e.checked)&&e++})}),e}},watch:{AllOrderChecked(){this.allChecked=this.AllOrderChecked},tableHeight(){this.$nextTick(()=>{this.refreshTree()})},"filterParams.shopifyStore"(){if(!this.filterParams.shopifyStore.length)return;let e=[];this.filterParams.shopifyStore.forEach(t=>{this.storeList.forEach(i=>{t==i.shopifyAccountId&&e.push(i.store)})}),this.shopifyStoreName=e.join(",")}},methods:{changeAllChecked(){this.tableData.forEach(e=>{0===e._LEVEL&&e.children.forEach(e=>{this.$set(e,"checked",this.allChecked),e.children.forEach(e=>{this.$set(e,"checked",this.allChecked)})})})},unAllocate(){this.$confirm(`Un-allocate selected products? (orders: ${this.totalOrdersNum}, products: ${this.checkedVariableId.length})`,"",{confirmButtonText:"Confirm",cancelButtonText:"Discard",confirmButtonClass:"el-button--danger",type:"info"}).then(()=>{this.loading=!0,this.$apiCall("api.DispatchOrderRule.unAllocate",{variableIds:this.checkedVariableId},e=>{"9999"==e.ErrorCode?(this.$emit("getNum"),this.getItems(!0),this.$elementMessage("UN-allocate Success","success")):this.$elementMessage(e.Message,"error")})}),setTimeout(()=>{document.querySelectorAll(".el-button--primary").forEach(e=>{e.blur()})},200)},openToGenInvoice(){this.dialogToGenInvoice=JSON.parse(this.dialogToGenInvoiceDefault),this.dialogToGenInvoice.paymentType=localStorage.getItem("c_defaultPaymentType")?JSON.parse(localStorage.getItem("c_defaultPaymentType")):[],this.tableData.forEach(e=>{0===e._LEVEL&&e.children.forEach(t=>{t.children.forEach(t=>{t.checked&&t.items.forEach(t=>{1==t.onlyOne&&(t.vendorName=e.vendorName,this.dialogToGenInvoice.onlyOne.push(t))})})})});let e={};this.dialogToGenInvoice.onlyOne=this.dialogToGenInvoice.onlyOne.reduce((t,i)=>(!e[i.variableId]&&(e[i.variableId]=t.push(i)),t),[]),this.dialogToGenInvoice.isShow=!0},tableSelect(e){if("remove"==e&&(this.filterParams.orderMin=this.orderMin=void 0,this.filterParams.orderMax=this.orderMax=void 0,this.getItems()),"range"==e){if(!this.orderMin&&!this.orderMax)return void this.$elementMessage("请输入单号范围","error");if(this.orderMin>this.orderMax)return void this.$elementMessage("起始单号必须小于结束单号","error");this.filterParams.orderMin=this.orderMin,this.filterParams.orderMax=this.orderMax,this.tableData=this.AllTableData.slice(),this.tableData.forEach(e=>{if(0===e._LEVEL){for(let t=0;e.children.length>t;t++){let i=e.children[t];for(let e=0;i.children.length>e;e++){let t=i.children[e];t.nCode>=this.filterParams.orderMin&&t.nCode<=(this.filterParams.orderMax?this.filterParams.orderMax:Number.POSITIVE_INFINITY)||(i.children.splice(e,1),e--)}i.children.length||(e.children.splice(t,1),t--)}e.children.length||(e._VISIBLE=!1)}})}this.refreshTree(),this.popCodeFilter=!1},dateChange(){this.filterDate.length>1&&(this.filterParams.dateFrom=moment(this.filterDate[0]).unix(),this.filterParams.dateTo=moment(this.filterDate[1]).endOf("d").unix(),this.getItems())},clearFilter(e){switch(e){case"vendor":this.filterParams.vendorId="",this.filterParams.vendorName="",this.getItems();break;case"store":this.filterParams.shopifyStore=[],this.popStoreFilter=!1,++this.cascaderKey,this.getItems();break;case"date":this.filterParams.timeFilter="",this.filterDate=[],this.filterParams.dateFrom="",this.filterParams.dateTo="",this.popDateFilter=!1,this.getItems();break;default:this.filterParams=JSON.parse(this.filterParamsDefault),this.filterDate=[],this.tableSelect("remove")}},filterItems(e){switch(e){case"vendor":this.vendors.some(e=>{if(e.id==this.filterParams.vendorId)return this.filterParams.vendorName=e.vendorName,!0});break;case"date":this.filterDate=[],this.filterParams.dateFrom="",this.filterParams.dateTo="";break}this.getItems()},toGenInvoice(){let e=[];this.tableData.forEach(t=>{0===t._LEVEL&&t.children.forEach(i=>{let a=[];i.children.forEach(e=>{e.checked&&e.items.forEach(e=>{a.push(e.id)})}),a.length&&e.push({relationshipId:[t.id],skus:a})})}),this.submitI=0,e.length&&(this.dialogToGenInvoice.loading=!0,this.genInvoice(e))},genInvoice(e){e[this.submitI].paymentType=this.dialogToGenInvoice.paymentType,localStorage.setItem("c_defaultPaymentType",JSON.stringify(this.dialogToGenInvoice.paymentType)),this.$apiCall("api.Invoice.genInvoice",e[this.submitI],t=>{if("9998"==t.ErrorCode)return this.dialogToGenInvoice.loading=!1,this.dialogToGenInvoice.isShow=!1,void(this.dialogNoticeData.isShow=!0);"9999"==t.ErrorCode?(this.submitI++,this.submitI<e.length?this.genInvoice(e):(this.submitI=0,this.dialogToGenInvoice.loading=!1,this.dialogToGenInvoice.isShow=!1,this.$router.push({name:"OrderProcessing",params:{verify:"email"}}))):(this.$elementMessage(t.Message,"error"),this.dialogToGenInvoice.loading=!1,this.submitI=0)})},changeSkuChecked(e){this.tableData.forEach(t=>{1==t._LEVEL&&t._ID==e.parent_ID&&this.$set(t,"checked",t.children.length&&this.selectedSkuNum(t)==t.children.length)})},storeAllChecked(e){e.children.forEach(t=>{this.$set(t,"checked",e.checked)})},selectedSkuNum(e){let t=0;return 1==e._LEVEL?e.children.forEach(e=>{e.checked&&t++}):0==e._LEVEL&&e.children.forEach(e=>{e.children.forEach(e=>{e.checked&&t++})}),t},toggleTreeNode(e){e._HAS_CHILDREN&&this.setTreeExpand(e,!e._EXPAND)},setTreeExpand(e,t){const i=n.a.findTree(this.tree,t=>t===e);e._EXPAND=t,i&&n.a.eachTree(i.item.children,(e,i,a,s,r)=>{e._VISIBLE=r?r._EXPAND&&r._VISIBLE:t}),this.refreshTree()},getVendors(){this.$apiCall("api.Relationship.findByCustomer",{},e=>{"9999"==e.ErrorCode?this.vendors=e.Data.Results:this.$elementMessage(e.Message,"error")})},refreshTree(){this.tableData.forEach(e=>{0===e._LEVEL&&e.children.forEach((t,i)=>{this.$set(t,"last",i==e.children.length-1),t.children.forEach((e,i)=>{this.$set(e,"storeLast",t.last),this.$set(e,"last",i==t.children.length-1),this.$set(e,"bg",i%2)})})});const e=n.a.toTreeArray(this.tree);this.fullList=e,this.tableData=e.filter(e=>e._VISIBLE),this.$emit("getTableHeight",this)},allTreeExpand(){n.a.eachTree(this.tree,e=>{e._EXPAND=e._HAS_CHILDREN,e._VISIBLE=!0}),this.refreshTree()},getProducts(e){this.tableData.some((t,i)=>{if(1==t._LEVEL&&t.loading){let a={timeFilter:this.filterParams.timeFilter>=6?"":this.filterParams.timeFilter,dateFrom:this.filterParams.dateFrom,dateTo:this.filterParams.dateTo,relationshipId:t.relationshipId,accountIds:[t.id]};return this.$apiCall("api.Invoice.shopifyOrders",a,a=>{if("9999"==a.ErrorCode){t.children=[];let i=a.Data.Results;i.length?(t._EXPAND=!0,t._HAS_CHILDREN=!0,i.forEach((i,a)=>{i._ID=t._ID+"_"+i.id,i._LEVEL=2,i._EXPAND=!1,i._VISIBLE=!0,i._HAS_CHILDREN=!1,i._IS_LEAF=!i._HAS_CHILDREN,i.checked=!e&&this.allChecked,i.checked=!e,i.parent_ID=t._ID;let s=i.codeName;s=s.replace(/[^0-9]/gi,","),s=s.split(","),s=s.filter(e=>e&&e.trim());let r=0;s.forEach(e=>{e>r&&(r=e)}),i.nCode=r,t.children.push(i)})):(t._EXPAND=!1,t._HAS_CHILDREN=!1)}else this.$elementMessage(a.Message,"error");t.loading=!1,this.refreshTree(),i<this.tableData.length&&this.getProducts(e),this.AllTableData=this.tableData.slice(),t.id==this.lastId&&(this.filterParams.orderMin||this.filterParams.orderMax)&&this.tableSelect("range")}),!0}})},getItems(e){this.loading=!0;let t=[];this.filterParams.shopifyStore[1]&&t.push(this.filterParams.shopifyStore[1]);let i={relationshipId:this.filterParams.vendorId,accountIds:t};this.$apiCall("api.Invoice.findOrderRelationships",i,t=>{if(this.loading=!1,"9999"==t.ErrorCode){this.tableData=[];let i=t.Data.Results;if(!i.length)return;let a=i[i.length-1].accounts[i[i.length-1].accounts.length-1];this.lastId=a.id,i.forEach(t=>{this.$set(t.vendorInfo,"_ID",t.vendorInfo.id),this.$set(t.vendorInfo,"_LEVEL",0),this.$set(t.vendorInfo,"_EXPAND",!0),this.$set(t.vendorInfo,"_VISIBLE",!0),this.$set(t.vendorInfo,"_HAS_CHILDREN",!0),this.$set(t.vendorInfo,"_IS_LEAF",!t.vendorInfo._HAS_CHILDREN),t.vendorInfo.children=[],t.accounts.forEach((i,a)=>{i&&(i._ID=t.vendorInfo.id+"_"+i.id,i._LEVEL=1,i._EXPAND=!1,i._VISIBLE=!0,i._HAS_CHILDREN=!1,i._IS_LEAF=!i._HAS_CHILDREN,i.children=[],i.loading=!0,i.checked=!e&&this.allChecked,i.relationshipId=t.vendorInfo.id,t.vendorInfo.children.push(i))}),this.tableData.push(t.vendorInfo)}),this.tree=this.tableData,this.allTreeExpand(),this.$nextTick(()=>{this.getProducts(e)})}else this.$elementMessage(t.Message,"error")})},getStore(){this.$apiCall("api.Invoice.findStores",{authStatus:1},e=>{9999==e.ErrorCode?(this.storeList=[],e.Data.Results.forEach(e=>{this.storeList.push({shopifyAccountId:e.id,store:e.shopName})}),this.options.map(t=>{e.Data.Results.filter(e=>{e.platform==t.id&&t.children.push({label:e.shopName,value:e.id})})})):this.$message({message:e.Message,type:"error"})})}}},_=v,y=(i("669c"),Object(p["a"])(_,a,s,!1,null,"6f31602e",null));t["default"]=y.exports},"33b6":function(e,t,i){"use strict";i("5050")},"340e":function(e,t,i){e.exports=i.p+"img/shopify_icon.862d4ffa.png"},3550:function(e,t,i){"use strict";i("1039")},3772:function(e,t,i){"use strict";var a=i("bd71");e.exports=function(e,t){var i=[][e];return!!i&&a((function(){i.call(null,t||function(){return 1},1)}))}},"4d6b":function(e,t,i){e.exports=i.p+"img/lazada_icon.895bb3eb.png"},5050:function(e,t,i){},"566f":function(e,t,i){var a=i("9887"),s=i("bed0");e.exports="process"==a(s.process)},6247:function(e,t,i){},"662d":function(e,t,i){"use strict";var a=i("6dec"),s=i("0a95").left,r=i("3772"),l=i("9c69"),o=i("566f"),n=r("reduce"),c=!o&&l>79&&l<83;a({target:"Array",proto:!0,forced:!n||c},{reduce:function(e){var t=arguments.length;return s(this,e,t,t>1?arguments[1]:void 0)}})},"669c":function(e,t,i){"use strict";i("7578")},"6b2f":function(e,t,i){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",[e.items&&e.items.length?t("el-popover",{attrs:{placement:"right-start",trigger:"hover",width:"400"}},[t("div",{staticClass:"pop-sku"},e._l(e.items,(function(i,a){return t("div",{key:i.id,style:{borderBottom:e.items.length-1!=a?"1px #EBEEF5 solid":"none"}},[t("div",{staticClass:"image-wrap"},[t("el-image",{staticStyle:{"min-width":"50px",width:"50px",height:"50px"},attrs:{src:i.imgUrl,fit:"contain"}},[t("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[t("i",{staticClass:"el-icon-picture-outline",staticStyle:{color:"#C0C4CC","font-size":"20px"}})])]),t("i",[e._v(e._s(i.quantity))])],1),t("div",{staticClass:"info"},[t("div",{staticClass:"mg-b-10"},[t("fulfillMentStatusTag",{attrs:{fulfillmentStatus:i.fulfillmentStatus}})],1),t("div",{staticClass:"tx-ellipsis2",staticStyle:{"word-break":"normal"}},[e._v(e._s(i.name))]),t("div",[e._v(e._s(i.propertyValue))]),i.customerProperties.length?e._l(i.customerProperties,(function(i){return t("div",[t("span",{staticStyle:{"margin-right":"5px",color:"#909399"}},[e._v(e._s(i.name))]),e._v(" "+e._s(i.value)+" ")])})):e._e(),t("div",[t("span",{staticStyle:{"margin-right":"5px",color:"#909399"}},[e._v("SKU")]),e._v(" "+e._s(i.sku)+" ")]),"WaitingForSourcing"==e.$route.name&&1==i.onlyOne?t("el-tooltip",{attrs:{placement:"top"}},[t("div",{attrs:{slot:"content"},slot:"content"},[t("el-image",{staticStyle:{width:"335px",height:"270px"},attrs:{src:"images/popitem-onlyone.png","preview-src-list":["images/popitem-onlyone.png"]}})],1),t("div",{staticStyle:{color:"#E6A23C","font-size":"12px"}},[e._v(" Need to be allocated to vendor after this purchase order "),t("i",{staticClass:"el-icon-question"})])]):e._e()],2)])})),0),t("span",{staticStyle:{display:"inline-block",cursor:"pointer"},attrs:{slot:"reference"},slot:"reference"},[t("span",[e._v(e._s(e.items.length)+" Items")]),e.items.length?t("i",{staticClass:"el-icon-caret-bottom"}):e._e()])]):e._e()],1)},s=[],r=i("e98b"),l={props:["items","fulfillmentStatus"],components:{fulfillMentStatusTag:r["a"]}},o=l,n=(i("3550"),i("e607")),c=Object(n["a"])(o,a,s,!1,null,"0fc2cdfe",null);t["a"]=c.exports},"716a":function(e,t,i){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"shop"},[1==e.items.platform?t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Shopify",placement:"left"}},[t("img",{staticClass:"shopImg",attrs:{src:i("340e")}})]):2==e.items.platform?t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Woocommerce",placement:"left"}},[t("img",{staticClass:"shopImg",attrs:{src:i("7e46")}})]):3==e.items.platform?t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Lazada",placement:"left"}},[t("img",{staticClass:"shopImg",attrs:{src:i("4d6b")}})]):4==e.items.platform?t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Shopee",placement:"left"}},[t("img",{staticClass:"shopImg",attrs:{src:i("e74a")}})]):e._e()],1)},s=[],r={props:["items"],data(){return{}},methods:{},components:{}},l=r,o=(i("c33f"),i("e607")),n=Object(o["a"])(l,a,s,!1,null,"7d79ad08",null);t["a"]=n.exports},7578:function(e,t,i){},"7e46":function(e,t,i){e.exports=i.p+"img/woo_icon.bbaca118.png"},c33f:function(e,t,i){"use strict";i("6247")},c93a:function(e,t,i){"use strict";i("e5bf")},e5bf:function(e,t,i){},e74a:function(e,t,i){e.exports=i.p+"img/shopee_icon.c6765767.png"},e98b:function(e,t,i){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",[e.fulfillmentStatus?t("el-tag",{staticClass:"shopfiy-status",attrs:{size:"small",type:e.fulfillArr[e.fulfillmentStatus].type}},[t("span",{staticClass:"-EFlq",class:"bg"+e.fulfillArr[e.fulfillmentStatus].r}),e._v(" "+e._s(e.fulfillArr[e.fulfillmentStatus].text)+" ")]):t("el-tag",{attrs:{size:"small",type:"warning"}},[t("span",{staticClass:"-EFlq bg1"}),e._v(" Unfulfilled ")])],1)},s=[],r={props:["fulfillmentStatus"],data(){return{fulfillArr:{fulfilled:{text:"Fulfilled",type:"info",r:3},unfulfilled:{text:"Unfulfilled",type:"warning",r:1},partial:{text:"Partially Fulfilled",type:"danger",r:2},refunded:{text:"Refunded",type:"info",r:3}}}}},l=r,o=(i("c93a"),i("e607")),n=Object(o["a"])(l,a,s,!1,null,"d93044ba",null);t["a"]=n.exports}}]);
//# sourceMappingURL=WaitingForSourcing.c5367da8.js.map