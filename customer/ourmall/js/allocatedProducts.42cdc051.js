(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["allocatedProducts"],{"0621":function(e,t,a){"use strict";a("dd5c")},"598a":function(e,t,a){},8216:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"contentpanel allocate-products-page"},[t("div",{ref:"pageHeader",staticClass:"pagetitle"},[t("div",{staticClass:"left"},[e._m(0),t("el-breadcrumb",{staticStyle:{"font-size":"12px"},attrs:{"separator-class":"el-icon-arrow-right"}},[t("el-breadcrumb-item",{staticStyle:{color:"#5c6ac4"},attrs:{to:{path:"/vendors"}}},[e._v("Vendors")]),t("el-breadcrumb-item",{staticStyle:{color:"#C0C4CC"}},[e._v("My Allocated Products")])],1)],1),t("div",{staticClass:"right"},[t("el-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",size:"medium",disabled:!e.checkdeStatus.checkedArr.length},on:{click:function(t){return e.openAllocateToVendor()}}},[e._v("Batch Re-allocate")]),t("el-button",{attrs:{type:"danger",size:"medium",disabled:!e.checkdeStatus.checkedArr.length},on:{click:function(t){return e.confirmUnAllocate("multi")}}},[e._v("Batch Un-allocate")])],1)]),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"pagebody mg-b-20"},[t("el-card",[t("el-row",{attrs:{gutter:20}},[t("div",{ref:"pageFilter",staticClass:"page-filter"},[t("el-form",{attrs:{inline:!0,size:"mini"}},[t("el-form-item",[t("el-cascader",{key:e.cascaderKey,attrs:{placeholder:"All my stores",options:e.options,props:{expandTrigger:"hover"}},on:{change:e.filterGetItem},model:{value:e.cascaderValue,callback:function(t){e.cascaderValue=t},expression:"cascaderValue"}})],1),t("el-form-item",[t("el-input",{attrs:{placeholder:"Product name"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.filterGetItem.apply(null,arguments)}},model:{value:e.productName,callback:function(t){e.productName=t},expression:"productName"}})],1),t("el-form-item",[t("el-select",{attrs:{filterable:"",placeholder:"All my vendors"},on:{change:e.filterGetItem},model:{value:e.filterParams.relationshipId,callback:function(t){e.$set(e.filterParams,"relationshipId",t)},expression:"filterParams.relationshipId"}},[t("el-option",{attrs:{label:"All my vendors",value:""}}),e._l(e.vendors,(function(e){return t("el-option",{key:e.id,attrs:{label:e.vendorName,value:e.id}})}))],2)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.filterGetItem}},[e._v("Filter")]),t("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.clearFilter("all")}}},[e._v("Clear")])],1)],1),t("div",{staticStyle:{"margin-bottom":"5px"}},[e.filterParams.accountId?t("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(t){return e.clearFilter("store")}}},[e._v(" "+e._s(e.storeName(e.filterParams.accountId))+" ")]):e._e(),e.filterParams.productName?t("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(t){return e.clearFilter("name")}}},[e._v(" "+e._s(e.filterParams.productName)+" ")]):e._e(),e.filterParams.relationshipId?t("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(t){return e.clearFilter("vendor")}}},[e._v(" "+e._s(e.venderName(e.filterParams.relationshipId))+" ")]):e._e()],1),t("el-row",{staticStyle:{"margin-bottom":"5px"},attrs:{gutter:10}},[t("el-col",{staticStyle:{"padding-right":"25px"},attrs:{span:24}},[t("el-card",{staticClass:"table-header",attrs:{shadow:"never","body-style":{padding:"0 20px"}}},[t("el-col",{attrs:{span:10}},[t("div",{staticClass:"d-flex"},[t("el-checkbox",{staticStyle:{"margin-right":"10px","margin-bottom":"0"},on:{change:e.changeAllChecked},model:{value:e.allChecked,callback:function(t){e.allChecked=t},expression:"allChecked"}}),t("div",{staticClass:"title"},[e._v("My Product")])],1)]),t("el-col",{attrs:{span:6}},[t("div",{staticClass:"title"},[e._v("My store")])]),t("el-col",{attrs:{span:6}},[t("div",{staticClass:"title"},[e._v("Vendor")])]),t("el-col",{attrs:{span:2}})],1)],1)],1)],1)]),t("el-row",{ref:"gridTable",staticStyle:{"padding-top":"15px","overflow-y":"auto"},style:[{height:e.tableHeight+"px"},{overflowX:"hidden"}],attrs:{gutter:10}},[e.items.length?e._e():t("el-col",[t("p",{staticStyle:{"margin-top":"25px","font-size":"16px",color:"#909399","text-align":"center"}},[e._v("No product")])]),e._l(e.items,(function(a){return t("el-row",{key:a.id,attrs:{gutter:10}},[t("el-col",{staticStyle:{"padding-right":"25px"},attrs:{span:24}},[t("el-card",{staticClass:"table-body-card",attrs:{"body-style":[{display:"flex"},{padding:"10px 20px"},{alignItems:"center"}]}},[t("el-col",{attrs:{span:10}},[t("div",{staticClass:"product-box"},[t("el-checkbox",{model:{value:a.checked,callback:function(t){e.$set(a,"checked",t)},expression:"item.checked"}}),t("el-image",{staticStyle:{"min-width":"120px",width:"120px",height:"120px"},attrs:{fit:"contain",src:a.img,"preview-src-list":[a.img]}},[t("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[t("i",{staticClass:"el-icon-picture-outline"})])]),t("div",{staticClass:"info"},[t("div",{staticClass:"name tx-ellipsis3"},[e._v(e._s(a.productName))]),t("div",{staticClass:"row1"},[t("span",{staticStyle:{color:"#909399"}},[e._v("SKU:")]),e._v(" "+e._s(a.sku)+" ")])])],1)]),t("el-col",{attrs:{span:6}},[t("div",{staticClass:"info-wrap"},[t("div",{staticClass:"row1"},[e._v(e._s(a.storeName))]),t("div",{staticClass:"row1"},[t("span",{staticStyle:{color:"#909399"}},[e._v("Sale price: ")]),a.saleCurrency?t("span",[e._v(e._s(e.ce[a.saleCurrency]?e.ce[a.saleCurrency].symbol:a.saleCurrency)+" ")]):e._e(),e._v(" "+e._s(a.salePrice)+" ")])])]),t("el-col",{attrs:{span:6}},[t("div",{staticClass:"info-wrap"},[t("div",{staticClass:"row1"},[e._v(e._s(a.vendorName))]),t("div",{staticClass:"row1"},[t("span",{staticStyle:{color:"#909399"}},[e._v("Puchase price: ")]),t("span",[e._v("$ ")]),e._v(" "+e._s(a.purchasePrice)+" ")])])]),t("el-col",{attrs:{span:2}},[t("div",{staticClass:"info-wrap"},[t("div",{staticClass:"row1 mg-b-10"},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.openAllocateToVendor(a)}}},[e._v("Re-allocate")])],1),t("div",{staticClass:"row1"},[t("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.confirmUnAllocate("single",a)}}},[e._v("Un-allocate")])],1)])])],1)],1)],1)}))],2)],1)],1),e.items.length?t("el-row",{attrs:{gutter:20}},[t("el-col",{staticClass:"d-flex justify-content-center",attrs:{span:24}},[t("div",[t("el-pagination",{attrs:{"current-page":e.page,background:!0,layout:"sizes, total, prev, pager, next, jumper","page-sizes":e.pageSizes,"page-size":e.rowsPerPage,total:Number(e.total)},on:{"current-change":e.toPage,"size-change":e.changePageSize}})],1)])],1):e._e(),t("DistributionVendorDialog",{ref:"DistributionVendorDialog",attrs:{type:"products"},on:{resetPage:e.filterGetItem}})],1)},r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"title",staticStyle:{"margin-bottom":"10px"}},[t("i",{staticClass:"el-icon-shopping-bag-1"}),t("h2",[e._v("My Allocated Products")])])}],i=(a("149f"),a("f02e")),l=(a("0821"),{data(){return{cascaderKey:1,cascaderValue:"",options:[{id:1,label:"Shopify",children:[]},{id:2,label:"Woocommerce",children:[]},{id:3,label:"Lazada",children:[]},{id:4,label:"Shopee",children:[]}],loading:!1,tableHeight:400,reSizeTime:0,page:this.$route.query.page?Number(this.$route.query.page):1,rowsPerPage:localStorage.getItem("c_allocateProductsPerPage")?Number(localStorage.getItem("c_allocateProductsPerPage")):10,total:0,totalPage:0,pageSizes:[10,20,50],items:[],productName:"",filterParams:{accountId:"",productName:"",relationshipId:""},filterParamsDefault:"{}",ce:this.$CE,allChecked:!1,storeList:[],vendors:[],resizeH:()=>{this.$getTableHeight(this)}}},components:{DistributionVendorDialog:i["a"]},computed:{checkdeStatus(){let[e,t]=[[],[]];return this.items.forEach(a=>{a.checked&&(e.push(a),t.push(a.variableId))}),{checkedArr:e,allChecked:this.items.length&&this.items.length==e.length,variableIdArr:t}}},watch:{$route:"gotoPage","checkdeStatus.allChecked"(){this.allChecked=this.checkdeStatus.allChecked}},mounted(){this.filterParamsDefault=JSON.stringify(this.filterParams),this.filterParams.relationshipId=this.$route.params.vendorId,this.getStore(),this.getVendors(),this.getItems(),this.$nextTick(()=>{this.resizeH(),window.addEventListener("resize",this.resizeH,!1)})},beforeDestroy(){window.removeEventListener("resize",this.resizeH)},methods:{openAllocateToVendor(e){e?this.$refs.DistributionVendorDialog.openDistributionDialog([e]):this.$refs.DistributionVendorDialog.openDistributionDialog(this.checkdeStatus.checkedArr.slice())},confirmUnAllocate(e,t){this.$confirm("single"==e?"Un-allocate selected products?":`Un-allocate selected (${this.checkdeStatus.variableIdArr.length}) products? `,"",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.unAllocate(e,t)})},unAllocate(e,t){this.loading=!0;let a={};a.variableIds="single"==e?[t.variableId]:this.checkdeStatus.variableIdArr,this.$apiCall("api.DispatchOrderRule.unAllocate",a,e=>{"9999"==e.ErrorCode?(this.getItems(!0),this.$elementMessage("UN-allocate Success","success")):this.$elementMessage(e.Message,"error")})},storeName(e){let t="";return this.storeList.some(a=>{if(a.shopifyAccountId==e)return t=a.store,!0}),t},venderName(e){let t="";return this.vendors.some(a=>{if(a.id==e)return t=a.vendorName,!0}),t},changeAllChecked(){this.items.forEach(e=>{e.checked=this.allChecked})},clearFilter(e){switch(e){case"store":this.filterParams.accountId="",this.cascaderValue="",++this.cascaderKey;break;case"name":this.productName=this.filterParams.productName="";break;case"vendor":this.filterParams.relationshipId="";break;case"all":this.filterParams=JSON.parse(this.filterParamsDefault);break}1==this.$route.query.page?this.getItems():this.$router.push({query:{page:1}})},filterGetItem(){""!=this.cascaderValue&&(this.filterParams.accountId=this.cascaderValue[1]),this.filterParams.productName=this.productName,1==this.$route.query.page?this.getItems():this.$router.push({query:{page:1}})},getItems(e){this.loading=!0;let t={page:this.page,rowsPerPage:this.rowsPerPage,accountId:this.filterParams.accountId,productName:this.filterParams.productName,relationshipId:this.filterParams.relationshipId};this.$apiCall("api.DispatchOrderRule.findAllocatedProducts",t,t=>{this.loading=!1,"9999"==t.ErrorCode?(this.items=t.Data.Results.map(e=>(e.checked=!1,e)),this.total=Number(t.Data.Pagination.totalCount),this.totalPage=Number(t.Data.Pagination.totalPage),this.resizeH(),!e&&this.$refs.gridTable&&(this.$refs.gridTable.$el.scrollTop=0)):this.$elementMessage(t.Message,"error")})},toPage(e){e!=this.$route.query.page&&this.$router.push({query:{page:e}})},changePageSize(e){this.rowsPerPage=e,localStorage.setItem("c_allocateProductsPerPage",e),this.getItems()},gotoPage(){this.page=this.$route.query.page?this.$route.query.page:1,this.getItems()},getStore(){this.$apiCall("api.Invoice.findStores",{authStatus:1},e=>{9999==e.ErrorCode?(this.storeList=[],e.Data.Results.forEach(e=>{this.storeList.push({shopifyAccountId:e.id,store:e.shopName})}),this.options.map(t=>{e.Data.Results.filter(e=>{e.platform==t.id&&t.children.push({label:e.shopName,value:e.id})})})):this.$message({message:e.Message,type:"error"})})},getVendors(){this.$apiCall("api.Relationship.findByCustomer",{},e=>{"9999"==e.ErrorCode?this.vendors=e.Data.Results:this.$elementMessage(e.Message,"error")})}}}),o=l,c=(a("0621"),a("f37a"),a("e607")),n=Object(c["a"])(o,s,r,!1,null,"03f9947c",null);t["default"]=n.exports},dd5c:function(e,t,a){},f37a:function(e,t,a){"use strict";a("598a")}}]);
//# sourceMappingURL=allocatedProducts.42cdc051.js.map