(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["staff"],{"721a":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"contentpanel staff-management-page"},[e("div",{ref:"pageHeader",staticClass:"pagetitle"},[t._m(0),e("div",{staticClass:"right"},[e("el-button",{attrs:{type:"primary",disabled:!t.isWrite},on:{click:function(e){return t.openEditStaff()}}},[t._v("添加员工")])],1)]),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"pagebody"},[e("el-row",{staticClass:"mg-b-20",attrs:{gutter:15}},[e("el-col",{attrs:{span:24}},[e("el-card",[e("div",{ref:"pageFilter",staticClass:"page-filter"},[e("el-form",{attrs:{inline:!0,size:"mini"}},[e("el-form-item",{attrs:{label:"角色："}},[e("el-select",{staticStyle:{width:"120px"},attrs:{filterable:""},on:{change:t.filterItem},model:{value:t.filterParams.roleId,callback:function(e){t.$set(t.filterParams,"roleId",e)},expression:"filterParams.roleId"}},[e("el-option",{attrs:{label:"全部",value:""}}),t._l(t.roleList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],2)],1),e("el-form-item",[e("el-input",{attrs:{placeholder:"输入员工账号",clearable:""},on:{clear:function(e){return t.clearFilter("username")}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.filterItem.apply(null,arguments)}},model:{value:t.filterParams.usernameIpt,callback:function(e){t.$set(t.filterParams,"usernameIpt","string"===typeof e?e.trim():e)},expression:"filterParams.usernameIpt"}})],1),e("el-form-item",[e("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"输入员工姓名",clearable:""},on:{clear:function(e){return t.clearFilter("name")}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.filterItem.apply(null,arguments)}},model:{value:t.filterParams.nameIpt,callback:function(e){t.$set(t.filterParams,"nameIpt","string"===typeof e?e.trim():e)},expression:"filterParams.nameIpt"}})],1),e("el-form-item",{attrs:{label:"是否启用："}},[e("el-select",{staticStyle:{width:"100px"},on:{change:t.filterItem},model:{value:t.filterParams.status,callback:function(e){t.$set(t.filterParams,"status",e)},expression:"filterParams.status"}},[e("el-option",{attrs:{label:"全部",value:""}}),e("el-option",{attrs:{label:"启用",value:"1"}}),e("el-option",{attrs:{label:"停用",value:"2"}})],1)],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.filterItem()}}},[t._v("筛选")]),e("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.clearFilter()}}},[t._v("重置")])],1)],1),e("div",{staticClass:"mg-b-10"},[t.filterParams.roleId?e("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(e){return t.clearFilter("role")}}},[t._v("角色："),e("b",{staticStyle:{color:"#5c6ac4"}},[t._v(t._s(t.showRole(t.filterParams.roleId)))])]):t._e(),t.filterParams.username?e("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(e){return t.clearFilter("username")}}},[t._v("账号："),e("b",{staticStyle:{color:"#5c6ac4"}},[t._v(t._s(t.filterParams.username))])]):t._e(),t.filterParams.name?e("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(e){return t.clearFilter("name")}}},[t._v("姓名："),e("b",{staticStyle:{color:"#5c6ac4"}},[t._v(t._s(t.filterParams.name))])]):t._e(),t.filterParams.status?e("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(e){return t.clearFilter("status")}}},[t._v("开启状态："),e("b",{staticStyle:{color:"#5c6ac4"}},[t._v(t._s("1"==t.filterParams.status?"启用":"停用"))])]):t._e()],1)],1),e("el-table",{ref:"staffTable",staticStyle:{width:"100%"},attrs:{data:t.items,stripe:"","row-key":"id"}},[e("el-table-column",{attrs:{label:"员工账号",prop:"username"}}),e("el-table-column",{attrs:{label:"员工姓名",prop:"name"}}),e("el-table-column",{attrs:{label:"角色"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.showRole(e.row.roleId))+" ")]}}])}),e("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[e("el-link",{attrs:{type:"primary",disabled:!t.isWrite},on:{click:function(e){return t.openEditStaff(a.row)}}},[t._v("编辑")])],1),e("div",[e("el-link",{attrs:{type:"primary",disabled:!t.isWrite},on:{click:function(e){return t.openEditPassword(a.row)}}},[t._v("修改密码")])],1),e("div",[e("el-link",{attrs:{type:"danger",disabled:!t.isWrite},on:{click:function(e){return t.delStaff(a.row)}}},[t._v("删除")])],1)]}}])}),e("el-table-column",{attrs:{label:"启用/停用",align:"center",width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-switch",{attrs:{disabled:!t.isWrite},on:{change:function(e){return t.changeStatus(a.row)}},model:{value:a.row.statusSwitch,callback:function(e){t.$set(a.row,"statusSwitch",e)},expression:"scope.row.statusSwitch"}})]}}])})],1)],1)],1)],1),t.items.length?e("el-row",{attrs:{gutter:20}},[e("el-col",{staticClass:"d-flex justify-content-center",attrs:{span:24}},[e("div",[e("el-pagination",{attrs:{"current-page":Number(t.page),background:!0,layout:"sizes, total, prev, pager, next, jumper","page-sizes":t.pageSizes,"page-size":t.rowsPerPage,total:Number(t.total)},on:{"current-change":t.toPage,"size-change":t.changePageSize}})],1)])],1):t._e()],1),e("DialogEditStaff",{attrs:{data:t.DialogEditStaffData,roleList:t.roleList},on:{saveSuccess:t.saveSuccess}}),e("DialogEditStaffPassword",{attrs:{data:t.DialogEditPsdData}})],1)},r=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"left"},[e("div",{staticClass:"title"},[e("i",{staticClass:"el-icon-user"}),e("h2",[t._v("员工管理")])])])}],i=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{visible:t.data.isShow,width:"600px",title:t.data.id?"编辑员工信息":"添加员工","close-on-click-modal":!1},on:{"update:visible":function(e){return t.$set(t.data,"isShow",e)},open:t.open}},[e("el-divider"),e("div",{staticClass:"d-body"},[e("el-form",{ref:"staffForm",attrs:{model:t.data.form,rules:t.rules,"label-width":"120px"}},[e("el-form-item",{attrs:{label:"员工账号",prop:"username"}},[e("el-input",{attrs:{placeholder:"请输入员工注册时的邮箱/手机号码"},model:{value:t.data.form.username,callback:function(e){t.$set(t.data.form,"username",e)},expression:"data.form.username"}}),e("p",{staticStyle:{"line-height":"26px",color:"#909399","font-size":"12px"}},[t._v("员工使用该手机号作为账号即可登录后台")])],1),t.data.id?t._e():[e("el-form-item",{attrs:{label:"账号密码",prop:"password"}},[e("el-input",{attrs:{placeholder:"请输入员工账号的密码","show-password":"","auto-complete":"new-password"},model:{value:t.data.form.password,callback:function(e){t.$set(t.data.form,"password",e)},expression:"data.form.password"}})],1),e("el-form-item",{attrs:{label:"重复密码",prop:"repassword"}},[e("el-input",{attrs:{placeholder:"请再输入一次密码","show-password":""},model:{value:t.data.form.repassword,callback:function(e){t.$set(t.data.form,"repassword",e)},expression:"data.form.repassword"}})],1)],e("el-form-item",{attrs:{label:"员工姓名",prop:"name"}},[e("el-input",{model:{value:t.data.form.name,callback:function(e){t.$set(t.data.form,"name",e)},expression:"data.form.name"}})],1),e("el-form-item",{attrs:{label:"所属角色",prop:"roleId"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{filterable:""},model:{value:t.data.form.roleId,callback:function(e){t.$set(t.data.form,"roleId",e)},expression:"data.form.roleId"}},t._l(t.roleList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1)],2)],1),e("el-divider"),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.data.isShow=!1}}},[t._v(" 取消 ")]),e("el-button",{attrs:{loading:t.data.loading,type:"primary"},on:{click:t.save}},[t._v(" 保存 ")])],1)],1)},l=[],o=(a("d9e2"),{props:["data","roleList"],data(){let t=(t,e,a)=>{e!=this.data.form.password?a(new Error("重复密码必须和账号密码相同")):a()};return{rules:{username:[{required:!0,message:"员工账号必须输入",trigger:"blur"}],password:[{required:!0,message:"账号密码必须输入",trigger:"blur"}],repassword:[{required:!0,message:"重复密码必须输入",trigger:"blur"},{validator:t,trigger:"blur"}],name:[{required:!0,message:"员工姓名必须输入",trigger:"blur"}],roleId:[{required:!0,message:"所属角色必须选择",trigger:"change"}]}}},methods:{save(){this.data.loading=!0,this.$refs["staffForm"].validate(t=>{if(!t)return this.data.loading=!1,!1;{let t={username:this.data.form.username,password:this.data.form.password,repassword:this.data.form.repassword,name:this.data.form.name,roleId:this.data.form.roleId};this.data.id&&(t.id=this.data.id),this.$apiCall("api.Admin.addAdmin",t,t=>{this.data.loading=!1,9999==t.ErrorCode?(this.$message({message:"保存成功",type:"success"}),this.data.isShow=!1,this.$emit("saveSuccess")):this.$message({message:t.Message,type:"error"})})}})},open(){this.$nextTick(()=>{this.$refs["staffForm"].clearValidate()})}}}),n=o,d=a("2877"),m=Object(d["a"])(n,i,l,!1,null,null,null),u=m.exports,f=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{visible:t.data.isShow,width:"600px",title:"修改密码","close-on-click-modal":!1},on:{"update:visible":function(e){return t.$set(t.data,"isShow",e)},open:t.open}},[e("el-divider"),e("div",{staticClass:"d-body"},[e("el-form",{ref:"psdForm",attrs:{model:t.data.form,rules:t.rules,"label-width":"120px"}},[e("el-form-item",{attrs:{label:"新密码",prop:"password"}},[e("el-input",{attrs:{placeholder:"输入要新的密码","show-password":""},model:{value:t.data.form.password,callback:function(e){t.$set(t.data.form,"password",e)},expression:"data.form.password"}})],1),e("el-form-item",{attrs:{label:"重复密码",prop:"repassword"}},[e("el-input",{attrs:{placeholder:"请再输入一次密码","show-password":""},model:{value:t.data.form.repassword,callback:function(e){t.$set(t.data.form,"repassword",e)},expression:"data.form.repassword"}})],1)],1)],1),e("el-divider"),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.data.isShow=!1}}},[t._v(" 取消 ")]),e("el-button",{attrs:{loading:t.data.loading,type:"primary"},on:{click:t.save}},[t._v(" 保存修改 ")])],1)],1)},c=[],p={props:["data"],data(){let t=(t,e,a)=>{e!=this.data.form.password?a(new Error("重复密码必须和账号密码相同")):a()};return{rules:{password:[{required:!0,message:"新密码必须输入",trigger:"blur"}],repassword:[{required:!0,message:"重复密码必须输入",trigger:"blur"},{validator:t,trigger:"blur"}]}}},methods:{save(){this.data.loading=!0,this.$refs["psdForm"].validate(t=>{if(!t)return this.data.loading=!1,!1;{let t={password:this.data.form.password,repassword:this.data.form.repassword,id:this.data.id};this.$apiCall("api.Admin.changePassword",t,t=>{this.data.loading=!1,9999==t.ErrorCode?(this.$message({message:"修改密码成功",type:"success"}),this.data.isShow=!1):this.$message({message:t.Message,type:"error"})})}})},open(){this.$nextTick(()=>{this.$refs["psdForm"].clearValidate()})}}},g=p,h=Object(d["a"])(g,f,c,!1,null,null,null),w=h.exports,b={data(){return{loading:!1,isWrite:!1,pageSizes:[10,20,50,100],page:this.$route.query.page?Number(this.$route.query.page):1,rowsPerPage:localStorage.getItem("staffPerPage")?Number(localStorage.getItem("staffPerPage")):10,total:0,totalPage:0,items:[],roleList:[],filterParams:{roleId:"",username:"",usernameIpt:"",name:"",nameIpt:"",status:""},defaultFilterParams:"{}",DialogEditStaffData:{isShow:!1,loading:!1,form:{username:"",password:"",repassword:"",name:"",roleId:""}},defaultDialogEditStaffData:"{}",DialogEditPsdData:{isShow:!1,loading:!1,id:"",form:{password:"",repassword:""}},defaultDialogEditPsdData:"{}"}},components:{DialogEditStaff:u,DialogEditStaffPassword:w},watch:{$route:"gotoPage"},mounted(){this.isWrite=this.$isRole(this.$route.meta.roleWrite),this.defaultFilterParams=JSON.stringify(this.filterParams),this.defaultDialogEditStaffData=JSON.stringify(this.DialogEditStaffData),this.defaultDialogEditPsdData=JSON.stringify(this.DialogEditPsdData),this.getItem(),this.getRole()},methods:{openEditPassword(t){this.DialogEditPsdData=JSON.parse(this.defaultDialogEditPsdData),this.DialogEditPsdData.id=t.id,this.DialogEditPsdData.isShow=!0},changeStatus(t){this.$apiCall("api.Admin.changeStatus",{id:t.id},e=>{9999==e.ErrorCode||(t.statusSwitch=!t.statusSwitch,this.$message({message:e.Message,type:"error"})),t.status=t.statusSwitch?"1":"2"})},delStaff(t){this.$confirm("确定删除该员工吗?",{confirmButtonText:"删除",cancelButtonText:"取消",confirmButtonClass:" el-button--danger",type:"warning"}).then(()=>{this.loading=!0,this.$apiCall("api.Admin.delete",{id:t.id},t=>{9999==t.ErrorCode?(this.$message({message:"删除成功",type:"success"}),this.getItem()):(this.loading=!1,this.$message({message:t.Message,type:"error"}))})}).catch(()=>!1)},openEditStaff(t){this.DialogEditStaffData=JSON.parse(this.defaultDialogEditStaffData),t&&(this.DialogEditStaffData.id=t.id,this.DialogEditStaffData.form.name=t.name,this.DialogEditStaffData.form.username=t.username,this.DialogEditStaffData.form.roleId=t.roleId),this.DialogEditStaffData.isShow=!0},clearFilter(t){"username"==t&&(this.filterParams.username=this.filterParams.usernameIpt=""),"name"==t&&(this.filterParams.name=this.filterParams.nameIpt=""),"role"==t&&(this.filterParams.roleId=""),"status"==t&&(this.filterParams.status=""),t||(this.filterParams=JSON.parse(this.defaultFilterParams)),1==this.$route.query.page?this.getItem():this.$router.push({query:{page:1}})},filterItem(){this.filterParams.username=this.filterParams.usernameIpt,this.filterParams.name=this.filterParams.nameIpt,1==this.$route.query.page?this.getItem():this.$router.push({query:{page:1}})},getItem(){this.loading=!0,this.$apiCall("api.Admin.findsAdmin",{page:this.page,rowsPerPage:this.rowsPerPage,name:this.filterParams.name,roleId:this.filterParams.roleId,username:this.filterParams.username,status:this.filterParams.status},t=>{this.loading=!1,9999==t.ErrorCode?(this.items=t.Data.Results.map(t=>(t.statusSwitch="1"==t.status,t)),this.total=Number(t.Data.Pagination.totalCount),this.totalPage=Number(t.Data.Pagination.totalPage),this.$root.$children[0].$refs.mainScroll.wrap.scrollTop=0):this.$message({message:t.Message,type:"error"})})},toPage(t){t!=this.$route.query.page?this.$router.push({query:{page:t}}):this.getItem()},changePageSize(t){this.rowsPerPage=t,localStorage.setItem("staffPerPage",t),this.getItem()},gotoPage(){this.page=this.$route.query.page?this.$route.query.page:1,this.getItem()},getRole(){this.$apiCall("api.Admin.roleList",{},t=>{9999==t.ErrorCode?this.roleList=t.Data.Results:10086!=t.ErrorCode&&this.$message({message:t.Message,type:"error"})})},showRole(t){let e="";return this.roleList.forEach(a=>{t==a.id&&(e=a.name)}),e},saveSuccess(){this.getItem()}}},v=b,P=Object(d["a"])(v,s,r,!1,null,null,null);e["default"]=P.exports}}]);
//# sourceMappingURL=staff.357a8531.js.map