{"version":3,"sources":["webpack:///./src/views/StaffMGR/DialogEditRole.vue?c32f","webpack:///./src/views/StaffMGR/Role.vue","webpack:///./src/views/StaffMGR/DialogEditRole.vue","webpack:///src/views/StaffMGR/DialogEditRole.vue","webpack:///./src/views/StaffMGR/DialogEditRole.vue?a09a","webpack:///./src/views/StaffMGR/DialogEditRole.vue?76a7","webpack:///src/views/StaffMGR/Role.vue","webpack:///./src/views/StaffMGR/Role.vue?4968","webpack:///./src/views/StaffMGR/Role.vue?9f70"],"names":["render","_vm","this","_c","_self","staticClass","ref","_m","attrs","isWrite","on","$event","openEditRole","_v","directives","name","rawName","value","loading","expression","staticStyle","items","scopedSlots","_u","key","fn","scope","row","delRole","$index","dialogEditRoleData","treeData","roleList","saveSuccess","staticRenderFns","data","isShow","id","$set","open","form","rules","model","callback","$$v","remark","class","length","_s","treeKey","defaultProps","slot","save","props","label","children","required","message","trigger","validator","methods","rights","description","privilege","params","type","document","component","defaultDialogEditRoleData","components","DialogEditRole","mounted","confirmButtonText","cancelButtonText","confirmButtonClass","then","catch","getRole","getRightArr"],"mappings":"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","file":"js/Role.c6ca9ee4.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DialogEditRole.vue?vue&type=style&index=0&id=0f717bcf&prod&lang=scss&scoped=true&\"","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"contentpanel role-management-page\"},[_c('div',{ref:\"pageHeader\",staticClass:\"pagetitle\"},[_vm._m(0),_c('div',{staticClass:\"right\"},[_c('el-button',{attrs:{\"type\":\"primary\",\"disabled\":!_vm.isWrite},on:{\"click\":function($event){return _vm.openEditRole()}}},[_vm._v(\"添加角色\")])],1)]),_c('div',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],staticClass:\"pagebody\"},[_c('el-row',{staticClass:\"mg-b-20\",attrs:{\"gutter\":15}},[_c('el-col',{attrs:{\"span\":24}},[_c('el-card',[_c('el-table',{ref:\"gridTable\",staticStyle:{\"width\":\"100%\"},attrs:{\"data\":_vm.items,\"stripe\":\"\",\"row-key\":\"id\"}},[_c('el-table-column',{attrs:{\"label\":\"员工角色\",\"prop\":\"name\"}}),_c('el-table-column',{attrs:{\"label\":\"描述\",\"prop\":\"description\"}}),_c('el-table-column',{attrs:{\"label\":\"员工数\",\"prop\":\"count\",\"align\":\"center\"}}),_c('el-table-column',{attrs:{\"label\":\"操作\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('el-link',{staticStyle:{\"margin-right\":\"20px\"},attrs:{\"type\":\"primary\",\"disabled\":!_vm.isWrite},on:{\"click\":function($event){return _vm.openEditRole(scope.row)}}},[_vm._v(\" 编辑 \")]),_c('el-link',{attrs:{\"type\":\"danger\",\"disabled\":!_vm.isWrite},on:{\"click\":function($event){return _vm.delRole(scope.row, scope.$index)}}},[_vm._v(\"删除\")])]}}])})],1)],1)],1)],1)],1),_c('DialogEditRole',{attrs:{\"data\":_vm.dialogEditRoleData,\"treeData\":_vm.treeData,\"roleList\":_vm.roleList},on:{\"saveSuccess\":_vm.saveSuccess}})],1)\n}\nvar staticRenderFns = [function (){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"left\"},[_c('div',{staticClass:\"title\"},[_c('i',{staticClass:\"el-icon-unlock\"}),_c('h2',[_vm._v(\"角色管理\")])])])\n}]\n\nexport { render, staticRenderFns }","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('el-dialog',{attrs:{\"visible\":_vm.data.isShow,\"width\":\"600px\",\"title\":_vm.data.id ? '角色详情':'添加角色',\"close-on-click-modal\":false},on:{\"update:visible\":function($event){return _vm.$set(_vm.data, \"isShow\", $event)},\"open\":_vm.open}},[_c('el-divider'),_c('div',{staticClass:\"d-body\"},[_c('el-form',{ref:\"roleForm\",attrs:{\"model\":_vm.data.form,\"rules\":_vm.rules,\"label-width\":\"80px\"}},[_c('el-form-item',{attrs:{\"label\":\"角色名称\",\"prop\":\"name\"}},[_c('el-input',{attrs:{\"placeholder\":\"请输入角色名称，如高级管理员，普通管理员等\"},model:{value:(_vm.data.form.name),callback:function ($$v) {_vm.$set(_vm.data.form, \"name\", $$v)},expression:\"data.form.name\"}})],1),_c('el-form-item',{staticStyle:{\"position\":\"relative\"},attrs:{\"label\":\"角色描述\",\"prop\":\"remark\"}},[_c('el-input',{attrs:{\"type\":\"textarea\",\"placeholder\":\"至多输入50个字\"},model:{value:(_vm.data.form.remark),callback:function ($$v) {_vm.$set(_vm.data.form, \"remark\", $$v)},expression:\"data.form.remark\"}}),_c('div',{staticClass:\"num\"},[_c('span',{class:{'tx-danger': _vm.data.form.remark.length > 50}},[_vm._v(_vm._s(_vm.data.form.remark.length))]),_vm._v(\" / 50 \")])],1),_c('el-form-item',{attrs:{\"label\":\"权限\"}},[_c('div',{staticClass:\"tree-wrap\"},[_c('el-tree',{key:_vm.treeKey,ref:\"roleTree\",attrs:{\"default-expand-all\":true,\"data\":_vm.treeData,\"props\":_vm.defaultProps,\"node-key\":\"key\",\"show-checkbox\":\"\"}})],1)])],1)],1),_c('el-divider'),_c('div',{staticClass:\"dialog-footer\",attrs:{\"slot\":\"footer\"},slot:\"footer\"},[_c('el-button',{on:{\"click\":function($event){_vm.data.isShow = false}}},[_vm._v(\"取消\")]),_c('el-button',{attrs:{\"type\":\"primary\",\"loading\":_vm.data.loading},on:{\"click\":_vm.save}},[_vm._v(\"保存\")])],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <el-dialog\r\n    :visible.sync=\"data.isShow\"\r\n    width=\"600px\"\r\n    :title=\"data.id ? '角色详情':'添加角色'\"\r\n    :close-on-click-modal=\"false\"\r\n    @open=\"open\"\r\n  >\r\n    <el-divider></el-divider>\r\n    <div class=\"d-body\">\r\n      <el-form ref=\"roleForm\" :model=\"data.form\" :rules=\"rules\" label-width=\"80px\">\r\n        <el-form-item label=\"角色名称\" prop=\"name\">\r\n          <el-input\r\n            placeholder=\"请输入角色名称，如高级管理员，普通管理员等\"\r\n            v-model=\"data.form.name\"\r\n          >\r\n          </el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"角色描述\" style=\"position: relative;\" prop=\"remark\">\r\n          <el-input type=\"textarea\" v-model=\"data.form.remark\" placeholder=\"至多输入50个字\"></el-input>\r\n          <div class=\"num\">\r\n            <span :class=\"{'tx-danger': data.form.remark.length > 50}\">{{data.form.remark.length}}</span> / 50\r\n          </div>\r\n        </el-form-item>  \r\n        <el-form-item label=\"权限\">\r\n          <div class=\"tree-wrap\">\r\n            <el-tree\r\n              :key=\"treeKey\"\r\n              :default-expand-all=\"true\"\r\n              ref='roleTree'\r\n              :data=\"treeData\"\r\n              :props=\"defaultProps\"\r\n              node-key=\"key\"\r\n              show-checkbox\r\n            >\r\n            </el-tree>\r\n          </div>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n    <el-divider></el-divider>\r\n    <div slot=\"footer\" class=\"dialog-footer\">\r\n      <el-button @click=\"data.isShow = false\">取消</el-button>\r\n      <el-button type=\"primary\" :loading=\"data.loading\" @click=\"save\">保存</el-button>\r\n    </div>  \r\n  </el-dialog>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  props: [\"data\", \"treeData\", \"roleList\"],\r\n  data(){\r\n    let len50 = (rule, value, callback) => {\r\n      if(value && value.length > 50){\r\n        return callback(new Error('角色描述不能大于50字'))\r\n      }else{\r\n        callback();\r\n      }\r\n    }\r\n    return {\r\n      treeKey: (new Date()).valueOf(),\r\n      defaultProps: {\r\n        label: \"name\",\r\n        children: \"subMenu\",\r\n      },\r\n      rules: {\r\n        name: [\r\n          {required: true, message: '角色名称必须输入', trigger: 'blur'},\r\n        ],\r\n        remark: [\r\n          {validator: len50, trigger: 'blur'},\r\n        ]\r\n      },\r\n    }\r\n  },\r\n  methods: {\r\n    save(){\r\n      this.data.loading = true;\r\n      this.$refs['roleForm'].validate((valid) => {\r\n        if(valid){ //验证成功\r\n          let [selectedArr, rights] = [this.$refs.roleTree.getCheckedKeys(), []];\r\n          rights = this.roleList.filter(e => selectedArr.indexOf(e) < 0)\r\n          let params = {\r\n            name: this.data.form.name,\r\n            description: this.data.form.remark,\r\n            privilege: rights,\r\n          }\r\n          if(this.data.id)\r\n            params.id = this.data.id;\r\n          this.$apiCall('api.Admin.roleAdd', params, r => {\r\n            this.data.loading = false;\r\n            if(r.ErrorCode == 9999){\r\n              this.$message({message: '保存成功', type: \"success\"});\r\n              this.data.isShow = false;\r\n              this.$emit('saveSuccess')\r\n            }else{\r\n              this.$message({message: r.Message, type: \"error\"});\r\n            }\r\n          });\r\n        }else{ //验证失败\r\n          this.data.loading = false;\r\n          return false;\r\n        }\r\n      })\r\n    },\r\n    open(){\r\n      this.treeKey = (new Date()).valueOf();\r\n      //筛选不选的\r\n      let checkedArr = this.roleList.filter(e => this.data.rights.indexOf(e) < 0);\r\n      this.$nextTick(()=>{\r\n        if(this.data.id){ \r\n          this.$refs.roleTree.setCheckedKeys(checkedArr);\r\n        }else{\r\n          //新建默认全不选\r\n          this.$refs.roleTree.setCheckedKeys([]);\r\n        }\r\n        \r\n        this.$refs['roleForm'].clearValidate();\r\n        document.querySelector('.tree-wrap').scrollTop = 0;\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.num{\r\n  position: absolute;\r\n  right: 0;\r\n  bottom: -30px;\r\n  color: #909399;\r\n  font-size: 12px;\r\n}\r\n.tree-wrap{\r\n  padding: 7px 0;\r\n  max-height: 300px;\r\n  overflow-y: scroll;\r\n}\r\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DialogEditRole.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DialogEditRole.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./DialogEditRole.vue?vue&type=template&id=0f717bcf&scoped=true&\"\nimport script from \"./DialogEditRole.vue?vue&type=script&lang=js&\"\nexport * from \"./DialogEditRole.vue?vue&type=script&lang=js&\"\nimport style0 from \"./DialogEditRole.vue?vue&type=style&index=0&id=0f717bcf&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0f717bcf\",\n  null\n  \n)\n\nexport default component.exports","<template>\r\n   <div class=\"contentpanel role-management-page\">\r\n     <div class=\"pagetitle\" ref=\"pageHeader\">\r\n      <div class=\"left\">\r\n        <div class=\"title\">\r\n          <i class=\"el-icon-unlock\"></i>\r\n          <h2>角色管理</h2>\r\n        </div>\r\n      </div>\r\n      <div class=\"right\">\r\n        <el-button type=\"primary\" :disabled=\"!isWrite\" @click=\"openEditRole()\">添加角色</el-button>\r\n      </div>\r\n    </div>\r\n    <div class=\"pagebody\" v-loading=\"loading\">\r\n      <el-row :gutter=\"15\" class=\"mg-b-20\">\r\n        <el-col :span=\"24\">\r\n          <el-card>\r\n            <el-table\r\n              :data=\"items\"\r\n              stripe\r\n              row-key=\"id\"\r\n              style=\"width: 100%\"\r\n              ref=\"gridTable\"\r\n            >\r\n              <el-table-column label=\"员工角色\" prop=\"name\">\r\n              </el-table-column>\r\n              <el-table-column label=\"描述\" prop=\"description\">\r\n              </el-table-column>\r\n              <el-table-column label=\"员工数\" prop=\"count\" align=\"center\">\r\n              </el-table-column>\r\n              <el-table-column label=\"操作\">\r\n                <template slot-scope=\"scope\">\r\n                  <el-link type=\"primary\" style=\" margin-right: 20px;\" :disabled=\"!isWrite\" @click=\"openEditRole(scope.row)\">\r\n                    编辑\r\n                  </el-link>\r\n                  <el-link type=\"danger\" :disabled=\"!isWrite\" @click=\"delRole(scope.row, scope.$index)\">删除</el-link>\r\n                </template>\r\n              </el-table-column>\r\n            </el-table>\r\n          </el-card>\r\n        </el-col>\r\n      </el-row>\r\n    </div>\r\n    <DialogEditRole :data=\"dialogEditRoleData\" :treeData=\"treeData\" :roleList=\"roleList\" @saveSuccess=\"saveSuccess\"/>\r\n   </div>\r\n</template>\r\n\r\n<script>\r\nimport DialogEditRole from '@/views/StaffMGR/DialogEditRole'\r\nexport default {\r\n  data(){\r\n    return {\r\n      isWrite: false, //是否可写\r\n      loading: false,\r\n      items: [],\r\n      treeData: [], //权限树\r\n      roleList: [], //所有权限\r\n      dialogEditRoleData: {\r\n        loading: false,\r\n        isShow: false,\r\n        id: '',\r\n        form: {\r\n          name: '',\r\n          remark: '',\r\n        },\r\n        rights: [], //限制权限列表\r\n      },\r\n      defaultDialogEditRoleData: '{}',\r\n    }\r\n  },\r\n  components: {\r\n    DialogEditRole,\r\n  },\r\n  mounted(){\r\n    this.isWrite = this.$isRole(this.$route.meta.roleWrite)\r\n    this.defaultDialogEditRoleData = JSON.stringify(this.dialogEditRoleData);\r\n    this.getRole();\r\n    this.getRightArr();\r\n  },\r\n  methods: {\r\n    delRole(item,i){\r\n      this.$confirm(\"确定删除该角色吗?\", {\r\n        confirmButtonText: \"删除\",\r\n        cancelButtonText: \"取消\",\r\n        confirmButtonClass: \" el-button--danger\",\r\n        type: \"warning\",\r\n      }).then(()=>{\r\n        this.loading = true;\r\n        this.$apiCall('api.Admin.roleDelete', {id: item.id}, r => {\r\n          this.loading = false;\r\n          if (r.ErrorCode == 9999) {\r\n            this.items.splice(i, 1);\r\n            this.$message({ message: '删除成功', type: \"success\" });\r\n          }else{\r\n            this.$message.error(r.Message);\r\n          }\r\n        })\r\n      }).catch();\r\n    },\r\n    getRole() {\r\n      this.loading = true;\r\n      this.$apiCall(\"api.Admin.roleList\", {}, (r) => {\r\n        this.loading = false;\r\n        if (r.ErrorCode == 9999) {\r\n          this.items = r.Data.Results.map(e => e);\r\n        } else {\r\n          this.$message({ message: r.Message, type: \"error\" });\r\n        }\r\n      });\r\n    },\r\n    getRightArr() {\r\n      this.$apiCall(\"api.Admin.getRights\", {}, (r) => {\r\n        if (r.ErrorCode == 9999) {\r\n          this.treeData = [...r.Data.Results.rights];\r\n          //员工管理子菜单的格式化 \r\n          // let staffIndex = 1; //员工管理是第几个菜单\r\n          // this.treeData.splice(staffIndex, 0, {\r\n          //   key: 'MenuStaffParent',\r\n          //   name: '员工管理',\r\n          //   subMenu: [],\r\n          // })\r\n          // for(let i = 0; i < this.treeData.length; i++){\r\n          //   if(this.treeData[i].key == 'MenuStaff' || this.treeData[i].key == 'MenuPrivilege'){\r\n          //     this.treeData[staffIndex].subMenu.push(this.treeData[i]);\r\n          //     this.treeData.splice(i, 1);\r\n          //     i --;\r\n          //   }\r\n          // }\r\n          this.roleList = r.Data.Results.endpoint;\r\n        } else {\r\n          this.$message.error(r.Message);\r\n        }\r\n      });\r\n    },\r\n    openEditRole(item){\r\n      this.dialogEditRoleData = JSON.parse(this.defaultDialogEditRoleData)\r\n      if(item){ //编辑\r\n        this.dialogEditRoleData.form.name = item.name;\r\n        this.dialogEditRoleData.form.remark = item.description || '';\r\n        this.dialogEditRoleData.rights = item.privilege ? JSON.parse(item.privilege) : [];\r\n        this.dialogEditRoleData.id = item.id;\r\n      }\r\n      this.dialogEditRoleData.isShow = true;\r\n    },\r\n    saveSuccess(){\r\n      this.getRole();\r\n    }\r\n  }\r\n}\r\n</script>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Role.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Role.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Role.vue?vue&type=template&id=556ab52e&\"\nimport script from \"./Role.vue?vue&type=script&lang=js&\"\nexport * from \"./Role.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}