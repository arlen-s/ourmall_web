(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["staff"],{"721a":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"contentpanel staff-management-page"},[a("div",{ref:"pageHeader",staticClass:"pagetitle"},[t._m(0),a("div",{staticClass:"right"},[a("el-button",{attrs:{type:"primary",disabled:!t.isWrite},on:{click:function(e){return t.openEditStaff()}}},[t._v("添加员工")])],1)]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"pagebody"},[a("el-row",{staticClass:"mg-b-20",attrs:{gutter:15}},[a("el-col",{attrs:{span:24}},[a("el-card",[a("div",{ref:"pageFilter",staticClass:"page-filter"},[a("el-form",{attrs:{inline:!0,size:"mini"}},[a("el-form-item",{attrs:{label:"角色："}},[a("el-select",{staticStyle:{width:"120px"},attrs:{filterable:""},on:{change:t.filterItem},model:{value:t.filterParams.roleId,callback:function(e){t.$set(t.filterParams,"roleId",e)},expression:"filterParams.roleId"}},[a("el-option",{attrs:{label:"全部",value:""}}),t._l(t.roleList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],2)],1),a("el-form-item",[a("el-input",{attrs:{placeholder:"输入员工账号",clearable:""},on:{clear:function(e){return t.clearFilter("username")}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.filterItem.apply(null,arguments)}},model:{value:t.filterParams.usernameIpt,callback:function(e){t.$set(t.filterParams,"usernameIpt","string"===typeof e?e.trim():e)},expression:"filterParams.usernameIpt"}})],1),a("el-form-item",[a("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"输入员工姓名",clearable:""},on:{clear:function(e){return t.clearFilter("name")}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.filterItem.apply(null,arguments)}},model:{value:t.filterParams.nameIpt,callback:function(e){t.$set(t.filterParams,"nameIpt","string"===typeof e?e.trim():e)},expression:"filterParams.nameIpt"}})],1),a("el-form-item",{attrs:{label:"是否启用："}},[a("el-select",{staticStyle:{width:"100px"},on:{change:t.filterItem},model:{value:t.filterParams.status,callback:function(e){t.$set(t.filterParams,"status",e)},expression:"filterParams.status"}},[a("el-option",{attrs:{label:"全部",value:""}}),a("el-option",{attrs:{label:"启用",value:"1"}}),a("el-option",{attrs:{label:"停用",value:"2"}})],1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.filterItem()}}},[t._v("筛选")]),a("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.clearFilter()}}},[t._v("重置")])],1)],1),a("div",{staticClass:"mg-b-10"},[t.filterParams.roleId?a("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(e){return t.clearFilter("role")}}},[t._v("角色："),a("b",{staticStyle:{color:"#5c6ac4"}},[t._v(t._s(t.showRole(t.filterParams.roleId)))])]):t._e(),t.filterParams.username?a("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(e){return t.clearFilter("username")}}},[t._v("账号："),a("b",{staticStyle:{color:"#5c6ac4"}},[t._v(t._s(t.filterParams.username))])]):t._e(),t.filterParams.name?a("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(e){return t.clearFilter("name")}}},[t._v("姓名："),a("b",{staticStyle:{color:"#5c6ac4"}},[t._v(t._s(t.filterParams.name))])]):t._e(),t.filterParams.status?a("el-tag",{staticClass:"mg-r-5",attrs:{size:"small",type:"info",closable:""},on:{close:function(e){return t.clearFilter("status")}}},[t._v("开启状态："),a("b",{staticStyle:{color:"#5c6ac4"}},[t._v(t._s("1"==t.filterParams.status?"启用":"停用"))])]):t._e()],1)],1),a("el-table",{ref:"staffTable",staticStyle:{width:"100%"},attrs:{data:t.items,stripe:"","row-key":"id"}},[a("el-table-column",{attrs:{label:"员工账号",prop:"username"}}),a("el-table-column",{attrs:{label:"员工姓名",prop:"name"}}),a("el-table-column",{attrs:{label:"角色"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.showRole(e.row.roleId))+" ")]}}])}),a("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[a("el-link",{attrs:{type:"primary",disabled:!t.isWrite},on:{click:function(a){return t.openEditStaff(e.row)}}},[t._v("编辑")])],1),a("div",[a("el-link",{attrs:{type:"primary",disabled:!t.isWrite},on:{click:function(a){return t.openEditPassword(e.row)}}},[t._v("修改密码")])],1),a("div",[a("el-link",{attrs:{type:"danger",disabled:!t.isWrite},on:{click:function(a){return t.delStaff(e.row)}}},[t._v("删除")])],1)]}}])}),a("el-table-column",{attrs:{label:"启用/停用",align:"center",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-switch",{attrs:{disabled:!t.isWrite},on:{change:function(a){return t.changeStatus(e.row)}},model:{value:e.row.statusSwitch,callback:function(a){t.$set(e.row,"statusSwitch",a)},expression:"scope.row.statusSwitch"}})]}}])})],1)],1)],1)],1),t.items.length?a("el-row",{attrs:{gutter:20}},[a("el-col",{staticClass:"d-flex justify-content-center",attrs:{span:24}},[a("div",[a("el-pagination",{attrs:{"current-page":Number(t.page),background:!0,layout:"sizes, total, prev, pager, next, jumper","page-sizes":t.pageSizes,"page-size":t.rowsPerPage,total:Number(t.total)},on:{"current-change":t.toPage,"size-change":t.changePageSize}})],1)])],1):t._e()],1),a("DialogEditStaff",{attrs:{data:t.DialogEditStaffData,roleList:t.roleList},on:{saveSuccess:t.saveSuccess}}),a("DialogEditStaffPassword",{attrs:{data:t.DialogEditPsdData}})],1)},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"left"},[a("div",{staticClass:"title"},[a("i",{staticClass:"el-icon-user"}),a("h2",[t._v("员工管理")])])])}],i=(a("0a53"),a("b8bb"),a("9135"),a("c7ae"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{visible:t.data.isShow,width:"600px",title:t.data.id?"编辑员工信息":"添加员工","close-on-click-modal":!1},on:{"update:visible":function(e){return t.$set(t.data,"isShow",e)},open:t.open}},[a("el-divider"),a("div",{staticClass:"d-body"},[a("el-form",{ref:"staffForm",attrs:{model:t.data.form,rules:t.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"员工账号",prop:"username"}},[a("el-input",{attrs:{placeholder:"请输入员工注册时的邮箱/手机号码"},model:{value:t.data.form.username,callback:function(e){t.$set(t.data.form,"username",e)},expression:"data.form.username"}}),a("p",{staticStyle:{"line-height":"26px",color:"#909399","font-size":"12px"}},[t._v("员工使用该手机号作为账号即可登录后台")])],1),t.data.id?t._e():[a("el-form-item",{attrs:{label:"账号密码",prop:"password"}},[a("el-input",{attrs:{placeholder:"请输入员工账号的密码","show-password":"","auto-complete":"new-password"},model:{value:t.data.form.password,callback:function(e){t.$set(t.data.form,"password",e)},expression:"data.form.password"}})],1),a("el-form-item",{attrs:{label:"重复密码",prop:"repassword"}},[a("el-input",{attrs:{placeholder:"请再输入一次密码","show-password":""},model:{value:t.data.form.repassword,callback:function(e){t.$set(t.data.form,"repassword",e)},expression:"data.form.repassword"}})],1)],a("el-form-item",{attrs:{label:"员工姓名",prop:"name"}},[a("el-input",{model:{value:t.data.form.name,callback:function(e){t.$set(t.data.form,"name",e)},expression:"data.form.name"}})],1),a("el-form-item",{attrs:{label:"所属角色",prop:"roleId"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:""},model:{value:t.data.form.roleId,callback:function(e){t.$set(t.data.form,"roleId",e)},expression:"data.form.roleId"}},t._l(t.roleList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1)],2)],1),a("el-divider"),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.data.isShow=!1}}},[t._v(" 取消 ")]),a("el-button",{attrs:{loading:t.data.loading,type:"primary"},on:{click:t.save}},[t._v(" 保存 ")])],1)],1)}),l=[],o={props:["data","roleList"],data:function(){var t=this,e=function(e,a,r){a!=t.data.form.password?r(new Error("重复密码必须和账号密码相同")):r()};return{rules:{username:[{required:!0,message:"员工账号必须输入",trigger:"blur"}],password:[{required:!0,message:"账号密码必须输入",trigger:"blur"}],repassword:[{required:!0,message:"重复密码必须输入",trigger:"blur"},{validator:e,trigger:"blur"}],name:[{required:!0,message:"员工姓名必须输入",trigger:"blur"}],roleId:[{required:!0,message:"所属角色必须选择",trigger:"change"}]}}},methods:{save:function(){var t=this;this.data.loading=!0,this.$refs["staffForm"].validate((function(e){if(!e)return t.data.loading=!1,!1;var a={username:t.data.form.username,password:t.data.form.password,repassword:t.data.form.repassword,name:t.data.form.name,roleId:t.data.form.roleId};t.data.id&&(a.id=t.data.id),t.$apiCall("api.Admin.addAdmin",a,(function(e){t.data.loading=!1,9999==e.ErrorCode?(t.$message({message:"保存成功",type:"success"}),t.data.isShow=!1,t.$emit("saveSuccess")):t.$message({message:e.Message,type:"error"})}))}))},open:function(){var t=this;this.$nextTick((function(){t.$refs["staffForm"].clearValidate()}))}}},n=o,d=a("cba8"),u=Object(d["a"])(n,i,l,!1,null,null,null),c=u.exports,f=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{visible:t.data.isShow,width:"600px",title:"修改密码","close-on-click-modal":!1},on:{"update:visible":function(e){return t.$set(t.data,"isShow",e)},open:t.open}},[a("el-divider"),a("div",{staticClass:"d-body"},[a("el-form",{ref:"psdForm",attrs:{model:t.data.form,rules:t.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"新密码",prop:"password"}},[a("el-input",{attrs:{placeholder:"输入要新的密码","show-password":""},model:{value:t.data.form.password,callback:function(e){t.$set(t.data.form,"password",e)},expression:"data.form.password"}})],1),a("el-form-item",{attrs:{label:"重复密码",prop:"repassword"}},[a("el-input",{attrs:{placeholder:"请再输入一次密码","show-password":""},model:{value:t.data.form.repassword,callback:function(e){t.$set(t.data.form,"repassword",e)},expression:"data.form.repassword"}})],1)],1)],1),a("el-divider"),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.data.isShow=!1}}},[t._v(" 取消 ")]),a("el-button",{attrs:{loading:t.data.loading,type:"primary"},on:{click:t.save}},[t._v(" 保存修改 ")])],1)],1)},m=[],p={props:["data"],data:function(){var t=this,e=function(e,a,r){a!=t.data.form.password?r(new Error("重复密码必须和账号密码相同")):r()};return{rules:{password:[{required:!0,message:"新密码必须输入",trigger:"blur"}],repassword:[{required:!0,message:"重复密码必须输入",trigger:"blur"},{validator:e,trigger:"blur"}]}}},methods:{save:function(){var t=this;this.data.loading=!0,this.$refs["psdForm"].validate((function(e){if(!e)return t.data.loading=!1,!1;var a={password:t.data.form.password,repassword:t.data.form.repassword,id:t.data.id};t.$apiCall("api.Admin.changePassword",a,(function(e){t.data.loading=!1,9999==e.ErrorCode?(t.$message({message:"修改密码成功",type:"success"}),t.data.isShow=!1):t.$message({message:e.Message,type:"error"})}))}))},open:function(){var t=this;this.$nextTick((function(){t.$refs["psdForm"].clearValidate()}))}}},g=p,h=Object(d["a"])(g,f,m,!1,null,null,null),w=h.exports,v={data:function(){return{loading:!1,isWrite:!1,pageSizes:[10,20,50,100],page:this.$route.query.page?Number(this.$route.query.page):1,rowsPerPage:localStorage.getItem("staffPerPage")?Number(localStorage.getItem("staffPerPage")):10,total:0,totalPage:0,items:[],roleList:[],filterParams:{roleId:"",username:"",usernameIpt:"",name:"",nameIpt:"",status:""},defaultFilterParams:"{}",DialogEditStaffData:{isShow:!1,loading:!1,form:{username:"",password:"",repassword:"",name:"",roleId:""}},defaultDialogEditStaffData:"{}",DialogEditPsdData:{isShow:!1,loading:!1,id:"",form:{password:"",repassword:""}},defaultDialogEditPsdData:"{}"}},components:{DialogEditStaff:c,DialogEditStaffPassword:w},watch:{$route:"gotoPage"},mounted:function(){this.isWrite=this.$isRole(this.$route.meta.roleWrite),this.defaultFilterParams=JSON.stringify(this.filterParams),this.defaultDialogEditStaffData=JSON.stringify(this.DialogEditStaffData),this.defaultDialogEditPsdData=JSON.stringify(this.DialogEditPsdData),this.getItem(),this.getRole()},methods:{openEditPassword:function(t){this.DialogEditPsdData=JSON.parse(this.defaultDialogEditPsdData),this.DialogEditPsdData.id=t.id,this.DialogEditPsdData.isShow=!0},changeStatus:function(t){var e=this;this.$apiCall("api.Admin.changeStatus",{id:t.id},(function(a){9999==a.ErrorCode||(t.statusSwitch=!t.statusSwitch,e.$message({message:a.Message,type:"error"})),t.status=t.statusSwitch?"1":"2"}))},delStaff:function(t){var e=this;this.$confirm("确定删除该员工吗?",{confirmButtonText:"删除",cancelButtonText:"取消",confirmButtonClass:" el-button--danger",type:"warning"}).then((function(){e.loading=!0,e.$apiCall("api.Admin.delete",{id:t.id},(function(t){9999==t.ErrorCode?(e.$message({message:"删除成功",type:"success"}),e.getItem()):(e.loading=!1,e.$message({message:t.Message,type:"error"}))}))})).catch((function(){return!1}))},openEditStaff:function(t){this.DialogEditStaffData=JSON.parse(this.defaultDialogEditStaffData),t&&(this.DialogEditStaffData.id=t.id,this.DialogEditStaffData.form.name=t.name,this.DialogEditStaffData.form.username=t.username,this.DialogEditStaffData.form.roleId=t.roleId),this.DialogEditStaffData.isShow=!0},clearFilter:function(t){"username"==t&&(this.filterParams.username=this.filterParams.usernameIpt=""),"name"==t&&(this.filterParams.name=this.filterParams.nameIpt=""),"role"==t&&(this.filterParams.roleId=""),"status"==t&&(this.filterParams.status=""),t||(this.filterParams=JSON.parse(this.defaultFilterParams)),1==this.$route.query.page?this.getItem():this.$router.push({query:{page:1}})},filterItem:function(){this.filterParams.username=this.filterParams.usernameIpt,this.filterParams.name=this.filterParams.nameIpt,1==this.$route.query.page?this.getItem():this.$router.push({query:{page:1}})},getItem:function(){var t=this;this.loading=!0,this.$apiCall("api.Admin.findsAdmin",{page:this.page,rowsPerPage:this.rowsPerPage,name:this.filterParams.name,roleId:this.filterParams.roleId,username:this.filterParams.username,status:this.filterParams.status},(function(e){t.loading=!1,9999==e.ErrorCode?(t.items=e.Data.Results.map((function(t){return t.statusSwitch="1"==t.status,t})),t.total=Number(e.Data.Pagination.totalCount),t.totalPage=Number(e.Data.Pagination.totalPage),t.$root.$children[0].$refs.mainScroll.wrap.scrollTop=0):t.$message({message:e.Message,type:"error"})}))},toPage:function(t){t!=this.$route.query.page?this.$router.push({query:{page:t}}):this.getItem()},changePageSize:function(t){this.rowsPerPage=t,localStorage.setItem("staffPerPage",t),this.getItem()},gotoPage:function(){this.page=this.$route.query.page?this.$route.query.page:1,this.getItem()},getRole:function(){var t=this;this.$apiCall("api.Admin.roleList",{},(function(e){9999==e.ErrorCode?t.roleList=e.Data.Results:10086!=e.ErrorCode&&t.$message({message:e.Message,type:"error"})}))},showRole:function(t){var e="";return this.roleList.forEach((function(a){t==a.id&&(e=a.name)})),e},saveSuccess:function(){this.getItem()}}},b=v,P=Object(d["a"])(b,r,s,!1,null,null,null);e["default"]=P.exports},9135:function(t,e,a){"use strict";var r=a("dcce"),s=a("b488").map,i=a("1f71"),l=i("map");r({target:"Array",proto:!0,forced:!l},{map:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=staff.4024bdb8.js.map