(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Role"],{"5d7a":function(e,t,a){"use strict";a("9e8d")},"707c":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"contentpanel role-management-page"},[t("div",{ref:"pageHeader",staticClass:"pagetitle"},[e._m(0),t("div",{staticClass:"right"},[t("el-button",{attrs:{type:"primary",disabled:!e.isWrite},on:{click:function(t){return e.openEditRole()}}},[e._v("添加角色")])],1)]),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"pagebody"},[t("el-row",{staticClass:"mg-b-20",attrs:{gutter:15}},[t("el-col",{attrs:{span:24}},[t("el-card",[t("el-table",{ref:"gridTable",staticStyle:{width:"100%"},attrs:{data:e.items,stripe:"","row-key":"id"}},[t("el-table-column",{attrs:{label:"员工角色",prop:"name"}}),t("el-table-column",{attrs:{label:"描述",prop:"description"}}),t("el-table-column",{attrs:{label:"员工数",prop:"count",align:"center"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-link",{staticStyle:{"margin-right":"20px"},attrs:{type:"primary",disabled:!e.isWrite},on:{click:function(t){return e.openEditRole(a.row)}}},[e._v(" 编辑 ")]),t("el-link",{attrs:{type:"danger",disabled:!e.isWrite},on:{click:function(t){return e.delRole(a.row,a.$index)}}},[e._v("删除")])]}}])})],1)],1)],1)],1)],1),t("DialogEditRole",{attrs:{data:e.dialogEditRoleData,treeData:e.treeData,roleList:e.roleList},on:{saveSuccess:e.saveSuccess}})],1)},s=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"left"},[t("div",{staticClass:"title"},[t("i",{staticClass:"el-icon-unlock"}),t("h2",[e._v("角色管理")])])])}],r=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.data.isShow,width:"600px",title:e.data.id?"角色详情":"添加角色","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.data,"isShow",t)},open:e.open}},[t("el-divider"),t("div",{staticClass:"d-body"},[t("el-form",{ref:"roleForm",attrs:{model:e.data.form,rules:e.rules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入角色名称，如高级管理员，普通管理员等"},model:{value:e.data.form.name,callback:function(t){e.$set(e.data.form,"name",t)},expression:"data.form.name"}})],1),t("el-form-item",{staticStyle:{position:"relative"},attrs:{label:"角色描述",prop:"remark"}},[t("el-input",{attrs:{type:"textarea",placeholder:"至多输入50个字"},model:{value:e.data.form.remark,callback:function(t){e.$set(e.data.form,"remark",t)},expression:"data.form.remark"}}),t("div",{staticClass:"num"},[t("span",{class:{"tx-danger":e.data.form.remark.length>50}},[e._v(e._s(e.data.form.remark.length))]),e._v(" / 50 ")])],1),t("el-form-item",{attrs:{label:"权限"}},[t("div",{staticClass:"tree-wrap"},[t("el-tree",{key:e.treeKey,ref:"roleTree",attrs:{"default-expand-all":!0,data:e.treeData,props:e.defaultProps,"node-key":"key","show-checkbox":""}})],1)])],1)],1),t("el-divider"),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.data.isShow=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary",loading:e.data.loading},on:{click:e.save}},[e._v("保存")])],1)],1)},l=[],o=(a("d9e2"),{props:["data","treeData","roleList"],data(){let e=(e,t,a)=>{if(t&&t.length>50)return a(new Error("角色描述不能大于50字"));a()};return{treeKey:(new Date).valueOf(),defaultProps:{label:"name",children:"subMenu"},rules:{name:[{required:!0,message:"角色名称必须输入",trigger:"blur"}],remark:[{validator:e,trigger:"blur"}]}}},methods:{save(){this.data.loading=!0,this.$refs["roleForm"].validate(e=>{if(!e)return this.data.loading=!1,!1;{let[e,t]=[this.$refs.roleTree.getCheckedKeys(),[]];t=this.roleList.filter(t=>e.indexOf(t)<0);let a={name:this.data.form.name,description:this.data.form.remark,privilege:t};this.data.id&&(a.id=this.data.id),this.$apiCall("api.Admin.roleAdd",a,e=>{this.data.loading=!1,9999==e.ErrorCode?(this.$message({message:"保存成功",type:"success"}),this.data.isShow=!1,this.$emit("saveSuccess")):this.$message({message:e.Message,type:"error"})})}})},open(){this.treeKey=(new Date).valueOf();let e=this.roleList.filter(e=>this.data.rights.indexOf(e)<0);this.$nextTick(()=>{this.data.id?this.$refs.roleTree.setCheckedKeys(e):this.$refs.roleTree.setCheckedKeys([]),this.$refs["roleForm"].clearValidate(),document.querySelector(".tree-wrap").scrollTop=0})}}}),d=o,n=(a("5d7a"),a("2877")),c=Object(n["a"])(d,r,l,!1,null,"0f717bcf",null),m=c.exports,h={data(){return{isWrite:!1,loading:!1,items:[],treeData:[],roleList:[],dialogEditRoleData:{loading:!1,isShow:!1,id:"",form:{name:"",remark:""},rights:[]},defaultDialogEditRoleData:"{}"}},components:{DialogEditRole:m},mounted(){this.isWrite=this.$isRole(this.$route.meta.roleWrite),this.defaultDialogEditRoleData=JSON.stringify(this.dialogEditRoleData),this.getRole(),this.getRightArr()},methods:{delRole(e,t){this.$confirm("确定删除该角色吗?",{confirmButtonText:"删除",cancelButtonText:"取消",confirmButtonClass:" el-button--danger",type:"warning"}).then(()=>{this.loading=!0,this.$apiCall("api.Admin.roleDelete",{id:e.id},e=>{this.loading=!1,9999==e.ErrorCode?(this.items.splice(t,1),this.$message({message:"删除成功",type:"success"})):this.$message.error(e.Message)})}).catch()},getRole(){this.loading=!0,this.$apiCall("api.Admin.roleList",{},e=>{this.loading=!1,9999==e.ErrorCode?this.items=e.Data.Results.map(e=>e):this.$message({message:e.Message,type:"error"})})},getRightArr(){this.$apiCall("api.Admin.getRights",{},e=>{9999==e.ErrorCode?(this.treeData=[...e.Data.Results.rights],this.roleList=e.Data.Results.endpoint):this.$message.error(e.Message)})},openEditRole(e){this.dialogEditRoleData=JSON.parse(this.defaultDialogEditRoleData),e&&(this.dialogEditRoleData.form.name=e.name,this.dialogEditRoleData.form.remark=e.description||"",this.dialogEditRoleData.rights=e.privilege?JSON.parse(e.privilege):[],this.dialogEditRoleData.id=e.id),this.dialogEditRoleData.isShow=!0},saveSuccess(){this.getRole()}}},g=h,p=Object(n["a"])(g,i,s,!1,null,null,null);t["default"]=p.exports},"9e8d":function(e,t,a){}}]);
//# sourceMappingURL=Role.c6ca9ee4.js.map