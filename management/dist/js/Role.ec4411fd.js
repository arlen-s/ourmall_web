(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Role"],{"0344":function(e,t,a){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function i(e){if(Array.isArray(e))return r(e)}a.d(t,"a",(function(){return s}));a("6f1a"),a("6cd1"),a("4c4d"),a("82d0"),a("e90a"),a("dfdd"),a("e2e0");function o(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}a("3a76"),a("b8bb");function n(e,t){if(e){if("string"===typeof e)return r(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?r(e,t):void 0}}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e){return i(e)||o(e)||n(e)||l()}},"1dfb":function(e,t,a){var r=a("f00a"),i=a("efa0");e.exports=function(e,t,a,o){try{return o?t(r(a)[0],a[1]):t(a)}catch(n){i(e,"throw",n)}}},"3a76":function(e,t,a){"use strict";var r=a("dcce"),i=a("0c5f"),o=a("3980"),n=a("f767"),l=a("bf0e"),s=a("47f6"),d=a("fcf6"),c=a("89a5"),f=a("1f71"),u=f("slice"),m=c("species"),p=[].slice,g=Math.max;r({target:"Array",proto:!0,forced:!u},{slice:function(e,t){var a,r,c,f=s(this),u=l(f.length),h=n(e,u),v=n(void 0===t?u:t,u);if(o(f)&&(a=f.constructor,"function"!=typeof a||a!==Array&&!o(a.prototype)?i(a)&&(a=a[m],null===a&&(a=void 0)):a=void 0,a===Array||void 0===a))return p.call(f,h,v);for(r=new(void 0===a?Array:a)(g(v-h,0)),c=0;h<v;h++,c++)h in f&&d(r,c,f[h]);return r.length=c,r}})},"4d64":function(e,t,a){"use strict";a("fd84")},"65ff":function(e,t,a){"use strict";var r=a("dcce"),i=a("f767"),o=a("d3e9"),n=a("bf0e"),l=a("6a15"),s=a("c418"),d=a("fcf6"),c=a("1f71"),f=c("splice"),u=Math.max,m=Math.min,p=9007199254740991,g="Maximum allowed length exceeded";r({target:"Array",proto:!0,forced:!f},{splice:function(e,t){var a,r,c,f,h,v,b=l(this),y=n(b.length),w=i(e,y),k=arguments.length;if(0===k?a=r=0:1===k?(a=0,r=y-w):(a=k-2,r=m(u(o(t),0),y-w)),y+a-r>p)throw TypeError(g);for(c=s(b,r),f=0;f<r;f++)h=w+f,h in b&&d(c,f,b[h]);if(c.length=r,a<r){for(f=w;f<y-r;f++)h=f+r,v=f+a,h in b?b[v]=b[h]:delete b[v];for(f=y;f>y-r+a;f--)delete b[f-1]}else if(a>r)for(f=y-r;f>w;f--)h=f+r-1,v=f+a-1,h in b?b[v]=b[h]:delete b[v];for(f=0;f<a;f++)b[f+w]=arguments[f+2];return b.length=y-r+a,c}})},"707c":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"contentpanel role-management-page"},[a("div",{ref:"pageHeader",staticClass:"pagetitle"},[e._m(0),a("div",{staticClass:"right"},[a("el-button",{attrs:{type:"primary",disabled:!e.isWrite},on:{click:function(t){return e.openEditRole()}}},[e._v("添加角色")])],1)]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"pagebody"},[a("el-row",{staticClass:"mg-b-20",attrs:{gutter:15}},[a("el-col",{attrs:{span:24}},[a("el-card",[a("el-table",{ref:"gridTable",staticStyle:{width:"100%"},attrs:{data:e.items,stripe:"","row-key":"id"}},[a("el-table-column",{attrs:{label:"员工角色",prop:"name"}}),a("el-table-column",{attrs:{label:"描述",prop:"description"}}),a("el-table-column",{attrs:{label:"员工数",prop:"count",align:"center"}}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{staticStyle:{"margin-right":"20px"},attrs:{type:"primary",disabled:!e.isWrite},on:{click:function(a){return e.openEditRole(t.row)}}},[e._v(" 编辑 ")]),a("el-link",{attrs:{type:"danger",disabled:!e.isWrite},on:{click:function(a){return e.delRole(t.row,t.$index)}}},[e._v("删除")])]}}])})],1)],1)],1)],1)],1),a("DialogEditRole",{attrs:{data:e.dialogEditRoleData,treeData:e.treeData,roleList:e.roleList},on:{saveSuccess:e.saveSuccess}})],1)},i=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"left"},[a("div",{staticClass:"title"},[a("i",{staticClass:"el-icon-unlock"}),a("h2",[e._v("角色管理")])])])}],o=a("0344"),n=(a("65ff"),a("9135"),a("b8bb"),a("6f1a"),a("6cd1"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{visible:e.data.isShow,width:"600px",title:e.data.id?"角色详情":"添加角色","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.data,"isShow",t)},open:e.open}},[a("el-divider"),a("div",{staticClass:"d-body"},[a("el-form",{ref:"roleForm",attrs:{model:e.data.form,rules:e.rules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入角色名称，如高级管理员，普通管理员等"},model:{value:e.data.form.name,callback:function(t){e.$set(e.data.form,"name",t)},expression:"data.form.name"}})],1),a("el-form-item",{staticStyle:{position:"relative"},attrs:{label:"角色描述",prop:"remark"}},[a("el-input",{attrs:{type:"textarea",placeholder:"至多输入50个字"},model:{value:e.data.form.remark,callback:function(t){e.$set(e.data.form,"remark",t)},expression:"data.form.remark"}}),a("div",{staticClass:"num"},[a("span",{class:{"tx-danger":e.data.form.remark.length>50}},[e._v(e._s(e.data.form.remark.length))]),e._v(" / 50 ")])],1),a("el-form-item",{attrs:{label:"权限"}},[a("div",{staticClass:"tree-wrap"},[a("el-tree",{key:e.treeKey,ref:"roleTree",attrs:{"default-expand-all":!0,data:e.treeData,props:e.defaultProps,"node-key":"key","show-checkbox":""}})],1)])],1)],1),a("el-divider"),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.data.isShow=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",loading:e.data.loading},on:{click:e.save}},[e._v("保存")])],1)],1)}),l=[],s=(a("0029"),{props:["data","treeData","roleList"],data:function(){var e=function(e,t,a){if(t&&t.length>50)return a(new Error("角色描述不能大于50字"));a()};return{treeKey:(new Date).valueOf(),defaultProps:{label:"name",children:"subMenu"},rules:{name:[{required:!0,message:"角色名称必须输入",trigger:"blur"}],remark:[{validator:e,trigger:"blur"}]}}},methods:{save:function(){var e=this;this.data.loading=!0,this.$refs["roleForm"].validate((function(t){if(!t)return e.data.loading=!1,!1;var a=[e.$refs.roleTree.getCheckedKeys(),[]],r=a[0],i=a[1];i=e.roleList.filter((function(e){return r.indexOf(e)<0}));var o={name:e.data.form.name,description:e.data.form.remark,privilege:i};e.data.id&&(o.id=e.data.id),e.$apiCall("api.Admin.roleAdd",o,(function(t){e.data.loading=!1,9999==t.ErrorCode?(e.$message({message:"保存成功",type:"success"}),e.data.isShow=!1,e.$emit("saveSuccess")):e.$message({message:t.Message,type:"error"})}))}))},open:function(){var e=this;this.treeKey=(new Date).valueOf();var t=this.roleList.filter((function(t){return e.data.rights.indexOf(t)<0}));this.$nextTick((function(){e.data.id?e.$refs.roleTree.setCheckedKeys(t):e.$refs.roleTree.setCheckedKeys([]),e.$refs["roleForm"].clearValidate(),document.querySelector(".tree-wrap").scrollTop=0}))}}}),d=s,c=(a("4d64"),a("cba8")),f=Object(c["a"])(d,n,l,!1,null,"0f717bcf",null),u=f.exports,m={data:function(){return{isWrite:!1,loading:!1,items:[],treeData:[],roleList:[],dialogEditRoleData:{loading:!1,isShow:!1,id:"",form:{name:"",remark:""},rights:[]},defaultDialogEditRoleData:"{}"}},components:{DialogEditRole:u},mounted:function(){this.isWrite=this.$isRole(this.$route.meta.roleWrite),this.defaultDialogEditRoleData=JSON.stringify(this.dialogEditRoleData),this.getRole(),this.getRightArr()},methods:{delRole:function(e,t){var a=this;this.$confirm("确定删除该角色吗?",{confirmButtonText:"删除",cancelButtonText:"取消",confirmButtonClass:" el-button--danger",type:"warning"}).then((function(){a.loading=!0,a.$apiCall("api.Admin.roleDelete",{id:e.id},(function(e){a.loading=!1,9999==e.ErrorCode?(a.items.splice(t,1),a.$message({message:"删除成功",type:"success"})):a.$message.error(e.Message)}))})).catch()},getRole:function(){var e=this;this.loading=!0,this.$apiCall("api.Admin.roleList",{},(function(t){e.loading=!1,9999==t.ErrorCode?e.items=t.Data.Results.map((function(e){return e})):e.$message({message:t.Message,type:"error"})}))},getRightArr:function(){var e=this;this.$apiCall("api.Admin.getRights",{},(function(t){9999==t.ErrorCode?(e.treeData=Object(o["a"])(t.Data.Results.rights),e.roleList=t.Data.Results.endpoint):e.$message.error(t.Message)}))},openEditRole:function(e){this.dialogEditRoleData=JSON.parse(this.defaultDialogEditRoleData),e&&(this.dialogEditRoleData.form.name=e.name,this.dialogEditRoleData.form.remark=e.description||"",this.dialogEditRoleData.rights=e.privilege?JSON.parse(e.privilege):[],this.dialogEditRoleData.id=e.id),this.dialogEditRoleData.isShow=!0},saveSuccess:function(){this.getRole()}}},p=m,g=Object(c["a"])(p,r,i,!1,null,null,null);t["default"]=g.exports},"7af4":function(e,t,a){"use strict";var r=a("ea53"),i=a("6a15"),o=a("1dfb"),n=a("9c18"),l=a("bf0e"),s=a("fcf6"),d=a("01f8"),c=a("1154");e.exports=function(e){var t,a,f,u,m,p,g=i(e),h="function"==typeof this?this:Array,v=arguments.length,b=v>1?arguments[1]:void 0,y=void 0!==b,w=c(g),k=0;if(y&&(b=r(b,v>2?arguments[2]:void 0,2)),void 0==w||h==Array&&n(w))for(t=l(g.length),a=new h(t);t>k;k++)p=y?b(g[k],k):g[k],s(a,k,p);else for(u=d(g,w),m=u.next,a=new h;!(f=m.call(u)).done;k++)p=y?o(u,b,[f.value,k],!0):f.value,s(a,k,p);return a.length=k,a}},9135:function(e,t,a){"use strict";var r=a("dcce"),i=a("b488").map,o=a("1f71"),n=o("map");r({target:"Array",proto:!0,forced:!n},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},e2e0:function(e,t,a){var r=a("dcce"),i=a("7af4"),o=a("44ea"),n=!o((function(e){Array.from(e)}));r({target:"Array",stat:!0,forced:n},{from:i})},fd84:function(e,t,a){}}]);
//# sourceMappingURL=Role.ec4411fd.js.map